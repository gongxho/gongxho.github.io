<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://0808200.xyz/vue2/components/async-component.html"><meta property="og:site_name" content="ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"><meta property="og:title" content="å¼‚æ­¥ç»„ä»¶"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-29T09:14:21.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="ustbhuangyi"><meta property="article:modified_time" content="2022-08-29T09:14:21.000Z"><meta name="baidu-site-verification" content="4H7tszevS8"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5c92d1"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icon/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>å¼‚æ­¥ç»„ä»¶ | ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„</title><meta name="description" content="ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„ personal blog.">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/css/styles.a3b28925.css">
    <link rel="preload" href="/assets/js/runtime~app.cc44c0ce.js" as="script"><link rel="preload" href="/assets/css/styles.a3b28925.css" as="style"><link rel="preload" href="/assets/js/31606.23ba15c3.js" as="script"><link rel="preload" href="/assets/js/app.0512e41a.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.png" alt="ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"><!----><span class="site-name hide-in-pad">ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="éšç¬”"><span class="title"><span class="icon iconfont icon-note" style=""></span>éšç¬”</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/note/" class="nav-link" aria-label="éšç¬”"><span class="icon iconfont icon-note" style=""></span>éšç¬”<!----></a></li><li class="dropdown-item"><a href="/note/moodEssay/" class="nav-link" aria-label="å¿ƒæƒ…éšç¬”"><span class="icon iconfont icon-leaf" style=""></span>å¿ƒæƒ…éšç¬”<!----></a></li><li class="dropdown-item"><a href="/note/moodArticle/" class="nav-link" aria-label="å¿ƒæƒ…æ–‡ç« "><span class="icon iconfont icon-flower" style=""></span>å¿ƒæƒ…æ–‡ç« <!----></a></li><li class="dropdown-item"><a href="/note/lifeDiary/" class="nav-link" aria-label="ç”Ÿæ´»æ—¥è®°"><span class="icon iconfont icon-form" style=""></span>ç”Ÿæ´»æ—¥è®°<!----></a></li><li class="dropdown-item"><a href="/note/inOnLife/" class="nav-link" aria-label="äººç”Ÿæ„Ÿæ‚Ÿ"><span class="icon iconfont icon-nodeJS" style=""></span>äººç”Ÿæ„Ÿæ‚Ÿ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="ä»£ç ç¬”è®°"><span class="title"><span class="icon iconfont icon-code" style=""></span>ä»£ç ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/code/" class="nav-link" aria-label="ä»£ç ç¬”è®°"><span class="icon iconfont icon-code" style=""></span>ä»£ç ç¬”è®°<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å‰ç«¯</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vue2/" class="nav-link active" aria-label="vue2 æºç è§£æ"><span class="icon iconfont icon-vue" style=""></span>vue2 æºç è§£æ<!----></a></li><li class="dropdown-subitem"><a href="/react/" class="nav-link" aria-label="React æºç è§£æ"><span class="icon iconfont icon-code" style=""></span>React æºç è§£æ<!----></a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link" aria-label="Vue3 æºç è§£æ"><span class="icon iconfont icon-typescript" style=""></span>Vue3 æºç è§£æ<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>äº§å“è®¾è®¡</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/design/" class="nav-link" aria-label="UI è®¾è®¡"><span class="icon iconfont icon-skin" style=""></span>UI è®¾è®¡<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>åç«¯è¿ç»´</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-linux" style=""></span>Linux<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è½¯ä»¶æ•™ç¨‹"><span class="title"><span class="icon iconfont icon-software" style=""></span>è½¯ä»¶æ•™ç¨‹</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/software/" class="nav-link" aria-label="è½¯ä»¶æ•™ç¨‹"><span class="icon iconfont icon-software" style=""></span>è½¯ä»¶æ•™ç¨‹<!----></a></li><li class="dropdown-item"><a href="/software/vscode/" class="nav-link" aria-label="VS Code"><span class="icon iconfont icon-vscode" style=""></span>VS Code<!----></a></li><li class="dropdown-item"><a href="/software/git/" class="nav-link" aria-label="Git"><span class="icon iconfont icon-git" style=""></span>Git<!----></a></li><li class="dropdown-item"><a href="/software/comsol/" class="nav-link" aria-label="COMSOL"><span class="icon iconfont icon-app" style=""></span>COMSOL<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/vue2/" class="nav-link sidebar-link sidebar-page" aria-label="vue2 æºç è§£æ"><span class="icon iconfont icon-vue" style=""></span>vue2 æºç è§£æ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">å‡†å¤‡å·¥ä½œ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/prepare/flow.html" class="nav-link sidebar-link sidebar-page" aria-label="è®¤è¯† Flow"><!---->è®¤è¯† Flow<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/prepare/directory.html" class="nav-link sidebar-link sidebar-page" aria-label="Vue.js æºç ç›®å½•è®¾è®¡"><!---->Vue.js æºç ç›®å½•è®¾è®¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/prepare/build.html" class="nav-link sidebar-link sidebar-page" aria-label="Vue.js æºç æ„å»º"><!---->Vue.js æºç æ„å»º<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/prepare/entrance.html" class="nav-link sidebar-link sidebar-page" aria-label="ä»å…¥å£å¼€å§‹"><!---->ä»å…¥å£å¼€å§‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">æ•°æ®é©±åŠ¨</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/data-driven/new-vue.html" class="nav-link sidebar-link sidebar-page" aria-label="new Vue å‘ç”Ÿäº†ä»€ä¹ˆ"><!---->new Vue å‘ç”Ÿäº†ä»€ä¹ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/data-driven/mounted.html" class="nav-link sidebar-link sidebar-page" aria-label="Vue å®ä¾‹æŒ‚è½½çš„å®ç°"><!---->Vue å®ä¾‹æŒ‚è½½çš„å®ç°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/data-driven/render.html" class="nav-link sidebar-link sidebar-page" aria-label="render"><!---->render<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/data-driven/virtual-dom.html" class="nav-link sidebar-link sidebar-page" aria-label="Virtual DOM"><!---->Virtual DOM<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/data-driven/create-element.html" class="nav-link sidebar-link sidebar-page" aria-label="createElement"><!---->createElement<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/data-driven/update.html" class="nav-link sidebar-link sidebar-page" aria-label="update"><!---->update<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><span class="icon iconfont icon-guide" style=""></span><span class="title">ç»„ä»¶åŒ–</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/components/create-component.html" class="nav-link sidebar-link sidebar-page" aria-label="createComponent"><!---->createComponent<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/components/patch.html" class="nav-link sidebar-link sidebar-page" aria-label="patch"><!---->patch<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/components/merge-option.html" class="nav-link sidebar-link sidebar-page" aria-label="åˆå¹¶é…ç½®"><!---->åˆå¹¶é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/components/lifecycle.html" class="nav-link sidebar-link sidebar-page" aria-label="ç”Ÿå‘½å‘¨æœŸ"><!---->ç”Ÿå‘½å‘¨æœŸ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/components/component-register.html" class="nav-link sidebar-link sidebar-page" aria-label="ç»„ä»¶æ³¨å†Œ"><!---->ç»„ä»¶æ³¨å†Œ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/vue2/components/async-component.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="å¼‚æ­¥ç»„ä»¶"><!---->å¼‚æ­¥ç»„ä»¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶"><!---->æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#promise-å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Promise å¼‚æ­¥ç»„ä»¶"><!---->Promise å¼‚æ­¥ç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#é«˜çº§å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é«˜çº§å¼‚æ­¥ç»„ä»¶"><!---->é«˜çº§å¼‚æ­¥ç»„ä»¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥"><!---->å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ"><!---->å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­"><!---->å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶"><!---->å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶-patch" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥ç»„ä»¶ patch"><!---->å¼‚æ­¥ç»„ä»¶ patch<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue2/components/async-component.html#æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">æ·±å…¥å“åº”å¼åŸç†</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/reactive/reactive-object.html" class="nav-link sidebar-link sidebar-page" aria-label="å“åº”å¼å¯¹è±¡"><!---->å“åº”å¼å¯¹è±¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/getters.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¾èµ–æ”¶é›†"><!---->ä¾èµ–æ”¶é›†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/setters.html" class="nav-link sidebar-link sidebar-page" aria-label="æ´¾å‘æ›´æ–°"><!---->æ´¾å‘æ›´æ–°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/next-tick.html" class="nav-link sidebar-link sidebar-page" aria-label="nextTick"><!---->nextTick<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/questions.html" class="nav-link sidebar-link sidebar-page" aria-label="æ£€æµ‹å˜åŒ–çš„æ³¨æ„äº‹é¡¹"><!---->æ£€æµ‹å˜åŒ–çš„æ³¨æ„äº‹é¡¹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/computed-watcher.html" class="nav-link sidebar-link sidebar-page" aria-label="è®¡ç®—å±æ€§ VS ä¾¦å¬å±æ€§"><!---->è®¡ç®—å±æ€§ VS ä¾¦å¬å±æ€§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/component-update.html" class="nav-link sidebar-link sidebar-page" aria-label="ç»„ä»¶æ›´æ–°"><!---->ç»„ä»¶æ›´æ–°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/props.html" class="nav-link sidebar-link sidebar-page" aria-label="Props (v2.6.11)"><!---->Props (v2.6.11)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/reactive/summary.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸç†å›¾"><!---->åŸç†å›¾<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">ç¼–è¯‘</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/compile/entrance.html" class="nav-link sidebar-link sidebar-page" aria-label="ç¼–è¯‘å…¥å£"><!---->ç¼–è¯‘å…¥å£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/compile/parse.html" class="nav-link sidebar-link sidebar-page" aria-label="parse"><!---->parse<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/compile/optimize.html" class="nav-link sidebar-link sidebar-page" aria-label="optimize"><!---->optimize<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/compile/codegen.html" class="nav-link sidebar-link sidebar-page" aria-label="codegen"><!---->codegen<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">æ‰©å±•</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/extend/event.html" class="nav-link sidebar-link sidebar-page" aria-label="event"><!---->event<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/extend/v-model.html" class="nav-link sidebar-link sidebar-page" aria-label="v-model"><!---->v-model<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/extend/slot.html" class="nav-link sidebar-link sidebar-page" aria-label="slot"><!---->slot<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/extend/keep-alive.html" class="nav-link sidebar-link sidebar-page" aria-label="keep-alive"><!---->keep-alive<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/extend/tansition.html" class="nav-link sidebar-link sidebar-page" aria-label="transition"><!---->transition<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/extend/tansition-group.html" class="nav-link sidebar-link sidebar-page" aria-label="transition-group"><!---->transition-group<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">Vue Router</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/vue-router/install.html" class="nav-link sidebar-link sidebar-page" aria-label="è·¯ç”±æ³¨å†Œ"><!---->è·¯ç”±æ³¨å†Œ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/vue-router/router.html" class="nav-link sidebar-link sidebar-page" aria-label="VueRouter å¯¹è±¡"><!---->VueRouter å¯¹è±¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/vue-router/matcher.html" class="nav-link sidebar-link sidebar-page" aria-label="matcher"><!---->matcher<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/vue-router/transition-to.html" class="nav-link sidebar-link sidebar-page" aria-label="è·¯å¾„åˆ‡æ¢"><!---->è·¯å¾„åˆ‡æ¢<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><span class="icon iconfont icon-guide" style=""></span><span class="title">Vuex</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/vue2/vuex/init.html" class="nav-link sidebar-link sidebar-page" aria-label="Vuex åˆå§‹åŒ–"><!---->Vuex åˆå§‹åŒ–<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/vuex/api.html" class="nav-link sidebar-link sidebar-page" aria-label="API"><!---->API<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue2/vuex/plugin.html" class="nav-link sidebar-link sidebar-page" aria-label="æ’ä»¶"><!---->æ’ä»¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->å¼‚æ­¥ç»„ä»¶</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´8æœˆ29æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">ustbhuangyi</span></span><span property="author" content="ustbhuangyi"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´8æœˆ29æ—¥</span><meta property="datePublished" content="2022-08-29T09:14:21.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2022å¹´8æœˆ29æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 10 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT10M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level2">æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#promise-å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level2">Promise å¼‚æ­¥ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#é«˜çº§å¼‚æ­¥ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level2">é«˜çº§å¼‚æ­¥ç»„ä»¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥" class="router-link-active router-link-exact-active toc-link level3">å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ" class="router-link-active router-link-exact-active toc-link level3">å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­" class="router-link-active router-link-exact-active toc-link level3">å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶" class="router-link-active router-link-exact-active toc-link level3">å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#å¼‚æ­¥ç»„ä»¶-patch" class="router-link-active router-link-exact-active toc-link level2">å¼‚æ­¥ç»„ä»¶ patch</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue2/components/async-component.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="å¼‚æ­¥ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶</h1><p>åœ¨æˆ‘ä»¬å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­ï¼Œä¸ºäº†å‡å°‘é¦–å±ä»£ç ä½“ç§¯ï¼Œå¾€å¾€ä¼šæŠŠä¸€äº›éé¦–å±çš„ç»„ä»¶è®¾è®¡æˆå¼‚æ­¥ç»„ä»¶ï¼ŒæŒ‰éœ€åŠ è½½ã€‚Vue ä¹ŸåŸç”Ÿæ”¯æŒäº†å¼‚æ­¥ç»„ä»¶çš„èƒ½åŠ›ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;async-example&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// è¿™ä¸ªç‰¹æ®Šçš„ require è¯­æ³•å‘Šè¯‰ webpack</span>
   <span class="token comment">// è‡ªåŠ¨å°†ç¼–è¯‘åçš„ä»£ç åˆ†å‰²æˆä¸åŒçš„å—ï¼Œ</span>
   <span class="token comment">// è¿™äº›å—å°†é€šè¿‡ Ajax è¯·æ±‚è‡ªåŠ¨ä¸‹è½½ã€‚</span>
   <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./my-async-component&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒVue æ³¨å†Œçš„ç»„ä»¶ä¸å†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•° <code>resolve</code> å’Œ <code>reject</code>ï¼Œå‡½æ•°å†…éƒ¨ç”¨ <code>setTimout</code> æ¨¡æ‹Ÿäº†å¼‚æ­¥ï¼Œå®é™…ä½¿ç”¨å¯èƒ½æ˜¯é€šè¿‡åŠ¨æ€è¯·æ±‚å¼‚æ­¥ç»„ä»¶çš„ JS åœ°å€ï¼Œæœ€ç»ˆé€šè¿‡æ‰§è¡Œ <code>resolve</code> æ–¹æ³•ï¼Œå®ƒçš„å‚æ•°å°±æ˜¯æˆ‘ä»¬çš„å¼‚æ­¥ç»„ä»¶å¯¹è±¡ã€‚</p><p>åœ¨äº†è§£äº†å¼‚æ­¥ç»„ä»¶å¦‚ä½•æ³¨å†Œåï¼Œæˆ‘ä»¬ä»æºç çš„è§’åº¦æ¥åˆ†æä¸€ä¸‹å®ƒçš„å®ç°ã€‚</p><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº†ç»„ä»¶çš„æ³¨å†Œé€»è¾‘ï¼Œç”±äºç»„ä»¶çš„å®šä¹‰å¹¶ä¸æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œ <code>Vue.extend</code> çš„é€»è¾‘æŠŠå®ƒå˜æˆä¸€ä¸ªç»„ä»¶çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å®ƒä»ç„¶å¯ä»¥æ‰§è¡Œåˆ° <code>createComponent</code> å‡½æ•°ï¼Œæˆ‘ä»¬å†æ¥å¯¹è¿™ä¸ªå‡½æ•°åšå›é¡¾ï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/core/vdom/create-component/js</code> ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">Ctor</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  tag<span class="token operator">?</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> baseCtor <span class="token operator">=</span> context<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_base

  <span class="token comment">// plain options object: turn it into a constructor</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Ctor <span class="token operator">=</span> baseCtor<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>

  <span class="token comment">// async component</span>
  <span class="token keyword">let</span> asyncFactory
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>Ctor<span class="token punctuation">.</span>cid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    asyncFactory <span class="token operator">=</span> Ctor
    Ctor <span class="token operator">=</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>asyncFactory<span class="token punctuation">,</span> baseCtor<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Ctor <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// return a placeholder node for async component, which is rendered</span>
      <span class="token comment">// as a comment node but preserves all the raw information for the node.</span>
      <span class="token comment">// the information will be used for async server-rendering and hydration.</span>
      <span class="token keyword">return</span> <span class="token function">createAsyncPlaceholder</span><span class="token punctuation">(</span>
        asyncFactory<span class="token punctuation">,</span>
        data<span class="token punctuation">,</span>
        context<span class="token punctuation">,</span>
        children<span class="token punctuation">,</span>
        tag
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çœç•¥äº†ä¸å¿…è¦çš„é€»è¾‘ï¼Œåªä¿ç•™å…³é”®é€»è¾‘ï¼Œç”±äºæˆ‘ä»¬è¿™ä¸ªæ—¶å€™ä¼ å…¥çš„ <code>Ctor</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¹¶ä¸ä¼šæ‰§è¡Œ <code>Vue.extend</code> é€»è¾‘ï¼Œå› æ­¤å®ƒçš„ <code>cid</code> æ˜¯ <code>undefiend</code>ï¼Œè¿›å…¥äº†å¼‚æ­¥ç»„ä»¶åˆ›å»ºçš„é€»è¾‘ã€‚è¿™é‡Œé¦–å…ˆæ‰§è¡Œäº† <code>Ctor = resolveAsyncComponent(asyncFactory, baseCtor, context)</code> æ–¹æ³•ï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/core/vdom/helpers/resolve-async-component.js</code> ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resolveAsyncComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">factory</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>
  <span class="token literal-property property">baseCtor</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>errorComp
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loadingComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loadingComp
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>contexts<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// already pending</span>
    factory<span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> contexts <span class="token operator">=</span> factory<span class="token punctuation">.</span>contexts <span class="token operator">=</span> <span class="token punctuation">[</span>context<span class="token punctuation">]</span>
    <span class="token keyword">let</span> sync <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token keyword">const</span> <span class="token function-variable function">forceRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> contexts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        contexts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">$forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> Object <span class="token operator">|</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// cache resolved</span>
      factory<span class="token punctuation">.</span>resolved <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
      <span class="token comment">// invoke callbacks only if this is not a synchronous resolve</span>
      <span class="token comment">// (async resolves are shimmed as synchronous during SSR)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> reject <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to resolve async component: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token punctuation">(</span>reason <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\nReason: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        factory<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> res<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// () =&gt; Promise</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> res<span class="token punctuation">.</span>component<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>component<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          factory<span class="token punctuation">.</span>errorComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          factory<span class="token punctuation">.</span>loadingComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>delay <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>delay <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>
                process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span>
                  <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">timeout (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>timeout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms)</span><span class="token template-punctuation string">`</span></span>
                  <span class="token operator">:</span> <span class="token keyword">null</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    sync <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// return in case resolved synchronously</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loading
      <span class="token operator">?</span> factory<span class="token punctuation">.</span>loadingComp
      <span class="token operator">:</span> factory<span class="token punctuation">.</span>resolved
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>resolveAsyncComponent</code> å‡½æ•°çš„é€»è¾‘ç•¥å¤æ‚ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¤„ç†äº† 3 ç§å¼‚æ­¥ç»„ä»¶çš„åˆ›å»ºæ–¹å¼ï¼Œé™¤äº†åˆšæ‰ç¤ºä¾‹çš„ç»„ä»¶æ³¨å†Œæ–¹å¼ï¼Œè¿˜æ”¯æŒ 2 ç§ï¼Œä¸€ç§æ˜¯æ”¯æŒ <code>Promise</code> åˆ›å»ºç»„ä»¶çš„æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
  <span class="token string">&#39;async-webpack-example&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// è¯¥ `import` å‡½æ•°è¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ã€‚</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./my-async-component&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ç§æ˜¯é«˜çº§å¼‚æ­¥ç»„ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">AsyncComp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// éœ€è¦åŠ è½½çš„ç»„ä»¶ã€‚åº”å½“æ˜¯ä¸€ä¸ª Promise</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./MyComp.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// åŠ è½½ä¸­åº”å½“æ¸²æŸ“çš„ç»„ä»¶</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> LoadingComp<span class="token punctuation">,</span>
  <span class="token comment">// å‡ºé”™æ—¶æ¸²æŸ“çš„ç»„ä»¶</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> ErrorComp<span class="token punctuation">,</span>
  <span class="token comment">// æ¸²æŸ“åŠ è½½ä¸­ç»„ä»¶å‰çš„ç­‰å¾…æ—¶é—´ã€‚é»˜è®¤ï¼š200msã€‚</span>
  <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token comment">// æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚è¶…å‡ºæ­¤æ—¶é—´åˆ™æ¸²æŸ“é”™è¯¯ç»„ä»¶ã€‚é»˜è®¤ï¼šInfinity</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;async-example&#39;</span><span class="token punctuation">,</span> AsyncComp<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆè§£ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ ¹æ®è¿™ 3 ç§å¼‚æ­¥ç»„ä»¶çš„æƒ…å†µï¼Œæ¥åˆ†åˆ«å»åˆ†æ <code>resolveAsyncComponent</code> çš„é€»è¾‘ã€‚</p><h2 id="æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶" aria-hidden="true">#</a> æ™®é€šå‡½æ•°å¼‚æ­¥ç»„ä»¶</h2><p>é’ˆå¯¹æ™®é€šå‡½æ•°çš„æƒ…å†µï¼Œå‰é¢å‡ ä¸ª if åˆ¤æ–­å¯ä»¥å¿½ç•¥ï¼Œå®ƒä»¬æ˜¯ä¸ºé«˜çº§ç»„ä»¶æ‰€ç”¨ï¼Œå¯¹äº <code>factory.contexts</code> çš„åˆ¤æ–­ï¼Œæ˜¯è€ƒè™‘åˆ°å¤šä¸ªåœ°æ–¹åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼Œé‚£ä¹ˆå®ƒçš„å®é™…åŠ è½½åº”è¯¥åªæœ‰ä¸€æ¬¡ã€‚æ¥ç€è¿›å…¥å®é™…åŠ è½½é€»è¾‘ï¼Œå®šä¹‰äº† <code>forceRender</code>ã€<code>resolve</code> å’Œ <code>reject</code> å‡½æ•°ï¼Œæ³¨æ„ <code>resolve</code> å’Œ <code>reject</code> å‡½æ•°ç”¨ <code>once</code> å‡½æ•°åšäº†ä¸€å±‚åŒ…è£…ï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/shared/util.js</code> ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Ensure a function is called only once.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">once</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">fn</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>called<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      called <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>once</code> é€»è¾‘éå¸¸ç®€å•ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå®ƒéå¸¸å·§å¦™åœ°åˆ©ç”¨é—­åŒ…å’Œä¸€ä¸ªæ ‡å¿—ä½ä¿è¯äº†å®ƒåŒ…è£…çš„å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿ <code>resolve</code> å’Œ <code>reject</code> å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>æ¥ä¸‹æ¥æ‰§è¡Œ <code>const res = factory(resolve, reject)</code> é€»è¾‘ï¼Œè¿™å—å„¿å°±æ˜¯æ‰§è¡Œæˆ‘ä»¬ç»„ä»¶çš„å·¥å‚å‡½æ•°ï¼ŒåŒæ—¶æŠŠ <code>resolve</code> å’Œ <code>reject</code> å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç»„ä»¶çš„å·¥å‚å‡½æ•°é€šå¸¸ä¼šå…ˆå‘é€è¯·æ±‚å»åŠ è½½æˆ‘ä»¬çš„å¼‚æ­¥ç»„ä»¶çš„ JS æ–‡ä»¶ï¼Œæ‹¿åˆ°ç»„ä»¶å®šä¹‰çš„å¯¹è±¡ <code>res</code> åï¼Œæ‰§è¡Œ <code>resolve(res)</code> é€»è¾‘ï¼Œå®ƒä¼šå…ˆæ‰§è¡Œ <code>factory.resolved = ensureCtor(res, baseCtor)</code>ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">ensureCtor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">comp</span><span class="token operator">:</span> any<span class="token punctuation">,</span> base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    comp<span class="token punctuation">.</span>__esModule <span class="token operator">||</span>
    <span class="token punctuation">(</span>hasSymbol <span class="token operator">&amp;&amp;</span> comp<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;Module&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    comp <span class="token operator">=</span> comp<span class="token punctuation">.</span>default
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span>
    <span class="token operator">?</span> base<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span>
    <span class="token operator">:</span> comp
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°ç›®çš„æ˜¯ä¸ºäº†ä¿è¯èƒ½æ‰¾åˆ°å¼‚æ­¥ç»„ä»¶ JS å®šä¹‰çš„ç»„ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”å¦‚æœå®ƒæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œåˆ™è°ƒç”¨ <code>Vue.extend</code> æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªç»„ä»¶çš„æ„é€ å‡½æ•°ã€‚</p><p><code>resolve</code> é€»è¾‘æœ€ååˆ¤æ–­äº† <code>sync</code>ï¼Œæ˜¾ç„¶æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸‹ <code>sync</code> ä¸º falseï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ <code>forceRender</code> å‡½æ•°ï¼Œå®ƒä¼šéå† <code>factory.contexts</code>ï¼Œæ‹¿åˆ°æ¯ä¸€ä¸ªè°ƒç”¨å¼‚æ­¥ç»„ä»¶çš„å®ä¾‹ <code>vm</code>, æ‰§è¡Œ <code>vm.$forceUpdate()</code> æ–¹æ³•ï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/core/instance/lifecycle.js</code> ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_watcher<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>$forceUpdate</code> çš„é€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯è°ƒç”¨æ¸²æŸ“ <code>watcher</code> çš„ <code>update</code> æ–¹æ³•ï¼Œè®©æ¸²æŸ“ <code>watcher</code> å¯¹åº”çš„å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è§¦å‘äº†ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸º Vue é€šå¸¸æ˜¯æ•°æ®é©±åŠ¨è§†å›¾é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªå¼‚æ­¥ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­æ˜¯æ²¡æœ‰æ•°æ®å‘ç”Ÿå˜åŒ–çš„ï¼Œæ‰€ä»¥é€šè¿‡æ‰§è¡Œ <code>$forceUpdate</code> å¯ä»¥å¼ºåˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ä¸€æ¬¡ã€‚</p><h2 id="promise-å¼‚æ­¥ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#promise-å¼‚æ­¥ç»„ä»¶" aria-hidden="true">#</a> <code>Promise</code> å¼‚æ­¥ç»„ä»¶</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
  <span class="token string">&#39;async-webpack-example&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// è¯¥ `import` å‡½æ•°è¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ã€‚</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./my-async-component&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>webpack 2+ æ”¯æŒäº†å¼‚æ­¥åŠ è½½çš„è¯­æ³•ç³–ï¼š<code>() =&gt; import(&#39;./my-async-component&#39;)</code>ï¼Œå½“æ‰§è¡Œå®Œ <code>res = factory(resolve, reject)</code>ï¼Œè¿”å›çš„å€¼å°±æ˜¯ <code> import(&#39;./my-async-component&#39;)</code> çš„è¿”å›å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ã€‚æ¥ç€è¿›å…¥ if æ¡ä»¶ï¼Œåˆåˆ¤æ–­äº† <code>typeof res.then === &#39;function&#39;)</code>ï¼Œæ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç»„ä»¶å¼‚æ­¥åŠ è½½æˆåŠŸåï¼Œæ‰§è¡Œ <code>resolve</code>ï¼ŒåŠ è½½å¤±è´¥åˆ™æ‰§è¡Œ <code>reject</code>ï¼Œè¿™æ ·å°±éå¸¸å·§å¦™åœ°å®ç°äº†é…åˆ webpack 2+ çš„å¼‚æ­¥åŠ è½½ç»„ä»¶çš„æ–¹å¼ï¼ˆ<code>Promise</code>ï¼‰åŠ è½½å¼‚æ­¥ç»„ä»¶ã€‚</p><h2 id="é«˜çº§å¼‚æ­¥ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#é«˜çº§å¼‚æ­¥ç»„ä»¶" aria-hidden="true">#</a> é«˜çº§å¼‚æ­¥ç»„ä»¶</h2><p>ç”±äºå¼‚æ­¥åŠ è½½ç»„ä»¶éœ€è¦åŠ¨æ€åŠ è½½ JSï¼Œæœ‰ä¸€å®šç½‘ç»œå»¶æ—¶ï¼Œè€Œä¸”æœ‰åŠ è½½å¤±è´¥çš„æƒ…å†µï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬åœ¨å¼€å‘å¼‚æ­¥ç»„ä»¶ç›¸å…³é€»è¾‘çš„æ—¶å€™éœ€è¦è®¾è®¡ loading ç»„ä»¶å’Œ error ç»„ä»¶ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶æœºæ¸²æŸ“å®ƒä»¬ã€‚Vue.js 2.3+ æ”¯æŒäº†ä¸€ç§é«˜çº§å¼‚æ­¥ç»„ä»¶çš„æ–¹å¼ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªç®€å•çš„å¯¹è±¡é…ç½®ï¼Œå¸®ä½ æå®š loading ç»„ä»¶å’Œ error ç»„ä»¶çš„æ¸²æŸ“æ—¶æœºï¼Œä½ å®Œå…¨ä¸ç”¨å…³å¿ƒç»†èŠ‚ï¼Œéå¸¸æ–¹ä¾¿ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»æºç çš„è§’åº¦æ¥åˆ†æé«˜çº§å¼‚æ­¥ç»„ä»¶æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">AsyncComp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// éœ€è¦åŠ è½½çš„ç»„ä»¶ã€‚åº”å½“æ˜¯ä¸€ä¸ª Promise</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./MyComp.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// åŠ è½½ä¸­åº”å½“æ¸²æŸ“çš„ç»„ä»¶</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> LoadingComp<span class="token punctuation">,</span>
  <span class="token comment">// å‡ºé”™æ—¶æ¸²æŸ“çš„ç»„ä»¶</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> ErrorComp<span class="token punctuation">,</span>
  <span class="token comment">// æ¸²æŸ“åŠ è½½ä¸­ç»„ä»¶å‰çš„ç­‰å¾…æ—¶é—´ã€‚é»˜è®¤ï¼š200msã€‚</span>
  <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token comment">// æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚è¶…å‡ºæ­¤æ—¶é—´åˆ™æ¸²æŸ“é”™è¯¯ç»„ä»¶ã€‚é»˜è®¤ï¼šInfinity</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;async-example&#39;</span><span class="token punctuation">,</span> AsyncComp<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é«˜çº§å¼‚æ­¥ç»„ä»¶çš„åˆå§‹åŒ–é€»è¾‘å’Œæ™®é€šå¼‚æ­¥ç»„ä»¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯æ‰§è¡Œ <code>resolveAsyncComponent</code>ï¼Œå½“æ‰§è¡Œå®Œ <code>res = factory(resolve, reject)</code>ï¼Œè¿”å›å€¼å°±æ˜¯å®šä¹‰çš„ç»„ä»¶å¯¹è±¡ï¼Œæ˜¾ç„¶æ»¡è¶³ <code>else if (isDef(res.component) &amp;&amp; typeof res.component.then === &#39;function&#39;)</code> çš„é€»è¾‘ï¼Œæ¥ç€æ‰§è¡Œ <code>res.component.then(resolve, reject)</code>ï¼Œå½“å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸåï¼Œæ‰§è¡Œ <code>resolve</code>ï¼Œå¤±è´¥æ‰§è¡Œ <code>reject</code>ã€‚</p><p>å› ä¸ºå¼‚æ­¥ç»„ä»¶åŠ è½½æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œå®ƒæ¥ç€åˆåŒæ­¥æ‰§è¡Œäº†å¦‚ä¸‹é€»è¾‘ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  factory<span class="token punctuation">.</span>errorComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>error<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  factory<span class="token punctuation">.</span>loadingComp <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>loading<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>delay <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>delay <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span>
          <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">timeout (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token punctuation">.</span>timeout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms)</span><span class="token template-punctuation string">`</span></span>
          <span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…ˆåˆ¤æ–­ <code>res.error</code> æ˜¯å¦å®šä¹‰äº† error ç»„ä»¶ï¼Œå¦‚æœæœ‰çš„è¯åˆ™èµ‹å€¼ç»™ <code>factory.errorComp</code>ã€‚ æ¥ç€åˆ¤æ–­ <code>res.loading</code> æ˜¯å¦å®šä¹‰äº† loading ç»„ä»¶ï¼Œå¦‚æœæœ‰çš„è¯åˆ™èµ‹å€¼ç»™ <code>factory.loadingComp</code>ï¼Œå¦‚æœè®¾ç½®äº† <code>res.delay</code> ä¸”ä¸º 0ï¼Œåˆ™è®¾ç½® <code>factory.loading = true</code>ï¼Œå¦åˆ™å»¶æ—¶ <code>delay</code> çš„æ—¶é—´æ‰§è¡Œï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    factory<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ååˆ¤æ–­ <code>res.timeout</code>ï¼Œå¦‚æœé…ç½®äº†è¯¥é¡¹ï¼Œåˆ™åœ¨ <code>res.timout</code> æ—¶é—´åï¼Œå¦‚æœç»„ä»¶æ²¡æœ‰æˆåŠŸåŠ è½½ï¼Œæ‰§è¡Œ <code>reject</code>ã€‚</p><p>åœ¨ <code>resolveAsyncComponent</code> çš„æœ€åæœ‰ä¸€æ®µé€»è¾‘ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>sync <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">return</span> factory<span class="token punctuation">.</span>loading
  <span class="token operator">?</span> factory<span class="token punctuation">.</span>loadingComp
  <span class="token operator">:</span> factory<span class="token punctuation">.</span>resolved
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ <code>delay</code> é…ç½®ä¸º 0ï¼Œåˆ™è¿™æ¬¡ç›´æ¥æ¸²æŸ“ loading ç»„ä»¶ï¼Œå¦åˆ™åˆ™å»¶æ—¶ <code>delay</code> æ‰§è¡Œ <code>forceRender</code>ï¼Œé‚£ä¹ˆåˆä¼šå†ä¸€æ¬¡æ‰§è¡Œåˆ° <code>resolveAsyncComponent</code>ã€‚</p><p>é‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬æœ‰å‡ ç§æƒ…å†µï¼ŒæŒ‰é€»è¾‘çš„æ‰§è¡Œé¡ºåºï¼Œå¯¹ä¸åŒçš„æƒ…å†µåšåˆ¤æ–­ã€‚</p><h3 id="å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥</h3><p>å½“å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥ï¼Œä¼šæ‰§è¡Œ <code>reject</code> å‡½æ•°ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> reject <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to resolve async component: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">String</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token punctuation">(</span>reason <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\nReason: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    factory<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ—¶å€™ä¼šæŠŠ <code>factory.error</code> è®¾ç½®ä¸º <code>true</code>ï¼ŒåŒæ—¶æ‰§è¡Œ <code>forceRender()</code> å†æ¬¡æ‰§è¡Œåˆ° <code>resolveAsyncComponent</code>ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>errorComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>errorComp
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±è¿”å› <code>factory.errorComp</code>ï¼Œç›´æ¥æ¸²æŸ“ error ç»„ä»¶ã€‚</p><h3 id="å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸ</h3><p>å½“å¼‚æ­¥ç»„ä»¶åŠ è½½æˆåŠŸï¼Œä¼šæ‰§è¡Œ <code>resolve</code> å‡½æ•°ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> Object <span class="token operator">|</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  factory<span class="token punctuation">.</span>resolved <span class="token operator">=</span> <span class="token function">ensureCtor</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> baseCtor<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">forceRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆæŠŠåŠ è½½ç»“æœç¼“å­˜åˆ° <code>factory.resolved</code> ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å› ä¸º <code>sync</code> å·²ç»ä¸º falseï¼Œåˆ™æ‰§è¡Œ <code>forceRender()</code> å†æ¬¡æ‰§è¡Œåˆ° <code>resolveAsyncComponent</code>ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>resolved<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>resolved
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ç›´æ¥è¿”å› <code>factory.resolved</code>ï¼Œæ¸²æŸ“æˆåŠŸåŠ è½½çš„ç»„ä»¶ã€‚</p><h3 id="å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­</h3><p>å¦‚æœå¼‚æ­¥ç»„ä»¶åŠ è½½ä¸­å¹¶æœªè¿”å›ï¼Œè¿™æ—¶å€™ä¼šèµ°åˆ°è¿™ä¸ªé€»è¾‘ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span>loadingComp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span>loadingComp
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆåˆ™ä¼šè¿”å› <code>factory.loadingComp</code>ï¼Œæ¸²æŸ“ loading ç»„ä»¶ã€‚</p><h3 id="å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶åŠ è½½è¶…æ—¶</h3><p>å¦‚æœè¶…æ—¶ï¼Œåˆ™èµ°åˆ°äº† <code>reject</code> é€»è¾‘ï¼Œä¹‹åé€»è¾‘å’ŒåŠ è½½å¤±è´¥ä¸€æ ·ï¼Œæ¸²æŸ“ error ç»„ä»¶ã€‚</p><h2 id="å¼‚æ­¥ç»„ä»¶-patch" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶-patch" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶ patch</h2><p>å›åˆ° <code>createComponent</code> çš„é€»è¾‘ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Ctor <span class="token operator">=</span> <span class="token function">resolveAsyncComponent</span><span class="token punctuation">(</span>asyncFactory<span class="token punctuation">,</span> baseCtor<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Ctor <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createAsyncPlaceholder</span><span class="token punctuation">(</span>
    asyncFactory<span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    context<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
    tag
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œ <code>resolveAsyncComponent</code>ï¼Œé™¤éä½¿ç”¨é«˜çº§å¼‚æ­¥ç»„ä»¶ <code>0 delay</code> å»åˆ›å»ºäº†ä¸€ä¸ª loading ç»„ä»¶ï¼Œå¦åˆ™è¿”å›æ˜¯ <code>undefiend</code>ï¼Œæ¥ç€é€šè¿‡ <code>createAsyncPlaceholder</code> åˆ›å»ºä¸€ä¸ªæ³¨é‡ŠèŠ‚ç‚¹ä½œä¸ºå ä½ç¬¦ã€‚å®ƒçš„å®šä¹‰åœ¨ <code>src/core/vdom/helpers/resolve-async-components.js</code> ä¸­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createAsyncPlaceholder</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">factory</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token operator">?</span>string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token punctuation">{</span>
  <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">createEmptyVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  node<span class="token punctuation">.</span>asyncFactory <span class="token operator">=</span> factory
  node<span class="token punctuation">.</span>asyncMeta <span class="token operator">=</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> context<span class="token punctuation">,</span> children<span class="token punctuation">,</span> tag <span class="token punctuation">}</span>
  <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šå°±æ˜¯å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå ä½çš„æ³¨é‡Š VNodeï¼ŒåŒæ—¶æŠŠ <code>asyncFactory</code> å’Œ <code>asyncMeta</code> èµ‹å€¼ç»™å½“å‰ <code>vnode</code>ã€‚</p><p>å½“æ‰§è¡Œ <code>forceRender</code> çš„æ—¶å€™ï¼Œä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆä¼šå†ä¸€æ¬¡æ‰§è¡Œ <code>resolveAsyncComponent</code>ï¼Œè¿™æ—¶å€™å°±ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œå¯èƒ½è¿”å› loadingã€error æˆ–æˆåŠŸåŠ è½½çš„å¼‚æ­¥ç»„ä»¶ï¼Œè¿”å›å€¼ä¸ä¸º <code>undefined</code>ï¼Œå› æ­¤å°±èµ°æ­£å¸¸çš„ç»„ä»¶ <code>render</code>ã€<code>patch</code> è¿‡ç¨‹ï¼Œä¸ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æµç¨‹ä¸ä¸€æ ·ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯å­˜åœ¨æ–°æ—§ <code>vnode</code> çš„ï¼Œä¸‹ä¸€ç« æˆ‘ä¼šåˆ†æç»„ä»¶æ›´æ–°çš„ <code>patch</code> è¿‡ç¨‹ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>é€šè¿‡ä»¥ä¸Šä»£ç åˆ†æï¼Œæˆ‘ä»¬å¯¹ Vue çš„å¼‚æ­¥ç»„ä»¶çš„å®ç°æœ‰äº†æ·±å…¥çš„äº†è§£ï¼ŒçŸ¥é“äº† 3 ç§å¼‚æ­¥ç»„ä»¶çš„å®ç°æ–¹å¼ï¼Œå¹¶ä¸”çœ‹åˆ°é«˜çº§å¼‚æ­¥ç»„ä»¶çš„å®ç°æ˜¯éå¸¸å·§å¦™çš„ï¼Œå®ƒå®ç°äº† loadingã€resolveã€rejectã€timeout 4 ç§çŠ¶æ€ã€‚å¼‚æ­¥ç»„ä»¶å®ç°çš„æœ¬è´¨æ˜¯ 2 æ¬¡æ¸²æŸ“ï¼Œé™¤äº† 0 delay çš„é«˜çº§å¼‚æ­¥ç»„ä»¶ç¬¬ä¸€æ¬¡ç›´æ¥æ¸²æŸ“æˆ loading ç»„ä»¶å¤–ï¼Œå…¶å®ƒéƒ½æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ç”Ÿæˆä¸€ä¸ªæ³¨é‡ŠèŠ‚ç‚¹ï¼Œå½“å¼‚æ­¥è·å–ç»„ä»¶æˆåŠŸåï¼Œå†é€šè¿‡ <code>forceRender</code> å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼Œè¿™æ ·å°±èƒ½æ­£ç¡®æ¸²æŸ“å‡ºæˆ‘ä»¬å¼‚æ­¥åŠ è½½çš„ç»„ä»¶äº†ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/gongxho/gongxho.github.io/edit/main/src/vue2/components/async-component.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/8/29 09:14:21</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: gxh522@qq.com">googxh</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/vue2/components/component-register.html" class="nav-link prev" aria-label="ç»„ä»¶æ³¨å†Œ"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->ç»„ä»¶æ³¨å†Œ</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2022-present Mr.Googxh</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script src="/assets/js/runtime~app.cc44c0ce.js" defer></script><script src="/assets/js/31606.23ba15c3.js" defer></script><script src="/assets/js/app.0512e41a.js" defer></script>
  </body>
</html>
