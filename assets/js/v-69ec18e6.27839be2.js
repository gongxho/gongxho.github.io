"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[66663],{865:(n,e,s)=>{s.r(e),s.d(e,{default:()=>B});var a=s(78e3);const o=(0,a.uE)('<p>åœ¨<a href="/process/reconciler">æµç¨‹æ¦‚è§ˆä¸€èŠ‚</a>æˆ‘ä»¬äº†è§£ç»„ä»¶åœ¨<code>renderé˜¶æ®µ</code>ä¼šç»å†<code>beginWork</code>ä¸<code>completeWork</code>ã€‚</p><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²è§£äº†ç»„ä»¶æ‰§è¡Œ<code>beginWork</code>åä¼šåˆ›å»º<code>å­FiberèŠ‚ç‚¹</code>ï¼ŒèŠ‚ç‚¹ä¸Šå¯èƒ½å­˜åœ¨<code>effectTag</code>ã€‚</p><p>è¿™ä¸€èŠ‚è®©æˆ‘ä»¬çœ‹çœ‹<code>completeWork</code>ä¼šåšä»€ä¹ˆå·¥ä½œã€‚</p>',3),t=(0,a.Uk)("ä½ å¯ä»¥ä»"),p={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L673",target:"_blank",rel:"noopener noreferrer"},c=(0,a.Uk)("è¿™é‡Œ"),r=(0,a.Uk)("çœ‹åˆ°"),l=(0,a._)("code",null,"completeWork",-1),i=(0,a.Uk)("æ–¹æ³•å®šä¹‰ã€‚"),d=(0,a.uE)('<h2 id="æµç¨‹æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#æµç¨‹æ¦‚è§ˆ" aria-hidden="true">#</a> æµç¨‹æ¦‚è§ˆ</h2><p>ç±»ä¼¼<code>beginWork</code>ï¼Œ<code>completeWork</code>ä¹Ÿæ˜¯é’ˆå¯¹ä¸åŒ<code>fiber.tag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">completeWork</span><span class="token punctuation">(</span>\n  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>\n  <span class="token literal-property property">renderLanes</span><span class="token operator">:</span> Lanes<span class="token punctuation">,</span></span>\n<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> newProps <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>pendingProps<span class="token punctuation">;</span>\n\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">IndeterminateComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">LazyComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">SimpleMemoComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">FunctionComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">ForwardRef</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">Fragment</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">Mode</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">Profiler</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">ContextConsumer</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">MemoComponent</span><span class="token operator">:</span>\n      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">ClassComponent</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...çœç•¥</span>\n      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">HostRoot</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...çœç•¥</span>\n      <span class="token function">updateHostContainer</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...çœç•¥</span>\n      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token comment">// ...çœç•¥</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨é¡µé¢æ¸²æŸ“æ‰€å¿…é¡»çš„<code>HostComponent</code>ï¼ˆå³åŸç”Ÿ<code>DOMç»„ä»¶</code>å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>ï¼‰ï¼Œå…¶ä»–ç±»å‹<code>Fiber</code>çš„å¤„ç†ç•™åœ¨å…·ä½“åŠŸèƒ½å®ç°æ—¶è®²è§£ã€‚</p><h2 id="å¤„ç†hostcomponent" tabindex="-1"><a class="header-anchor" href="#å¤„ç†hostcomponent" aria-hidden="true">#</a> å¤„ç†HostComponent</h2><p>å’Œ<code>beginWork</code>ä¸€æ ·ï¼Œæˆ‘ä»¬æ ¹æ®<code>current === null ?</code>åˆ¤æ–­æ˜¯<code>mount</code>è¿˜æ˜¯<code>update</code>ã€‚</p><p>åŒæ—¶é’ˆå¯¹<code>HostComponent</code>ï¼Œåˆ¤æ–­<code>update</code>æ—¶æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘<code>workInProgress.stateNode != null ?</code>ï¼ˆå³è¯¥<code>FiberèŠ‚ç‚¹</code>æ˜¯å¦å­˜åœ¨å¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code>ï¼‰</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token function">popHostContext</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> rootContainerInstance <span class="token operator">=</span> <span class="token function">getRootHostContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> type <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>type<span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> workInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// updateçš„æƒ…å†µ</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// mountçš„æƒ…å†µ</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="updateæ—¶" tabindex="-1"><a class="header-anchor" href="#updateæ—¶" aria-hidden="true">#</a> updateæ—¶</h2><p>å½“<code>update</code>æ—¶ï¼Œ<code>FiberèŠ‚ç‚¹</code>å·²ç»å­˜åœ¨å¯¹åº”<code>DOMèŠ‚ç‚¹</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦ç”Ÿæˆ<code>DOMèŠ‚ç‚¹</code>ã€‚éœ€è¦åšçš„ä¸»è¦æ˜¯å¤„ç†<code>props</code>ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>onClick</code>ã€<code>onChange</code>ç­‰å›è°ƒå‡½æ•°çš„æ³¨å†Œ</li><li>å¤„ç†<code>style prop</code></li><li>å¤„ç†<code>DANGEROUSLY_SET_INNER_HTML prop</code></li><li>å¤„ç†<code>children prop</code></li></ul><p>æˆ‘ä»¬å»æ‰ä¸€äº›å½“å‰ä¸éœ€è¦å…³æ³¨çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚<code>ref</code>ï¼‰ã€‚å¯ä»¥çœ‹åˆ°æœ€ä¸»è¦çš„é€»è¾‘æ˜¯è°ƒç”¨<code>updateHostComponent</code>æ–¹æ³•ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> workInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// updateçš„æƒ…å†µ</span>\n  <span class="token function">updateHostComponent</span><span class="token punctuation">(</span>\n    current<span class="token punctuation">,</span>\n    workInProgress<span class="token punctuation">,</span>\n    type<span class="token punctuation">,</span>\n    newProps<span class="token punctuation">,</span>\n    rootContainerInstance<span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',13),u=(0,a.Uk)("ä½ å¯ä»¥ä»"),k={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L225",target:"_blank",rel:"noopener noreferrer"},m=(0,a.Uk)("è¿™é‡Œ"),v=(0,a.Uk)("çœ‹åˆ°"),b=(0,a._)("code",null,"updateHostComponent",-1),f=(0,a.Uk)("æ–¹æ³•å®šä¹‰ã€‚"),g=(0,a.uE)('<p>åœ¨<code>updateHostComponent</code>å†…éƒ¨ï¼Œè¢«å¤„ç†å®Œçš„<code>props</code>ä¼šè¢«èµ‹å€¼ç»™<code>workInProgress.updateQueue</code>ï¼Œå¹¶æœ€ç»ˆä¼šåœ¨<code>commité˜¶æ®µ</code>è¢«æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>workInProgress<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">(</span>updatePayload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä¸­<code>updatePayload</code>ä¸ºæ•°ç»„å½¢å¼ï¼Œä»–çš„å¶æ•°ç´¢å¼•çš„å€¼ä¸ºå˜åŒ–çš„<code>prop key</code>ï¼Œå¥‡æ•°ç´¢å¼•çš„å€¼ä¸ºå˜åŒ–çš„<code>prop value</code>ã€‚</p>',3),y=(0,a.Uk)("å…·ä½“æ¸²æŸ“è¿‡ç¨‹è§"),h=(0,a.Uk)("mutationé˜¶æ®µä¸€èŠ‚"),w={class:"custom-container details"},C=(0,a.uE)("<summary>updatePayloadå±æ€§ Demo</summary><p><code>updateHostComponent</code>æ–¹æ³•å†…æ‰“å°äº†<code>FiberèŠ‚ç‚¹</code>å¯¹åº”çš„<code>type</code>ä¸<code>updatePayload</code>ã€‚</p><p>ä½ å¯ä»¥ç›´è§‚çš„æ„Ÿå—<code>updatePayload</code>çš„æ•°æ®ç»“æ„</p>",3),W=(0,a.Uk)("å…³æ³¨å…¬ä¼—å·"),_=(0,a.Uk)("ï¼Œåå°å›å¤"),P=(0,a._)("strong",null,"431",-1),F=(0,a.Uk)("è·å¾—åœ¨çº¿Demoåœ°å€"),x=(0,a.uE)('<h2 id="mountæ—¶" tabindex="-1"><a class="header-anchor" href="#mountæ—¶" aria-hidden="true">#</a> mountæ—¶</h2><p>åŒæ ·ï¼Œæˆ‘ä»¬çœç•¥äº†ä¸ç›¸å…³çš„é€»è¾‘ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<code>mount</code>æ—¶çš„ä¸»è¦é€»è¾‘åŒ…æ‹¬ä¸‰ä¸ªï¼š</p><ul><li>ä¸º<code>FiberèŠ‚ç‚¹</code>ç”Ÿæˆå¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code></li><li>å°†å­å­™<code>DOMèŠ‚ç‚¹</code>æ’å…¥åˆšç”Ÿæˆçš„<code>DOMèŠ‚ç‚¹</code>ä¸­</li><li>ä¸<code>update</code>é€»è¾‘ä¸­çš„<code>updateHostComponent</code>ç±»ä¼¼çš„å¤„ç†<code>props</code>çš„è¿‡ç¨‹</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// mountçš„æƒ…å†µ</span>\n\n<span class="token comment">// ...çœç•¥æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³é€»è¾‘</span>\n\n<span class="token keyword">const</span> currentHostContext <span class="token operator">=</span> <span class="token function">getHostContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ä¸ºfiberåˆ›å»ºå¯¹åº”DOMèŠ‚ç‚¹</span>\n<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">createInstance</span><span class="token punctuation">(</span>\n    type<span class="token punctuation">,</span>\n    newProps<span class="token punctuation">,</span>\n    rootContainerInstance<span class="token punctuation">,</span>\n    currentHostContext<span class="token punctuation">,</span>\n    workInProgress<span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// å°†å­å­™DOMèŠ‚ç‚¹æ’å…¥åˆšç”Ÿæˆçš„DOMèŠ‚ç‚¹ä¸­</span>\n<span class="token function">appendAllChildren</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> workInProgress<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// DOMèŠ‚ç‚¹èµ‹å€¼ç»™fiber.stateNode</span>\nworkInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">=</span> instance<span class="token punctuation">;</span>\n\n<span class="token comment">// ä¸updateé€»è¾‘ä¸­çš„updateHostComponentç±»ä¼¼çš„å¤„ç†propsçš„è¿‡ç¨‹</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>\n  <span class="token function">finalizeInitialChildren</span><span class="token punctuation">(</span>\n    instance<span class="token punctuation">,</span>\n    type<span class="token punctuation">,</span>\n    newProps<span class="token punctuation">,</span>\n    rootContainerInstance<span class="token punctuation">,</span>\n    currentHostContext<span class="token punctuation">,</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">markUpdate</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',4),U=(0,a.Uk)("è¿˜è®°å¾—"),I=(0,a.Uk)("ä¸Šä¸€èŠ‚"),D=(0,a.uE)("æˆ‘ä»¬è®²åˆ°ï¼š<code>mount</code>æ—¶åªä¼šåœ¨<code>rootFiber</code>å­˜åœ¨<code>Placement effectTag</code>ã€‚é‚£ä¹ˆ<code>commité˜¶æ®µ</code>æ˜¯å¦‚ä½•é€šè¿‡ä¸€æ¬¡æ’å…¥<code>DOM</code>æ“ä½œï¼ˆå¯¹åº”ä¸€ä¸ª<code>Placement effectTag</code>ï¼‰å°†æ•´æ£µ<code>DOMæ ‘</code>æ’å…¥é¡µé¢çš„å‘¢ï¼Ÿ",15),j=(0,a.uE)('<p>åŸå› å°±åœ¨äº<code>completeWork</code>ä¸­çš„<code>appendAllChildren</code>æ–¹æ³•ã€‚</p><p>ç”±äº<code>completeWork</code>å±äºâ€œå½’â€é˜¶æ®µè°ƒç”¨çš„å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨<code>appendAllChildren</code>æ—¶éƒ½ä¼šå°†å·²ç”Ÿæˆçš„å­å­™<code>DOMèŠ‚ç‚¹</code>æ’å…¥å½“å‰ç”Ÿæˆçš„<code>DOMèŠ‚ç‚¹</code>ä¸‹ã€‚é‚£ä¹ˆå½“â€œå½’â€åˆ°<code>rootFiber</code>æ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæ„å»ºå¥½çš„ç¦»å±<code>DOMæ ‘</code>ã€‚</p><h2 id="effectlist" tabindex="-1"><a class="header-anchor" href="#effectlist" aria-hidden="true">#</a> effectList</h2><p>è‡³æ­¤<code>renderé˜¶æ®µ</code>çš„ç»å¤§éƒ¨åˆ†å·¥ä½œå°±å®Œæˆäº†ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šä½œä¸º<code>DOM</code>æ“ä½œçš„ä¾æ®ï¼Œ<code>commité˜¶æ®µ</code>éœ€è¦æ‰¾åˆ°æ‰€æœ‰æœ‰<code>effectTag</code>çš„<code>FiberèŠ‚ç‚¹</code>å¹¶ä¾æ¬¡æ‰§è¡Œ<code>effectTag</code>å¯¹åº”æ“ä½œã€‚éš¾é“éœ€è¦åœ¨<code>commité˜¶æ®µ</code>å†éå†ä¸€æ¬¡<code>Fiberæ ‘</code>å¯»æ‰¾<code>effectTag !== null</code>çš„<code>FiberèŠ‚ç‚¹</code>ä¹ˆï¼Ÿ</p><p>è¿™æ˜¾ç„¶æ˜¯å¾ˆä½æ•ˆçš„ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨<code>completeWork</code>çš„ä¸Šå±‚å‡½æ•°<code>completeUnitOfWork</code>ä¸­ï¼Œæ¯ä¸ªæ‰§è¡Œå®Œ<code>completeWork</code>ä¸”å­˜åœ¨<code>effectTag</code>çš„<code>FiberèŠ‚ç‚¹</code>ä¼šè¢«ä¿å­˜åœ¨ä¸€æ¡è¢«ç§°ä¸º<code>effectList</code>çš„å•å‘é“¾è¡¨ä¸­ã€‚</p><p><code>effectList</code>ä¸­ç¬¬ä¸€ä¸ª<code>FiberèŠ‚ç‚¹</code>ä¿å­˜åœ¨<code>fiber.firstEffect</code>ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¿å­˜åœ¨<code>fiber.lastEffect</code>ã€‚</p><p>ç±»ä¼¼<code>appendAllChildren</code>ï¼Œåœ¨â€œå½’â€é˜¶æ®µï¼Œæ‰€æœ‰æœ‰<code>effectTag</code>çš„<code>FiberèŠ‚ç‚¹</code>éƒ½ä¼šè¢«è¿½åŠ åœ¨<code>effectList</code>ä¸­ï¼Œæœ€ç»ˆå½¢æˆä¸€æ¡ä»¥<code>rootFiber.firstEffect</code>ä¸ºèµ·ç‚¹çš„å•å‘é“¾è¡¨ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>                       nextEffect         nextEffect\nrootFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> fiber <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">&gt;</span> fiber\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œåœ¨<code>commité˜¶æ®µ</code>åªéœ€è¦éå†<code>effectList</code>å°±èƒ½æ‰§è¡Œæ‰€æœ‰<code>effect</code>äº†ã€‚</p>',11),H=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),O={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1744",target:"_blank",rel:"noopener noreferrer"},M=(0,a.Uk)("è¿™é‡Œ"),L=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç é€»è¾‘ã€‚"),E=(0,a.uE)('<p>å€Ÿç”¨<code>React</code>å›¢é˜Ÿæˆå‘˜<strong>Dan Abramov</strong>çš„è¯ï¼š<code>effectList</code>ç›¸è¾ƒäº<code>Fiberæ ‘</code>ï¼Œå°±åƒåœ£è¯æ ‘ä¸ŠæŒ‚çš„é‚£ä¸€ä¸²å½©ç¯ã€‚</p><h2 id="æµç¨‹ç»“å°¾" tabindex="-1"><a class="header-anchor" href="#æµç¨‹ç»“å°¾" aria-hidden="true">#</a> æµç¨‹ç»“å°¾</h2><p>è‡³æ­¤ï¼Œ<code>renderé˜¶æ®µ</code>å…¨éƒ¨å·¥ä½œå®Œæˆã€‚åœ¨<code>performSyncWorkOnRoot</code>å‡½æ•°ä¸­<code>fiberRootNode</code>è¢«ä¼ é€’ç»™<code>commitRoot</code>æ–¹æ³•ï¼Œå¼€å¯<code>commité˜¶æ®µ</code>å·¥ä½œæµç¨‹ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">commitRoot</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>',4),R=(0,a.Uk)("ä»£ç è§"),T={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1107",target:"_blank",rel:"noopener noreferrer"},N=(0,a.Uk)("è¿™é‡Œ"),S=(0,a.Uk)("ã€‚"),z=(0,a._)("h2",{id:"å‚è€ƒèµ„æ–™",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#å‚è€ƒèµ„æ–™","aria-hidden":"true"},"#"),(0,a.Uk)(" å‚è€ƒèµ„æ–™")],-1),A=(0,a._)("p",null,[(0,a._)("code",null,"completeWork"),(0,a.Uk)("æµç¨‹å›¾")],-1),Z=["src"],q={},B=(0,s(13860).Z)(q,[["render",function(n,e){const s=(0,a.up)("ExternalLinkIcon"),q=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.iD)("div",null,[o,(0,a._)("p",null,[t,(0,a._)("a",p,[c,(0,a.Wm)(s)]),r,l,i]),d,(0,a._)("p",null,[u,(0,a._)("a",k,[m,(0,a.Wm)(s)]),v,b,f]),g,(0,a._)("blockquote",null,[(0,a._)("p",null,[y,(0,a.Wm)(q,{to:"/react/renderer/mutation.html#hostcomponent-mutation"},{default:(0,a.w5)((()=>[h])),_:1})])]),(0,a._)("details",w,[C,(0,a._)("p",null,[(0,a.Wm)(q,{to:"/react/me.html"},{default:(0,a.w5)((()=>[W])),_:1}),_,P,F])]),x,(0,a._)("p",null,[U,(0,a.Wm)(q,{to:"/react/process/beginWork.html#effecttag"},{default:(0,a.w5)((()=>[I])),_:1}),D]),j,(0,a._)("p",null,[H,(0,a._)("a",O,[M,(0,a.Wm)(s)]),L]),E,(0,a._)("p",null,[R,(0,a._)("a",T,[N,(0,a.Wm)(s)]),S]),z,A,(0,a._)("img",{src:n.$withBase("/img/completeWork.png"),alt:"completeWorkæµç¨‹å›¾"},null,8,Z)])}]])},13860:(n,e)=>{e.Z=(n,e)=>{const s=n.__vccOpts||n;for(const[n,a]of e)s[n]=a;return s}},63971:(n,e,s)=>{s.r(e),s.d(e,{data:()=>a});const a=JSON.parse('{"key":"v-69ec18e6","path":"/react/process/completeWork.html","title":"completeWork","lang":"zh-CN","frontmatter":{"title":"completeWork","author":"BetaSu","tag":["React"],"summary":"åœ¨æµç¨‹æ¦‚è§ˆä¸€èŠ‚æˆ‘ä»¬äº†è§£ç»„ä»¶åœ¨renderé˜¶æ®µä¼šç»å†beginWorkä¸completeWorkã€‚ ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²è§£äº†ç»„ä»¶æ‰§è¡ŒbeginWorkåä¼šåˆ›å»ºå­FiberèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸Šå¯èƒ½å­˜åœ¨effectTagã€‚ è¿™ä¸€èŠ‚è®©æˆ‘ä»¬çœ‹çœ‹completeWorkä¼šåšä»€ä¹ˆå·¥ä½œã€‚ ä½ å¯ä»¥ä»è¿™é‡Œçœ‹åˆ°completeWorkæ–¹æ³•å®šä¹‰ã€‚ æµç¨‹æ¦‚è§ˆ ç±»ä¼¼beginWorkï¼Œcomplete","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/process/completeWork.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"completeWork"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"æµç¨‹æ¦‚è§ˆ","slug":"æµç¨‹æ¦‚è§ˆ","children":[]},{"level":2,"title":"å¤„ç†HostComponent","slug":"å¤„ç†hostcomponent","children":[]},{"level":2,"title":"updateæ—¶","slug":"updateæ—¶","children":[]},{"level":2,"title":"mountæ—¶","slug":"mountæ—¶","children":[]},{"level":2,"title":"effectList","slug":"effectlist","children":[]},{"level":2,"title":"æµç¨‹ç»“å°¾","slug":"æµç¨‹ç»“å°¾","children":[]},{"level":2,"title":"å‚è€ƒèµ„æ–™","slug":"å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":4.15,"words":1244},"filePathRelative":"react/process/completeWork.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);