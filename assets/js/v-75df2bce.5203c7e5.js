"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[41348],{55195:(e,a,n)=>{n.r(a),n.d(a,{default:()=>z});var s=n(60329);const o=(0,s.uE)('<p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæç®€çš„<code>useState</code>ï¼Œäº†è§£äº†<code>Hooks</code>çš„è¿è¡ŒåŸç†ã€‚</p><p>æœ¬èŠ‚æˆ‘ä»¬è®²è§£<code>Hooks</code>çš„æ•°æ®ç»“æ„ï¼Œä¸ºåé¢ä»‹ç»å…·ä½“çš„<code>hook</code>æ‰“ä¸‹åŸºç¡€ã€‚</p><h2 id="dispatcher" tabindex="-1"><a class="header-anchor" href="#dispatcher" aria-hidden="true">#</a> dispatcher</h2><p>åœ¨ä¸Šä¸€èŠ‚çš„æç®€<code>useState</code>å®ç°ä¸­ï¼Œä½¿ç”¨<code>isMount</code>å˜é‡åŒºåˆ†<code>mount</code>ä¸<code>update</code>ã€‚</p><p>åœ¨çœŸå®çš„<code>Hooks</code>ä¸­ï¼Œç»„ä»¶<code>mount</code>æ—¶çš„<code>hook</code>ä¸<code>update</code>æ—¶çš„<code>hook</code>æ¥æºäºä¸åŒçš„å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡åœ¨æºç ä¸­è¢«ç§°ä¸º<code>dispatcher</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// mountæ—¶çš„Dispatcher</span>\n<span class="token keyword">const</span> <span class="token literal-property property">HooksDispatcherOnMount</span><span class="token operator">:</span> Dispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">useCallback</span><span class="token operator">:</span> mountCallback<span class="token punctuation">,</span>\n  <span class="token literal-property property">useContext</span><span class="token operator">:</span> readContext<span class="token punctuation">,</span>\n  <span class="token literal-property property">useEffect</span><span class="token operator">:</span> mountEffect<span class="token punctuation">,</span>\n  <span class="token literal-property property">useImperativeHandle</span><span class="token operator">:</span> mountImperativeHandle<span class="token punctuation">,</span>\n  <span class="token literal-property property">useLayoutEffect</span><span class="token operator">:</span> mountLayoutEffect<span class="token punctuation">,</span>\n  <span class="token literal-property property">useMemo</span><span class="token operator">:</span> mountMemo<span class="token punctuation">,</span>\n  <span class="token literal-property property">useReducer</span><span class="token operator">:</span> mountReducer<span class="token punctuation">,</span>\n  <span class="token literal-property property">useRef</span><span class="token operator">:</span> mountRef<span class="token punctuation">,</span>\n  <span class="token literal-property property">useState</span><span class="token operator">:</span> mountState<span class="token punctuation">,</span>\n  <span class="token comment">// ...çœç•¥</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// updateæ—¶çš„Dispatcher</span>\n<span class="token keyword">const</span> <span class="token literal-property property">HooksDispatcherOnUpdate</span><span class="token operator">:</span> Dispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">useCallback</span><span class="token operator">:</span> updateCallback<span class="token punctuation">,</span>\n  <span class="token literal-property property">useContext</span><span class="token operator">:</span> readContext<span class="token punctuation">,</span>\n  <span class="token literal-property property">useEffect</span><span class="token operator">:</span> updateEffect<span class="token punctuation">,</span>\n  <span class="token literal-property property">useImperativeHandle</span><span class="token operator">:</span> updateImperativeHandle<span class="token punctuation">,</span>\n  <span class="token literal-property property">useLayoutEffect</span><span class="token operator">:</span> updateLayoutEffect<span class="token punctuation">,</span>\n  <span class="token literal-property property">useMemo</span><span class="token operator">:</span> updateMemo<span class="token punctuation">,</span>\n  <span class="token literal-property property">useReducer</span><span class="token operator">:</span> updateReducer<span class="token punctuation">,</span>\n  <span class="token literal-property property">useRef</span><span class="token operator">:</span> updateRef<span class="token punctuation">,</span>\n  <span class="token literal-property property">useState</span><span class="token operator">:</span> updateState<span class="token punctuation">,</span>\n  <span class="token comment">// ...çœç•¥</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§ï¼Œ<code>mount</code>æ—¶è°ƒç”¨çš„<code>hook</code>å’Œ<code>update</code>æ—¶è°ƒç”¨çš„<code>hook</code>å…¶å®æ˜¯ä¸¤ä¸ªä¸åŒçš„å‡½æ•°ã€‚</p><p>åœ¨<code>FunctionComponent</code> <code>render</code>å‰ï¼Œä¼šæ ¹æ®<code>FunctionComponent</code>å¯¹åº”<code>fiber</code>çš„ä»¥ä¸‹æ¡ä»¶åŒºåˆ†<code>mount</code>ä¸<code>update</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>current <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> current<span class="token punctuation">.</span>memoizedState <span class="token operator">===</span> <span class="token keyword">null</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¹¶å°†ä¸åŒæƒ…å†µå¯¹åº”çš„<code>dispatcher</code>èµ‹å€¼ç»™å…¨å±€å˜é‡<code>ReactCurrentDispatcher</code>çš„<code>current</code>å±æ€§ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>ReactCurrentDispatcher<span class="token punctuation">.</span>current <span class="token operator">=</span>\n      current <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> current<span class="token punctuation">.</span>memoizedState <span class="token operator">===</span> <span class="token keyword">null</span>\n        <span class="token operator">?</span> HooksDispatcherOnMount\n        <span class="token operator">:</span> HooksDispatcherOnUpdate<span class="token punctuation">;</span>  \n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',11),t={href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L409",target:"_blank",rel:"noopener noreferrer"},p=(0,s.uE)("<p>åœ¨<code>FunctionComponent</code> <code>render</code>æ—¶ï¼Œä¼šä»<code>ReactCurrentDispatcher.current</code>ï¼ˆå³å½“å‰<code>dispatcher</code>ï¼‰ä¸­å¯»æ‰¾éœ€è¦çš„<code>hook</code>ã€‚</p><p>æ¢è¨€ä¹‹ï¼Œä¸åŒçš„è°ƒç”¨æ ˆä¸Šä¸‹æ–‡ä¸º<code>ReactCurrentDispatcher.current</code>èµ‹å€¼ä¸åŒçš„<code>dispatcher</code>ï¼Œåˆ™<code>FunctionComponent</code> <code>render</code>æ—¶è°ƒç”¨çš„<code>hook</code>ä¹Ÿæ˜¯ä¸åŒçš„å‡½æ•°ã€‚</p>",2),c=(0,s._)("code",null,"dispatcher",-1),r={href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L1775",target:"_blank",rel:"noopener noreferrer"},l=(0,s._)("code",null,"dispatcher",-1),d=(0,s.uE)('<h2 id="ä¸€ä¸ªdispatcherä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸ªdispatcherä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> ä¸€ä¸ªdispatcherä½¿ç”¨åœºæ™¯</h2><p>å½“é”™è¯¯çš„ä¹¦å†™äº†åµŒå¥—å½¢å¼çš„<code>hook</code>ï¼Œå¦‚ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶<code>ReactCurrentDispatcher.current</code>å·²ç»æŒ‡å‘<code>ContextOnlyDispatcher</code>ï¼Œæ‰€ä»¥è°ƒç”¨<code>useState</code>å®é™…ä¼šè°ƒç”¨<code>throwInvalidHookError</code>ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">ContextOnlyDispatcher</span><span class="token operator">:</span> Dispatcher <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">useCallback</span><span class="token operator">:</span> throwInvalidHookError<span class="token punctuation">,</span>\n  <span class="token literal-property property">useContext</span><span class="token operator">:</span> throwInvalidHookError<span class="token punctuation">,</span>\n  <span class="token literal-property property">useEffect</span><span class="token operator">:</span> throwInvalidHookError<span class="token punctuation">,</span>\n  <span class="token literal-property property">useImperativeHandle</span><span class="token operator">:</span> throwInvalidHookError<span class="token punctuation">,</span>\n  <span class="token literal-property property">useLayoutEffect</span><span class="token operator">:</span> throwInvalidHookError<span class="token punctuation">,</span>\n  <span class="token comment">// ...çœç•¥</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),i={href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L458",target:"_blank",rel:"noopener noreferrer"},u=(0,s.uE)('<h2 id="hookçš„æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#hookçš„æ•°æ®ç»“æ„" aria-hidden="true">#</a> Hookçš„æ•°æ®ç»“æ„</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ <code>hook</code>çš„æ•°æ®ç»“æ„ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token literal-property property">hook</span><span class="token operator">:</span> Hook <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n\n  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">queue</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n\n  <span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',3),k={href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L546",target:"_blank",rel:"noopener noreferrer"},m=(0,s._)("code",null,"hook",-1),v=(0,s._)("code",null,"memoizedState",-1),b=(0,s.uE)('<h2 id="memoizedstate" tabindex="-1"><a class="header-anchor" href="#memoizedstate" aria-hidden="true">#</a> memoizedState</h2><div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p><code>hook</code>ä¸<code>FunctionComponent fiber</code>éƒ½å­˜åœ¨<code>memoizedState</code>å±æ€§ï¼Œä¸è¦æ··æ·†ä»–ä»¬çš„æ¦‚å¿µã€‚</p><ul><li><p><code>fiber.memoizedState</code>ï¼š<code>FunctionComponent</code>å¯¹åº”<code>fiber</code>ä¿å­˜çš„<code>Hooks</code>é“¾è¡¨ã€‚</p></li><li><p><code>hook.memoizedState</code>ï¼š<code>Hooks</code>é“¾è¡¨ä¸­ä¿å­˜çš„å•ä¸€<code>hook</code>å¯¹åº”çš„æ•°æ®ã€‚</p></li></ul></div><p>ä¸åŒç±»å‹<code>hook</code>çš„<code>memoizedState</code>ä¿å­˜ä¸åŒç±»å‹æ•°æ®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>',3),h=(0,s.uE)("<li><p>useStateï¼šå¯¹äº<code>const [state, updateState] = useState(initialState)</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>state</code>çš„å€¼</p></li><li><p>useReducerï¼šå¯¹äº<code>const [state, dispatch] = useReducer(reducer, {});</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>state</code>çš„å€¼</p></li>",2),y=(0,s._)("code",null,"memoizedState",-1),f=(0,s._)("code",null,"useEffectå›è°ƒå‡½æ•°",-1),g=(0,s._)("code",null,"ä¾èµ–é¡¹",-1),_=(0,s._)("code",null,"effect",-1),S={href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L1181",target:"_blank",rel:"noopener noreferrer"},H=(0,s._)("code",null,"effect",-1),U=(0,s._)("code",null,"effect",-1),w=(0,s._)("code",null,"fiber.updateQueue",-1),C=(0,s.uE)("<li><p>useRefï¼šå¯¹äº<code>useRef(1)</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>{current: 1}</code></p></li><li><p>useMemoï¼šå¯¹äº<code>useMemo(callback, [depA])</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>[callback(), depA]</code></p></li><li><p>useCallbackï¼šå¯¹äº<code>useCallback(callback, [depA])</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>[callback, depA]</code>ã€‚ä¸<code>useMemo</code>çš„åŒºåˆ«æ˜¯ï¼Œ<code>useCallback</code>ä¿å­˜çš„æ˜¯<code>callback</code>å‡½æ•°æœ¬èº«ï¼Œè€Œ<code>useMemo</code>ä¿å­˜çš„æ˜¯<code>callback</code>å‡½æ•°çš„æ‰§è¡Œç»“æœ</p></li>",3),E=(0,s._)("p",null,[(0,s.Uk)("æœ‰äº›"),(0,s._)("code",null,"hook"),(0,s.Uk)("æ˜¯æ²¡æœ‰"),(0,s._)("code",null,"memoizedState"),(0,s.Uk)("çš„ï¼Œæ¯”å¦‚ï¼š")],-1),R=(0,s._)("ul",null,[(0,s._)("li",null,"useContext")],-1),x={},z=(0,n(13860).Z)(x,[["render",function(e,a){const n=(0,s.up)("ExternalLinkIcon"),x=(0,s.up)("RouterLink");return(0,s.wg)(),(0,s.iD)("div",null,[o,(0,s.kq)(" react17-alpha "),(0,s._)("blockquote",null,[(0,s._)("p",null,[(0,s.Uk)("ä½ å¯ä»¥åœ¨"),(0,s._)("a",t,[(0,s.Uk)("è¿™é‡Œ"),(0,s.Wm)(n)]),(0,s.Uk)("çœ‹åˆ°è¿™è¡Œä»£ç ")])]),p,(0,s._)("blockquote",null,[(0,s._)("p",null,[(0,s.Uk)("é™¤äº†è¿™ä¸¤ä¸ª"),c,(0,s.Uk)("ï¼Œä½ å¯ä»¥åœ¨"),(0,s._)("a",r,[(0,s.Uk)("è¿™é‡Œ"),(0,s.Wm)(n)]),(0,s.Uk)("çœ‹åˆ°å…¶ä»–"),l,(0,s.Uk)("å®šä¹‰")])]),d,(0,s._)("blockquote",null,[(0,s._)("p",null,[(0,s.Uk)("ä½ å¯ä»¥åœ¨"),(0,s._)("a",i,[(0,s.Uk)("è¿™é‡Œ"),(0,s.Wm)(n)]),(0,s.Uk)("çœ‹åˆ°è¿™æ®µé€»è¾‘")])]),u,(0,s._)("blockquote",null,[(0,s._)("p",null,[(0,s.Uk)("ä½ å¯ä»¥åœ¨"),(0,s._)("a",k,[(0,s.Uk)("è¿™é‡Œ"),(0,s.Wm)(n)]),(0,s.Uk)("çœ‹åˆ°åˆ›å»º"),m,(0,s.Uk)("çš„é€»è¾‘")])]),(0,s._)("p",null,[(0,s.Uk)("å…¶ä¸­é™¤"),v,(0,s.Uk)("ä»¥å¤–å­—æ®µçš„æ„ä¹‰ä¸ä¸Šä¸€ç« ä»‹ç»çš„"),(0,s.Wm)(x,{to:"/react/state/update.html#updatequeue"},{default:(0,s.w5)((()=>[(0,s.Uk)("updateQueue")])),_:1}),(0,s.Uk)("ç±»ä¼¼ã€‚")]),b,(0,s._)("ul",null,[h,(0,s._)("li",null,[(0,s._)("p",null,[(0,s.Uk)("useEffectï¼š"),y,(0,s.Uk)("ä¿å­˜åŒ…å«"),f,(0,s.Uk)("ã€"),g,(0,s.Uk)("ç­‰çš„é“¾è¡¨æ•°æ®ç»“æ„"),_,(0,s.Uk)("ï¼Œä½ å¯ä»¥åœ¨"),(0,s._)("a",S,[(0,s.Uk)("è¿™é‡Œ"),(0,s.Wm)(n)]),(0,s.Uk)("çœ‹åˆ°"),H,(0,s.Uk)("çš„åˆ›å»ºè¿‡ç¨‹ã€‚"),U,(0,s.Uk)("é“¾è¡¨åŒæ—¶ä¼šä¿å­˜åœ¨"),w,(0,s.Uk)("ä¸­")])]),C]),E,R])}]])},13860:(e,a)=>{a.Z=(e,a)=>{const n=e.__vccOpts||e;for(const[e,s]of a)n[e]=s;return n}},76494:(e,a,n)=>{n.r(a),n.d(a,{data:()=>s});const s=JSON.parse('{"key":"v-75df2bce","path":"/react/hooks/structure.html","title":"Hooksæ•°æ®ç»“æ„","lang":"zh-CN","frontmatter":{"title":"Hooksæ•°æ®ç»“æ„","author":"BetaSu","tag":["React"],"summary":"åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæç®€çš„useStateï¼Œäº†è§£äº†Hooksçš„è¿è¡ŒåŸç†ã€‚ æœ¬èŠ‚æˆ‘ä»¬è®²è§£Hooksçš„æ•°æ®ç»“æ„ï¼Œä¸ºåé¢ä»‹ç»å…·ä½“çš„hookæ‰“ä¸‹åŸºç¡€ã€‚ dispatcher åœ¨ä¸Šä¸€èŠ‚çš„æç®€useStateå®ç°ä¸­ï¼Œä½¿ç”¨isMountå˜é‡åŒºåˆ†mountä¸updateã€‚ åœ¨çœŸå®çš„Hooksä¸­ï¼Œç»„ä»¶mountæ—¶çš„hookä¸updateæ—¶çš„hookæ¥æºäºä¸åŒçš„å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/hooks/structure.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğ‘”ğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"Hooksæ•°æ®ç»“æ„"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"dispatcher","slug":"dispatcher","children":[]},{"level":2,"title":"ä¸€ä¸ªdispatcherä½¿ç”¨åœºæ™¯","slug":"ä¸€ä¸ªdispatcherä½¿ç”¨åœºæ™¯","children":[]},{"level":2,"title":"Hookçš„æ•°æ®ç»“æ„","slug":"hookçš„æ•°æ®ç»“æ„","children":[]},{"level":2,"title":"memoizedState","slug":"memoizedstate","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":2.54,"words":763},"filePathRelative":"react/hooks/structure.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);