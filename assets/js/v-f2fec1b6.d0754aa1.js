"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[14822],{23359:(n,s,e)=>{e.r(s),e.d(s,{default:()=>Bn});var a=e(78e3);const o=(0,a.uE)("<p><code>ref</code>æ˜¯<code>reference</code>ï¼ˆå¼•ç”¨ï¼‰çš„ç¼©å†™ã€‚åœ¨<code>React</code>ä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯ç”¨<code>ref</code>ä¿å­˜<code>DOM</code>ã€‚</p><p>äº‹å®ä¸Šï¼Œä»»ä½•éœ€è¦è¢«&quot;å¼•ç”¨&quot;çš„æ•°æ®éƒ½å¯ä»¥ä¿å­˜åœ¨<code>ref</code>ä¸­ï¼Œ<code>useRef</code>çš„å‡ºç°å°†è¿™ç§æ€æƒ³è¿›ä¸€æ­¥å‘æ‰¬å…‰å¤§ã€‚</p>",2),t=(0,a.Uk)("åœ¨"),c=(0,a.Uk)("Hooksæ•°æ®ç»“æ„ä¸€èŠ‚"),p=(0,a.Uk)("æˆ‘ä»¬è®²åˆ°ï¼š"),l=(0,a.uE)('<blockquote><p>å¯¹äº<code>useRef(1)</code>ï¼Œ<code>memoizedState</code>ä¿å­˜<code>{current: 1}</code></p></blockquote><p>æœ¬èŠ‚æˆ‘ä»¬ä¼šä»‹ç»<code>useRef</code>çš„å®ç°ï¼Œä»¥åŠ<code>ref</code>çš„å·¥ä½œæµç¨‹ã€‚</p><p>ç”±äº<code>string</code>ç±»å‹çš„<code>ref</code>å·²ä¸æ¨èä½¿ç”¨ï¼Œæ‰€ä»¥æœ¬èŠ‚é’ˆå¯¹<code>function | {current: any}</code>ç±»å‹çš„<code>ref</code>ã€‚</p><h2 id="useref" tabindex="-1"><a class="header-anchor" href="#useref" aria-hidden="true">#</a> useRef</h2><p>ä¸å…¶ä»–<code>Hook</code>ä¸€æ ·ï¼Œå¯¹äº<code>mount</code>ä¸<code>update</code>ï¼Œ<code>useRef</code>å¯¹åº”ä¸¤ä¸ªä¸åŒ<code>dispatcher</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> mountRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">|</span>current<span class="token operator">:</span> <span class="token constant">T</span><span class="token operator">|</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>\n  <span class="token comment">// è·å–å½“å‰useRef hook</span>\n  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">mountWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// åˆ›å»ºref</span>\n  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">current</span><span class="token operator">:</span> initialValue<span class="token punctuation">}</span><span class="token punctuation">;</span>\n  hook<span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> ref<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> ref<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> updateRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">|</span>current<span class="token operator">:</span> <span class="token constant">T</span><span class="token operator">|</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>\n  <span class="token comment">// è·å–å½“å‰useRef hook</span>\n  <span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token function">updateWorkInProgressHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// è¿”å›ä¿å­˜çš„æ•°æ®</span>\n  <span class="token keyword">return</span> hook<span class="token punctuation">.</span>memoizedState<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',6),r=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),i={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.old.js#L1208-L1221",target:"_blank",rel:"noopener noreferrer"},u=(0,a.Uk)("è¿™é‡Œ"),d=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),k=(0,a.uE)('<p>å¯è§ï¼Œ<code>useRef</code>ä»…ä»…æ˜¯è¿”å›ä¸€ä¸ªåŒ…å«<code>current</code>å±æ€§çš„å¯¹è±¡ã€‚</p><p>ä¸ºäº†éªŒè¯è¿™ä¸ªè§‚ç‚¹ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹<code>React.createRef</code>æ–¹æ³•çš„å®ç°ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RefObject <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> refObject <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> refObject<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',3),m=(0,a.Uk)("ä½ å¯ä»¥ä»"),f={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react/src/ReactCreateRef.js",target:"_blank",rel:"noopener noreferrer"},v=(0,a.Uk)("è¿™é‡Œ"),b=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),g=(0,a.uE)('<p>äº†è§£äº†<code>ref</code>çš„æ•°æ®ç»“æ„åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹<code>ref</code>çš„å·¥ä½œæµç¨‹ã€‚</p><h2 id="refçš„å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#refçš„å·¥ä½œæµç¨‹" aria-hidden="true">#</a> refçš„å·¥ä½œæµç¨‹</h2><p>åœ¨<code>React</code>ä¸­ï¼Œ<code>HostComponent</code>ã€<code>ClassComponent</code>ã€<code>ForwardRef</code>å¯ä»¥èµ‹å€¼<code>ref</code>å±æ€§ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HostComponent</span>\n<span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n<span class="token comment">// ClassComponent / ForwardRef</span>\n<span class="token operator">&lt;</span>App ref<span class="token operator">=</span><span class="token punctuation">{</span>cpnRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œ<code>ForwardRef</code>åªæ˜¯å°†<code>ref</code>ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ä¸‹å»ï¼Œä¸ä¼šè¿›å…¥<code>ref</code>çš„å·¥ä½œæµç¨‹ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥è®¨è®º<code>ref</code>çš„å·¥ä½œæµç¨‹æ—¶ä¼šæ’é™¤<code>ForwardRef</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å¯¹äºForwardRefï¼ŒsecondArgä¸ºä¼ é€’ä¸‹å»çš„ref</span>\n<span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token function">Component</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> secondArg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>',7),h=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),y={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.old.js#L415",target:"_blank",rel:"noopener noreferrer"},w=(0,a.Uk)("è¿™é‡Œ"),_=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),R=(0,a.uE)('<p>æˆ‘ä»¬çŸ¥é“<code>HostComponent</code>åœ¨<code>commité˜¶æ®µ</code>çš„<code>mutationé˜¶æ®µ</code>æ‰§è¡Œ<code>DOM</code>æ“ä½œã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹åº”<code>ref</code>çš„æ›´æ–°ä¹Ÿæ˜¯å‘ç”Ÿåœ¨<code>mutationé˜¶æ®µ</code>ã€‚</p><p>å†è¿›ä¸€æ­¥ï¼Œ<code>mutationé˜¶æ®µ</code>æ‰§è¡Œ<code>DOM</code>æ“ä½œçš„ä¾æ®ä¸º<code>effectTag</code>ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äº<code>HostComponent</code>ã€<code>ClassComponent</code>å¦‚æœåŒ…å«<code>ref</code>æ“ä½œï¼Œé‚£ä¹ˆä¹Ÿä¼šèµ‹å€¼ç›¸åº”çš„<code>effectTag</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Placement <span class="token operator">=</span> <span class="token comment">/*                    */</span> <span class="token number">0b0000000000000010</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Update <span class="token operator">=</span> <span class="token comment">/*                       */</span> <span class="token number">0b0000000000000100</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Deletion <span class="token operator">=</span> <span class="token comment">/*                     */</span> <span class="token number">0b0000000000001000</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Ref <span class="token operator">=</span> <span class="token comment">/*                          */</span> <span class="token number">0b0000000010000000</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),U=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),C={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactSideEffectTags.js#L24",target:"_blank",rel:"noopener noreferrer"},j=(0,a.Uk)("ReactSideEffectTagsæ–‡ä»¶"),W=(0,a.Uk)("ä¸­çœ‹åˆ°"),T=(0,a._)("code",null,"ref",-1),x=(0,a.Uk)("å¯¹åº”çš„"),F=(0,a._)("code",null,"effectTag",-1),E=(0,a.uE)('<p>æ‰€ä»¥ï¼Œ<code>ref</code>çš„å·¥ä½œæµç¨‹å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><p><code>renderé˜¶æ®µ</code>ä¸ºå«æœ‰<code>ref</code>å±æ€§çš„<code>fiber</code>æ·»åŠ <code>Ref effectTag</code></p></li><li><p><code>commité˜¶æ®µ</code>ä¸ºåŒ…å«<code>Ref effectTag</code>çš„<code>fiber</code>æ‰§è¡Œå¯¹åº”æ“ä½œ</p></li></ul><h2 id="renderé˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#renderé˜¶æ®µ" aria-hidden="true">#</a> renderé˜¶æ®µ</h2><p>åœ¨<code>renderé˜¶æ®µ</code>çš„<code>beginWork</code>ä¸<code>completeWork</code>ä¸­æœ‰ä¸ªåŒåæ–¹æ³•<code>markRef</code>ç”¨äºä¸ºå«æœ‰<code>ref</code>å±æ€§çš„<code>fiber</code>å¢åŠ <code>Ref effectTag</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// beginWorkçš„markRef</span>\n<span class="token keyword">function</span> <span class="token function">markRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> ref <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>current <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ref <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span>\n    <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> current<span class="token punctuation">.</span>ref <span class="token operator">!==</span> ref<span class="token punctuation">)</span>\n  <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Schedule a Ref effect</span>\n    workInProgress<span class="token punctuation">.</span>effectTag <span class="token operator">|=</span> Ref<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// completeWorkçš„markRef</span>\n<span class="token keyword">function</span> <span class="token function">markRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  workInProgress<span class="token punctuation">.</span>effectTag <span class="token operator">|=</span> Ref<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),H=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),q={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L693",target:"_blank",rel:"noopener noreferrer"},D=(0,a.Uk)("è¿™é‡Œ"),L=(0,a.Uk)("çœ‹åˆ°"),P=(0,a._)("code",null,"beginWork",-1),S=(0,a.Uk)("çš„"),I=(0,a._)("code",null,"markRef",-1),O=(0,a.Uk)("ã€"),z={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCompleteWork.old.js#L153",target:"_blank",rel:"noopener noreferrer"},M=(0,a.Uk)("è¿™é‡Œ"),A=(0,a.Uk)("çœ‹åˆ°"),B=(0,a._)("code",null,"completeWork",-1),N=(0,a.Uk)("çš„"),Z=(0,a._)("code",null,"markRef",-1),V=(0,a._)("p",null,[(0,a.Uk)("åœ¨"),(0,a._)("code",null,"beginWork"),(0,a.Uk)("ä¸­ï¼Œå¦‚ä¸‹ä¸¤å¤„è°ƒç”¨äº†"),(0,a._)("code",null,"markRef"),(0,a.Uk)("ï¼š")],-1),J=(0,a._)("code",null,"updateClassComponent",-1),G=(0,a.Uk)("å†…çš„"),K={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L958",target:"_blank",rel:"noopener noreferrer"},Q=(0,a.Uk)("finishClassComponent"),X=(0,a.Uk)("ï¼Œå¯¹åº”"),Y=(0,a._)("code",null,"ClassComponent",-1),$=(0,a._)("p",null,[(0,a.Uk)("æ³¨æ„"),(0,a._)("code",null,"ClassComponent"),(0,a.Uk)("å³ä½¿"),(0,a._)("code",null,"shouldComponentUpdate"),(0,a.Uk)("ä¸º"),(0,a._)("code",null,"false"),(0,a.Uk)("è¯¥ç»„ä»¶ä¹Ÿä¼šè°ƒç”¨"),(0,a._)("code",null,"markRef")],-1),nn={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L1156",target:"_blank",rel:"noopener noreferrer"},sn=(0,a.Uk)("updateHostComponent"),en=(0,a.Uk)("ï¼Œå¯¹åº”"),an=(0,a._)("code",null,"HostComponent",-1),on=(0,a._)("p",null,[(0,a.Uk)("åœ¨"),(0,a._)("code",null,"completeWork"),(0,a.Uk)("ä¸­ï¼Œå¦‚ä¸‹ä¸¤å¤„è°ƒç”¨äº†"),(0,a._)("code",null,"markRef"),(0,a.Uk)("ï¼š")],-1),tn=(0,a._)("code",null,"completeWork",-1),cn=(0,a.Uk)("ä¸­çš„"),pn={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCompleteWork.old.js#L728",target:"_blank",rel:"noopener noreferrer"},ln=(0,a.Uk)("HostComponent"),rn=(0,a.Uk)("ç±»å‹"),un=(0,a._)("code",null,"completeWork",-1),dn=(0,a.Uk)("ä¸­çš„"),kn={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCompleteWork.old.js#L1278",target:"_blank",rel:"noopener noreferrer"},mn=(0,a.Uk)("ScopeComponent"),fn=(0,a.Uk)("ç±»å‹"),vn=(0,a._)("code",null,"ScopeComponent",-1),bn=(0,a.Uk)("æ˜¯ä¸€ç§ç”¨äºç®¡ç†"),gn=(0,a._)("code",null,"focus",-1),hn=(0,a.Uk)("çš„æµ‹è¯•ç‰¹æ€§ï¼Œè¯¦è§"),yn={href:"https://github.com/facebook/react/pull/16587",target:"_blank",rel:"noopener noreferrer"},wn=(0,a.Uk)("PR"),_n=(0,a.uE)('<p>æ€»ç»“ä¸‹<code>ç»„ä»¶</code>å¯¹åº”<code>fiber</code>è¢«èµ‹å€¼<code>Ref effectTag</code>éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š</p><ul><li><p><code>fiber</code>ç±»å‹ä¸º<code>HostComponent</code>ã€<code>ClassComponent</code>ã€<code>ScopeComponent</code>ï¼ˆè¿™ç§æƒ…å†µæˆ‘ä»¬ä¸è®¨è®ºï¼‰</p></li><li><p>å¯¹äº<code>mount</code>ï¼Œ<code>workInProgress.ref !== null</code>ï¼Œå³å­˜åœ¨<code>ref</code>å±æ€§</p></li><li><p>å¯¹äº<code>update</code>ï¼Œ<code>current.ref !== workInProgress.ref</code>ï¼Œå³<code>ref</code>å±æ€§æ”¹å˜</p></li></ul><h2 id="commité˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#commité˜¶æ®µ" aria-hidden="true">#</a> commité˜¶æ®µ</h2><p>åœ¨<code>commité˜¶æ®µ</code>çš„<code>mutationé˜¶æ®µ</code>ä¸­ï¼Œå¯¹äº<code>ref</code>å±æ€§æ”¹å˜çš„æƒ…å†µï¼Œéœ€è¦å…ˆç§»é™¤ä¹‹å‰çš„<code>ref</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">commitMutationEffects</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span> renderPriorityLevel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n    <span class="token keyword">const</span> effectTag <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>effectTag<span class="token punctuation">;</span>\n    <span class="token comment">// ...</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTag <span class="token operator">&amp;</span> Ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> current <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// ç§»é™¤ä¹‹å‰çš„ref</span>\n        <span class="token function">commitDetachRef</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),Rn=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),Un={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L2342",target:"_blank",rel:"noopener noreferrer"},Cn=(0,a.Uk)("è¿™é‡Œ"),jn=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),Wn=(0,a.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">commitDetachRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> currentRef <span class="token operator">=</span> current<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentRef <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> currentRef <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// functionç±»å‹refï¼Œè°ƒç”¨ä»–ï¼Œä¼ å‚ä¸ºnull</span>\n      <span class="token function">currentRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å¯¹è±¡ç±»å‹refï¼Œcurrentèµ‹å€¼ä¸ºnull</span>\n      currentRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨<code>mutationé˜¶æ®µ</code>ï¼Œå¯¹äº<code>Deletion effectTag</code>çš„<code>fiber</code>ï¼ˆå¯¹åº”éœ€è¦åˆ é™¤çš„<code>DOMèŠ‚ç‚¹</code>ï¼‰ï¼Œéœ€è¦é€’å½’ä»–çš„å­æ ‘ï¼Œå¯¹å­å­™<code>fiber</code>çš„<code>ref</code>æ‰§è¡Œç±»ä¼¼<code>commitDetachRef</code>çš„æ“ä½œã€‚</p>',2),Tn=(0,a.Uk)("åœ¨"),xn=(0,a.Uk)("mutationé˜¶æ®µä¸€èŠ‚"),Fn=(0,a.Uk)("æˆ‘ä»¬è®²åˆ°"),En=(0,a.uE)('<blockquote><p>å¯¹äº<code>Deletion effectTag</code>çš„<code>fiber</code>ï¼Œä¼šæ‰§è¡Œ<code>commitDeletion</code>ã€‚</p></blockquote><p>åœ¨<code>commitDeletion</code>â€”â€”<code>unmountHostComponents</code>â€”â€”<code>commitUnmount</code>â€”â€”<code>ClassComponent | HostComponent</code>ç±»å‹<code>case</code>ä¸­è°ƒç”¨çš„<code>safelyDetachRef</code>æ–¹æ³•è´Ÿè´£æ‰§è¡Œç±»ä¼¼<code>commitDetachRef</code>çš„æ“ä½œã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">safelyDetachRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> ref <span class="token operator">=</span> current<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>ref <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> ref <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">try</span> <span class="token punctuation">{</span>\n        <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>refError<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">captureCommitPhaseError</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> refError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      ref<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',3),Hn=(0,a.Uk)("ä½ å¯ä»¥åœ¨"),qn={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCommitWork.old.js#L183",target:"_blank",rel:"noopener noreferrer"},Dn=(0,a.Uk)("è¿™é‡Œ"),Ln=(0,a.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),Pn=(0,a.Uk)("æ¥ä¸‹æ¥è¿›å…¥"),Sn=(0,a._)("code",null,"ref",-1),In=(0,a.Uk)("çš„èµ‹å€¼é˜¶æ®µã€‚æˆ‘ä»¬åœ¨"),On=(0,a.Uk)("Layouté˜¶æ®µä¸€èŠ‚"),zn=(0,a.Uk)("è®²åˆ°"),Mn=(0,a.uE)('<blockquote><p><code>commitLayoutEffect</code>ä¼šæ‰§è¡Œ<code>commitAttachRef</code>ï¼ˆèµ‹å€¼<code>ref</code>ï¼‰</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">commitAttachRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">finishedWork</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> ref <span class="token operator">=</span> finishedWork<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>ref <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// è·å–refå±æ€§å¯¹åº”çš„Componentå®ä¾‹</span>\n    <span class="token keyword">const</span> instance <span class="token operator">=</span> finishedWork<span class="token punctuation">.</span>stateNode<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> instanceToUse<span class="token punctuation">;</span>\n    <span class="token keyword">switch</span> <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span>\n        instanceToUse <span class="token operator">=</span> <span class="token function">getPublicInstance</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">break</span><span class="token punctuation">;</span>\n      <span class="token keyword">default</span><span class="token operator">:</span>\n        instanceToUse <span class="token operator">=</span> instance<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// èµ‹å€¼ref</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> ref <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">ref</span><span class="token punctuation">(</span>instanceToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      ref<span class="token punctuation">.</span>current <span class="token operator">=</span> instanceToUse<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œ<code>ref</code>çš„å·¥ä½œæµç¨‹å®Œæ¯•ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>æœ¬èŠ‚æˆ‘ä»¬å­¦ä¹ äº†<code>ref</code>çš„å·¥ä½œæµç¨‹ã€‚</p><ul><li><p>å¯¹äº<code>FunctionComponent</code>ï¼Œ<code>useRef</code>è´Ÿè´£åˆ›å»ºå¹¶è¿”å›å¯¹åº”çš„<code>ref</code>ã€‚</p></li><li><p>å¯¹äºèµ‹å€¼äº†<code>ref</code>å±æ€§çš„<code>HostComponent</code>ä¸<code>ClassComponent</code>ï¼Œä¼šåœ¨<code>renderé˜¶æ®µ</code>ç»å†èµ‹å€¼<code>Ref effectTag</code>ï¼Œåœ¨<code>commité˜¶æ®µ</code>æ‰§è¡Œå¯¹åº”<code>ref</code>æ“ä½œã€‚</p></li></ul>',6),An={},Bn=(0,e(13860).Z)(An,[["render",function(n,s){const e=(0,a.up)("RouterLink"),An=(0,a.up)("ExternalLinkIcon");return(0,a.wg)(),(0,a.iD)("div",null,[o,(0,a._)("p",null,[t,(0,a.Wm)(e,{to:"/react/hooks/structure.html#memoizedstate"},{default:(0,a.w5)((()=>[c])),_:1}),p]),l,(0,a._)("blockquote",null,[(0,a._)("p",null,[r,(0,a._)("a",i,[u,(0,a.Wm)(An)]),d])]),k,(0,a._)("blockquote",null,[(0,a._)("p",null,[m,(0,a._)("a",f,[v,(0,a.Wm)(An)]),b])]),g,(0,a._)("blockquote",null,[(0,a._)("p",null,[h,(0,a._)("a",y,[w,(0,a.Wm)(An)]),_])]),R,(0,a._)("blockquote",null,[(0,a._)("p",null,[U,(0,a._)("a",C,[j,(0,a.Wm)(An)]),W,T,x,F])]),E,(0,a._)("blockquote",null,[(0,a._)("p",null,[H,(0,a._)("a",q,[D,(0,a.Wm)(An)]),L,P,S,I,O,(0,a._)("a",z,[M,(0,a.Wm)(An)]),A,B,N,Z])]),V,(0,a._)("ul",null,[(0,a._)("li",null,[J,G,(0,a._)("a",K,[Q,(0,a.Wm)(An)]),X,Y])]),$,(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("a",nn,[sn,(0,a.Wm)(An)]),en,an])]),on,(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("p",null,[tn,cn,(0,a._)("a",pn,[ln,(0,a.Wm)(An)]),rn])]),(0,a._)("li",null,[(0,a._)("p",null,[un,dn,(0,a._)("a",kn,[mn,(0,a.Wm)(An)]),fn])])]),(0,a._)("blockquote",null,[(0,a._)("p",null,[vn,bn,gn,hn,(0,a._)("a",yn,[wn,(0,a.Wm)(An)])])]),_n,(0,a._)("blockquote",null,[(0,a._)("p",null,[Rn,(0,a._)("a",Un,[Cn,(0,a.Wm)(An)]),jn])]),Wn,(0,a._)("p",null,[Tn,(0,a.Wm)(e,{to:"/react/hooks/renderer/mutation.html#commitmutationeffects"},{default:(0,a.w5)((()=>[xn])),_:1}),Fn]),En,(0,a._)("blockquote",null,[(0,a._)("p",null,[Hn,(0,a._)("a",qn,[Dn,(0,a.Wm)(An)]),Ln])]),(0,a._)("p",null,[Pn,Sn,In,(0,a.Wm)(e,{to:"/react/renderer/layout.html#commitlayouteffects"},{default:(0,a.w5)((()=>[On])),_:1}),zn]),Mn])}]])},13860:(n,s)=>{s.Z=(n,s)=>{const e=n.__vccOpts||n;for(const[n,a]of s)e[n]=a;return e}},93945:(n,s,e)=>{e.r(s),e.d(s,{data:()=>a});const a=JSON.parse('{"key":"v-f2fec1b6","path":"/react/hooks/useref.html","title":"useRef","lang":"zh-CN","frontmatter":{"title":"useRef","author":"BetaSu","tag":["React"],"summary":"refæ˜¯referenceï¼ˆå¼•ç”¨ï¼‰çš„ç¼©å†™ã€‚åœ¨Reactä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯ç”¨refä¿å­˜DOMã€‚ äº‹å®ä¸Šï¼Œä»»ä½•éœ€è¦è¢«\\"å¼•ç”¨\\"çš„æ•°æ®éƒ½å¯ä»¥ä¿å­˜åœ¨refä¸­ï¼ŒuseRefçš„å‡ºç°å°†è¿™ç§æ€æƒ³è¿›ä¸€æ­¥å‘æ‰¬å…‰å¤§ã€‚ åœ¨Hooksæ•°æ®ç»“æ„ä¸€èŠ‚æˆ‘ä»¬è®²åˆ°ï¼š \\" å¯¹äºuseRef(1)ï¼ŒmemoizedStateä¿å­˜{current: 1}\\" æœ¬èŠ‚æˆ‘ä»¬ä¼šä»‹ç»useRefçš„å®ç°ï¼Œä»¥åŠrefçš„å·¥ä½œ","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/hooks/useref.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"useRef"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"useRef","slug":"useref","children":[]},{"level":2,"title":"refçš„å·¥ä½œæµç¨‹","slug":"refçš„å·¥ä½œæµç¨‹","children":[]},{"level":2,"title":"renderé˜¶æ®µ","slug":"renderé˜¶æ®µ","children":[]},{"level":2,"title":"commité˜¶æ®µ","slug":"commité˜¶æ®µ","children":[]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":4.44,"words":1331},"filePathRelative":"react/hooks/useref.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);