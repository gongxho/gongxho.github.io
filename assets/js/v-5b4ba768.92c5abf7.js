"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[13157],{40634:(n,e,s)=>{s.r(e),s.d(e,{default:()=>qn});var a=s(78e3);const o=(0,a._)("p",null,[(0,a.Uk)("ä¸Šä¸€èŠ‚æˆ‘ä»¬äº†è§£åˆ°"),(0,a._)("code",null,"renderé˜¶æ®µ"),(0,a.Uk)("çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºâ€œé€’â€é˜¶æ®µå’Œâ€œå½’â€é˜¶æ®µã€‚å…¶ä¸­â€œé€’â€é˜¶æ®µä¼šæ‰§è¡Œ"),(0,a._)("code",null,"beginWork"),(0,a.Uk)("ï¼Œâ€œå½’â€é˜¶æ®µä¼šæ‰§è¡Œ"),(0,a._)("code",null,"completeWork"),(0,a.Uk)("ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬çœ‹çœ‹â€œé€’â€é˜¶æ®µçš„"),(0,a._)("code",null,"beginWork"),(0,a.Uk)("æ–¹æ³•ç©¶ç«Ÿåšäº†ä»€ä¹ˆã€‚")],-1),c=(0,a._)("h2",{id:"æ–¹æ³•æ¦‚è§ˆ",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#æ–¹æ³•æ¦‚è§ˆ","aria-hidden":"true"},"#"),(0,a.Uk)(" æ–¹æ³•æ¦‚è§ˆ")],-1),t=(0,a.Uk)("å¯ä»¥ä»"),p={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L3075",target:"_blank",rel:"noopener noreferrer"},l=(0,a.Uk)("æºç è¿™é‡Œ"),r=(0,a.Uk)("çœ‹åˆ°"),i=(0,a._)("code",null,"beginWork",-1),d=(0,a.Uk)("çš„å®šä¹‰ã€‚æ•´ä¸ªæ–¹æ³•å¤§æ¦‚æœ‰500è¡Œä»£ç ã€‚"),u=(0,a.uE)('<p>ä»ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ<code>beginWork</code>çš„å·¥ä½œæ˜¯ä¼ å…¥<code>å½“å‰FiberèŠ‚ç‚¹</code>ï¼Œåˆ›å»º<code>å­FiberèŠ‚ç‚¹</code>ï¼Œæˆ‘ä»¬ä»ä¼ å‚æ¥çœ‹çœ‹å…·ä½“æ˜¯å¦‚ä½•åšçš„ã€‚</p><h3 id="ä»ä¼ å‚çœ‹æ–¹æ³•æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#ä»ä¼ å‚çœ‹æ–¹æ³•æ‰§è¡Œ" aria-hidden="true">#</a> ä»ä¼ å‚çœ‹æ–¹æ³•æ‰§è¡Œ</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">beginWork</span><span class="token punctuation">(</span>\n  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>\n  <span class="token literal-property property">renderLanes</span><span class="token operator">:</span> Lanes<span class="token punctuation">,</span></span>\n<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...çœç•¥å‡½æ•°ä½“</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ä¼ å‚ï¼š</p><ul><li>currentï¼šå½“å‰ç»„ä»¶å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„<code>FiberèŠ‚ç‚¹</code>ï¼Œå³<code>workInProgress.alternate</code></li><li>workInProgressï¼šå½“å‰ç»„ä»¶å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code></li><li>renderLanesï¼šä¼˜å…ˆçº§ç›¸å…³ï¼Œåœ¨è®²è§£<code>Scheduler</code>æ—¶å†è®²è§£</li></ul>',5),k=(0,a.Uk)("ä»"),m=(0,a.Uk)("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚"),b=(0,a.Uk)("æˆ‘ä»¬çŸ¥é“ï¼Œé™¤"),v=(0,a._)("code",null,"rootFiber",-1),g=(0,a.Uk)("ä»¥å¤–ï¼Œ ç»„ä»¶"),f=(0,a._)("code",null,"mount",-1),h=(0,a.Uk)("æ—¶ï¼Œç”±äºæ˜¯é¦–æ¬¡æ¸²æŸ“ï¼Œæ˜¯ä¸å­˜åœ¨å½“å‰ç»„ä»¶å¯¹åº”çš„"),y=(0,a._)("code",null,"FiberèŠ‚ç‚¹",-1),w=(0,a.Uk)("åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„"),_=(0,a._)("code",null,"FiberèŠ‚ç‚¹",-1),F=(0,a.Uk)("ï¼Œå³"),U=(0,a._)("code",null,"mount",-1),W=(0,a.Uk)("æ—¶"),C=(0,a._)("code",null,"current === null",-1),P=(0,a.Uk)("ã€‚"),x=(0,a.uE)('<p>ç»„ä»¶<code>update</code>æ—¶ï¼Œç”±äºä¹‹å‰å·²ç»<code>mount</code>è¿‡ï¼Œæ‰€ä»¥<code>current !== null</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>current === null ?</code>æ¥åŒºåˆ†ç»„ä»¶æ˜¯å¤„äº<code>mount</code>è¿˜æ˜¯<code>update</code>ã€‚</p><p>åŸºäºæ­¤åŸå› ï¼Œ<code>beginWork</code>çš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><p><code>update</code>æ—¶ï¼šå¦‚æœ<code>current</code>å­˜åœ¨ï¼Œåœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶å¯ä»¥å¤ç”¨<code>current</code>èŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½å…‹éš†<code>current.child</code>ä½œä¸º<code>workInProgress.child</code>ï¼Œè€Œä¸éœ€è¦æ–°å»º<code>workInProgress.child</code>ã€‚</p></li><li><p><code>mount</code>æ—¶ï¼šé™¤<code>fiberRootNode</code>ä»¥å¤–ï¼Œ<code>current === null</code>ã€‚ä¼šæ ¹æ®<code>fiber.tag</code>ä¸åŒï¼Œåˆ›å»ºä¸åŒç±»å‹çš„<code>å­FiberèŠ‚ç‚¹</code></p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">beginWork</span><span class="token punctuation">(</span>\n  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>\n  <span class="token literal-property property">renderLanes</span><span class="token operator">:</span> Lanes</span>\n<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>\n\n  <span class="token comment">// updateæ—¶ï¼šå¦‚æœcurrentå­˜åœ¨å¯èƒ½å­˜åœ¨ä¼˜åŒ–è·¯å¾„ï¼Œå¯ä»¥å¤ç”¨currentï¼ˆå³ä¸Šä¸€æ¬¡æ›´æ–°çš„FiberèŠ‚ç‚¹ï¼‰</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...çœç•¥</span>\n\n    <span class="token comment">// å¤ç”¨current</span>\n    <span class="token keyword">return</span> <span class="token function">bailoutOnAlreadyFinishedWork</span><span class="token punctuation">(</span>\n      current<span class="token punctuation">,</span>\n      workInProgress<span class="token punctuation">,</span>\n      renderLanes<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// mountæ—¶ï¼šæ ¹æ®tagä¸åŒï¼Œåˆ›å»ºä¸åŒçš„å­FiberèŠ‚ç‚¹</span>\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">IndeterminateComponent</span><span class="token operator">:</span> \n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">LazyComponent</span><span class="token operator">:</span> \n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">FunctionComponent</span><span class="token operator">:</span> \n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">ClassComponent</span><span class="token operator">:</span> \n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">HostRoot</span><span class="token operator">:</span>\n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span>\n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">HostText</span><span class="token operator">:</span>\n      <span class="token comment">// ...çœç•¥</span>\n    <span class="token comment">// ...çœç•¥å…¶ä»–ç±»å‹</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="updateæ—¶" tabindex="-1"><a class="header-anchor" href="#updateæ—¶" aria-hidden="true">#</a> updateæ—¶</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³å¦‚ä¸‹æƒ…å†µæ—¶<code>didReceiveUpdate === false</code>ï¼ˆå³å¯ä»¥ç›´æ¥å¤ç”¨å‰ä¸€æ¬¡æ›´æ–°çš„<code>å­Fiber</code>ï¼Œä¸éœ€è¦æ–°å»º<code>å­Fiber</code>ï¼‰</p><ol><li><code>oldProps === newProps &amp;&amp; workInProgress.type === current.type</code>ï¼Œå³<code>props</code>ä¸<code>fiber.type</code>ä¸å˜</li><li><code>!includesSomeLane(renderLanes, updateLanes)</code>ï¼Œå³å½“å‰<code>FiberèŠ‚ç‚¹</code>ä¼˜å…ˆçº§ä¸å¤Ÿï¼Œä¼šåœ¨è®²è§£<code>Scheduler</code>æ—¶ä»‹ç»</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> oldProps <span class="token operator">=</span> current<span class="token punctuation">.</span>memoizedProps<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> newProps <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>pendingProps<span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>\n      oldProps <span class="token operator">!==</span> newProps <span class="token operator">||</span>\n      <span class="token function">hasLegacyContextChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>\n      <span class="token punctuation">(</span>__DEV__ <span class="token operator">?</span> workInProgress<span class="token punctuation">.</span>type <span class="token operator">!==</span> current<span class="token punctuation">.</span>type <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">includesSomeLane</span><span class="token punctuation">(</span>renderLanes<span class="token punctuation">,</span> updateLanes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// çœç•¥å¤„ç†</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> <span class="token function">bailoutOnAlreadyFinishedWork</span><span class="token punctuation">(</span>\n        current<span class="token punctuation">,</span>\n        workInProgress<span class="token punctuation">,</span>\n        renderLanes<span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    didReceiveUpdate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mountæ—¶" tabindex="-1"><a class="header-anchor" href="#mountæ—¶" aria-hidden="true">#</a> mountæ—¶</h2><p>å½“ä¸æ»¡è¶³ä¼˜åŒ–è·¯å¾„æ—¶ï¼Œæˆ‘ä»¬å°±è¿›å…¥ç¬¬äºŒéƒ¨åˆ†ï¼Œæ–°å»º<code>å­Fiber</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®<code>fiber.tag</code>ä¸åŒï¼Œè¿›å…¥ä¸åŒç±»å‹<code>Fiber</code>çš„åˆ›å»ºé€»è¾‘ã€‚</p>',12),L=(0,a.Uk)("å¯ä»¥ä»"),j={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactWorkTags.js",target:"_blank",rel:"noopener noreferrer"},I=(0,a.Uk)("è¿™é‡Œ"),R=(0,a.Uk)("çœ‹åˆ°"),T=(0,a._)("code",null,"tag",-1),D=(0,a.Uk)("å¯¹åº”çš„ç»„ä»¶ç±»å‹"),O=(0,a.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// mountæ—¶ï¼šæ ¹æ®tagä¸åŒï¼Œåˆ›å»ºä¸åŒçš„FiberèŠ‚ç‚¹</span>\n<span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">IndeterminateComponent</span><span class="token operator">:</span> \n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">LazyComponent</span><span class="token operator">:</span> \n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">FunctionComponent</span><span class="token operator">:</span> \n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">ClassComponent</span><span class="token operator">:</span> \n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">HostRoot</span><span class="token operator">:</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token keyword">case</span> <span class="token literal-property property">HostText</span><span class="token operator">:</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token comment">// ...çœç•¥å…¶ä»–ç±»å‹</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',1),E=(0,a.Uk)("å¯¹äºæˆ‘ä»¬å¸¸è§çš„ç»„ä»¶ç±»å‹ï¼Œå¦‚ï¼ˆ"),M=(0,a._)("code",null,"FunctionComponent",-1),B=(0,a.Uk)("/"),S=(0,a._)("code",null,"ClassComponent",-1),q=(0,a.Uk)("/"),z=(0,a._)("code",null,"HostComponent",-1),H=(0,a.Uk)("ï¼‰ï¼Œæœ€ç»ˆä¼šè¿›å…¥"),N={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L233",target:"_blank",rel:"noopener noreferrer"},Z=(0,a.Uk)("reconcileChildren"),A=(0,a.Uk)("æ–¹æ³•ã€‚"),J=(0,a.uE)('<h2 id="reconcilechildren" tabindex="-1"><a class="header-anchor" href="#reconcilechildren" aria-hidden="true">#</a> reconcileChildren</h2><p>ä»è¯¥å‡½æ•°åå°±èƒ½çœ‹å‡ºè¿™æ˜¯<code>Reconciler</code>æ¨¡å—çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚é‚£ä¹ˆä»–ç©¶ç«Ÿåšäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li><p>å¯¹äº<code>mount</code>çš„ç»„ä»¶ï¼Œä»–ä¼šåˆ›å»ºæ–°çš„<code>å­FiberèŠ‚ç‚¹</code></p></li><li><p>å¯¹äº<code>update</code>çš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>æ¯”è¾ƒï¼ˆä¹Ÿå°±æ˜¯ä¿—ç§°çš„<code>Diff</code>ç®—æ³•ï¼‰ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°<code>FiberèŠ‚ç‚¹</code></p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>\n  <span class="token parameter"><span class="token literal-property property">current</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">workInProgress</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>\n  <span class="token literal-property property">nextChildren</span><span class="token operator">:</span> any<span class="token punctuation">,</span>\n  <span class="token literal-property property">renderLanes</span><span class="token operator">:</span> Lanes</span>\n<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¯¹äºmountçš„ç»„ä»¶</span>\n    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">mountChildFibers</span><span class="token punctuation">(</span>\n      workInProgress<span class="token punctuation">,</span>\n      <span class="token keyword">null</span><span class="token punctuation">,</span>\n      nextChildren<span class="token punctuation">,</span>\n      renderLanes<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¯¹äºupdateçš„ç»„ä»¶</span>\n    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>\n      workInProgress<span class="token punctuation">,</span>\n      current<span class="token punctuation">.</span>child<span class="token punctuation">,</span>\n      nextChildren<span class="token punctuation">,</span>\n      renderLanes<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå’Œ<code>beginWork</code>ä¸€æ ·ï¼Œä»–ä¹Ÿæ˜¯é€šè¿‡<code>current === null ?</code>åŒºåˆ†<code>mount</code>ä¸<code>update</code>ã€‚</p>',5),V=(0,a.Uk)("ä¸è®ºèµ°å“ªä¸ªé€»è¾‘ï¼Œæœ€ç»ˆä»–ä¼šç”Ÿæˆæ–°çš„å­"),$=(0,a._)("code",null,"FiberèŠ‚ç‚¹",-1),G=(0,a.Uk)("å¹¶èµ‹å€¼ç»™"),K=(0,a._)("code",null,"workInProgress.child",-1),Q=(0,a.Uk)("ï¼Œä½œä¸ºæœ¬æ¬¡"),X=(0,a._)("code",null,"beginWork",-1),Y={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L1158",target:"_blank",rel:"noopener noreferrer"},nn=(0,a.Uk)("è¿”å›å€¼"),en=(0,a.Uk)("ï¼Œå¹¶ä½œä¸ºä¸‹æ¬¡"),sn=(0,a._)("code",null,"performUnitOfWork",-1),an=(0,a.Uk)("æ‰§è¡Œæ—¶"),on=(0,a._)("code",null,"workInProgress",-1),cn=(0,a.Uk)("çš„"),tn={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1702",target:"_blank",rel:"noopener noreferrer"},pn=(0,a.Uk)("ä¼ å‚"),ln=(0,a.Uk)("ã€‚"),rn=(0,a.uE)('<div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>mountChildFibers</code>ä¸<code>reconcileChildFibers</code>è¿™ä¸¤ä¸ªæ–¹æ³•çš„é€»è¾‘åŸºæœ¬ä¸€è‡´ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼š<code>reconcileChildFibers</code>ä¼šä¸ºç”Ÿæˆçš„<code>FiberèŠ‚ç‚¹</code>å¸¦ä¸Š<code>effectTag</code>å±æ€§ï¼Œè€Œ<code>mountChildFibers</code>ä¸ä¼šã€‚</p></div><h2 id="effecttag" tabindex="-1"><a class="header-anchor" href="#effecttag" aria-hidden="true">#</a> effectTag</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>renderé˜¶æ®µ</code>çš„å·¥ä½œæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œå½“å·¥ä½œç»“æŸåä¼šé€šçŸ¥<code>Renderer</code>éœ€è¦æ‰§è¡Œçš„<code>DOM</code>æ“ä½œã€‚è¦æ‰§è¡Œ<code>DOM</code>æ“ä½œçš„å…·ä½“ç±»å‹å°±ä¿å­˜åœ¨<code>fiber.effectTag</code>ä¸­ã€‚</p>',3),dn=(0,a.Uk)("ä½ å¯ä»¥ä»"),un={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactSideEffectTags.js",target:"_blank",rel:"noopener noreferrer"},kn=(0,a.Uk)("è¿™é‡Œ"),mn=(0,a.Uk)("çœ‹åˆ°"),bn=(0,a._)("code",null,"effectTag",-1),vn=(0,a.Uk)("å¯¹åº”çš„"),gn=(0,a._)("code",null,"DOM",-1),fn=(0,a.Uk)("æ“ä½œ"),hn=(0,a.uE)('<p>æ¯”å¦‚ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Placement <span class="token operator">=</span> <span class="token comment">/*                */</span> <span class="token number">0b00000000000010</span><span class="token punctuation">;</span>\n<span class="token comment">// DOMéœ€è¦æ›´æ–°</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Update <span class="token operator">=</span> <span class="token comment">/*                   */</span> <span class="token number">0b00000000000100</span><span class="token punctuation">;</span>\n<span class="token comment">// DOMéœ€è¦æ’å…¥åˆ°é¡µé¢ä¸­å¹¶æ›´æ–°</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> PlacementAndUpdate <span class="token operator">=</span> <span class="token comment">/*       */</span> <span class="token number">0b00000000000110</span><span class="token punctuation">;</span>\n<span class="token comment">// DOMéœ€è¦åˆ é™¤</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> Deletion <span class="token operator">=</span> <span class="token comment">/*                 */</span> <span class="token number">0b00000000001000</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>é€šè¿‡äºŒè¿›åˆ¶è¡¨ç¤º<code>effectTag</code>ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨ä½æ“ä½œä¸º<code>fiber.effectTag</code>èµ‹å€¼å¤šä¸ª<code>effect</code>ã€‚</p></blockquote><p>é‚£ä¹ˆï¼Œå¦‚æœè¦é€šçŸ¥<code>Renderer</code>å°†<code>FiberèŠ‚ç‚¹</code>å¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code>æ’å…¥é¡µé¢ä¸­ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li><p><code>fiber.stateNode</code>å­˜åœ¨ï¼Œå³<code>FiberèŠ‚ç‚¹</code>ä¸­ä¿å­˜äº†å¯¹åº”çš„<code>DOMèŠ‚ç‚¹</code></p></li><li><p><code>(fiber.effectTag &amp; Placement) !== 0</code>ï¼Œå³<code>FiberèŠ‚ç‚¹</code>å­˜åœ¨<code>Placement effectTag</code></p></li></ol><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>mount</code>æ—¶ï¼Œ<code>fiber.stateNode === null</code>ï¼Œä¸”åœ¨<code>reconcileChildren</code>ä¸­è°ƒç”¨çš„<code>mountChildFibers</code>ä¸ä¼šä¸º<code>FiberèŠ‚ç‚¹</code>èµ‹å€¼<code>effectTag</code>ã€‚é‚£ä¹ˆé¦–å±æ¸²æŸ“å¦‚ä½•å®Œæˆå‘¢ï¼Ÿ</p><p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ<code>fiber.stateNode</code>ä¼šåœ¨<code>completeWork</code>ä¸­åˆ›å»ºï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆååˆ†å·§å¦™ï¼šå‡è®¾<code>mountChildFibers</code>ä¹Ÿä¼šèµ‹å€¼<code>effectTag</code>ï¼Œé‚£ä¹ˆå¯ä»¥é¢„è§<code>mount</code>æ—¶æ•´æ£µ<code>Fiberæ ‘</code>æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šæœ‰<code>Placement effectTag</code>ã€‚é‚£ä¹ˆ<code>commité˜¶æ®µ</code>åœ¨æ‰§è¡Œ<code>DOM</code>æ“ä½œæ—¶æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æ’å…¥æ“ä½œï¼Œè¿™æ ·å¤§é‡çš„<code>DOM</code>æ“ä½œæ˜¯æä½æ•ˆçš„ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨<code>mount</code>æ—¶åªæœ‰<code>rootFiber</code>ä¼šèµ‹å€¼<code>Placement effectTag</code>ï¼Œåœ¨<code>commité˜¶æ®µ</code>åªä¼šæ‰§è¡Œä¸€æ¬¡æ’å…¥æ“ä½œã€‚</p>',9),yn={class:"custom-container details"},wn=(0,a.uE)("<summary>æ ¹FiberèŠ‚ç‚¹ Demo</summary><p>å€Ÿç”¨ä¸Šä¸€èŠ‚çš„Demoï¼Œç¬¬ä¸€ä¸ªè¿›å…¥<code>beginWork</code>æ–¹æ³•çš„<code>FiberèŠ‚ç‚¹</code>å°±æ˜¯<code>rootFiber</code>ï¼Œä»–çš„<code>alternate</code>æŒ‡å‘<code>current rootFiber</code>ï¼ˆå³ä»–å­˜åœ¨<code>current</code>ï¼‰ã€‚</p>",2),_n=(0,a.Uk)("ä¸ºä»€ä¹ˆ"),Fn=(0,a._)("code",null,"rootFiber",-1),Un=(0,a.Uk)("èŠ‚ç‚¹å­˜åœ¨"),Wn=(0,a._)("code",null,"current",-1),Cn=(0,a.Uk)("ï¼ˆå³"),Pn=(0,a._)("code",null,"rootFiber.alternate",-1),xn=(0,a.Uk)("ï¼‰ï¼Œæˆ‘ä»¬åœ¨"),Ln=(0,a.Uk)("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚mountæ—¶çš„ç¬¬äºŒæ­¥"),jn=(0,a.Uk)("å·²ç»è®²è¿‡"),In=(0,a.uE)("<p>ç”±äºå­˜åœ¨<code>current</code>ï¼Œ<code>rootFiber</code>åœ¨<code>reconcileChildren</code>æ—¶ä¼šèµ°<code>reconcileChildFibers</code>é€»è¾‘ã€‚</p><p>è€Œä¹‹åé€šè¿‡<code>beginWork</code>åˆ›å»ºçš„<code>FiberèŠ‚ç‚¹</code>æ˜¯ä¸å­˜åœ¨<code>current</code>çš„ï¼ˆå³ <code>fiber.alternate === null</code>ï¼‰ï¼Œä¼šèµ°<code>mountChildFibers</code>é€»è¾‘</p>",2),Rn=(0,a.Uk)("å…³æ³¨å…¬ä¼—å·"),Tn=(0,a.Uk)("ï¼Œåå°å›å¤"),Dn=(0,a._)("strong",null,"531",-1),On=(0,a.Uk)("è·å¾—åœ¨çº¿Demoåœ°å€"),En=(0,a._)("h2",{id:"å‚è€ƒèµ„æ–™",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#å‚è€ƒèµ„æ–™","aria-hidden":"true"},"#"),(0,a.Uk)(" å‚è€ƒèµ„æ–™")],-1),Mn=(0,a._)("p",null,[(0,a._)("code",null,"beginWork"),(0,a.Uk)("æµç¨‹å›¾")],-1),Bn=["src"],Sn={},qn=(0,s(13860).Z)(Sn,[["render",function(n,e){const s=(0,a.up)("ExternalLinkIcon"),Sn=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.iD)("div",null,[o,c,(0,a._)("p",null,[t,(0,a._)("a",p,[l,(0,a.Wm)(s)]),r,i,d]),u,(0,a._)("p",null,[k,(0,a.Wm)(Sn,{to:"/react/process/doubleBuffer.html"},{default:(0,a.w5)((()=>[m])),_:1}),b,(0,a.Wm)(Sn,{to:"/react/process/doubleBuffer.html#mount%E6%97%B6"},{default:(0,a.w5)((()=>[v])),_:1}),g,f,h,y,w,_,F,U,W,C,P]),x,(0,a._)("blockquote",null,[(0,a._)("p",null,[L,(0,a._)("a",j,[I,(0,a.Wm)(s)]),R,T,D])]),O,(0,a._)("p",null,[E,M,B,S,q,z,H,(0,a._)("a",N,[Z,(0,a.Wm)(s)]),A]),J,(0,a._)("p",null,[V,$,G,K,Q,X,(0,a._)("a",Y,[nn,(0,a.Wm)(s)]),en,sn,an,on,cn,(0,a._)("a",tn,[pn,(0,a.Wm)(s)]),ln]),rn,(0,a._)("blockquote",null,[(0,a._)("p",null,[dn,(0,a._)("a",un,[kn,(0,a.Wm)(s)]),mn,bn,vn,gn,fn])]),hn,(0,a._)("details",yn,[wn,(0,a._)("blockquote",null,[(0,a._)("p",null,[_n,Fn,Un,Wn,Cn,Pn,xn,(0,a.Wm)(Sn,{to:"/react/process/doubleBuffer.html"},{default:(0,a.w5)((()=>[Ln])),_:1}),jn])]),In,(0,a._)("p",null,[(0,a.Wm)(Sn,{to:"/react/me.html"},{default:(0,a.w5)((()=>[Rn])),_:1}),Tn,Dn,On])]),En,Mn,(0,a._)("img",{src:n.$withBase("/img/beginWork.png"),alt:"beginWorkæµç¨‹å›¾"},null,8,Bn)])}]])},13860:(n,e)=>{e.Z=(n,e)=>{const s=n.__vccOpts||n;for(const[n,a]of e)s[n]=a;return s}},92493:(n,e,s)=>{s.r(e),s.d(e,{data:()=>a});const a=JSON.parse('{"key":"v-5b4ba768","path":"/react/process/beginWork.html","title":"beginWork","lang":"zh-CN","frontmatter":{"title":"beginWork","author":"BetaSu","tag":["React"],"summary":"ä¸Šä¸€èŠ‚æˆ‘ä»¬äº†è§£åˆ°renderé˜¶æ®µçš„å·¥ä½œå¯ä»¥åˆ†ä¸ºâ€œé€’â€é˜¶æ®µå’Œâ€œå½’â€é˜¶æ®µã€‚å…¶ä¸­â€œé€’â€é˜¶æ®µä¼šæ‰§è¡ŒbeginWorkï¼Œâ€œå½’â€é˜¶æ®µä¼šæ‰§è¡ŒcompleteWorkã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬çœ‹çœ‹â€œé€’â€é˜¶æ®µçš„beginWorkæ–¹æ³•ç©¶ç«Ÿåšäº†ä»€ä¹ˆã€‚ æ–¹æ³•æ¦‚è§ˆ å¯ä»¥ä»æºç è¿™é‡Œçœ‹åˆ°beginWorkçš„å®šä¹‰ã€‚æ•´ä¸ªæ–¹æ³•å¤§æ¦‚æœ‰500è¡Œä»£ç ã€‚ ä»ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒbeginWorkçš„å·¥ä½œæ˜¯ä¼ å…¥å½“å‰Fi","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/process/beginWork.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"beginWork"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"æ–¹æ³•æ¦‚è§ˆ","slug":"æ–¹æ³•æ¦‚è§ˆ","children":[{"level":3,"title":"ä»ä¼ å‚çœ‹æ–¹æ³•æ‰§è¡Œ","slug":"ä»ä¼ å‚çœ‹æ–¹æ³•æ‰§è¡Œ","children":[]}]},{"level":2,"title":"updateæ—¶","slug":"updateæ—¶","children":[]},{"level":2,"title":"mountæ—¶","slug":"mountæ—¶","children":[]},{"level":2,"title":"reconcileChildren","slug":"reconcilechildren","children":[]},{"level":2,"title":"effectTag","slug":"effecttag","children":[]},{"level":2,"title":"å‚è€ƒèµ„æ–™","slug":"å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":5.42,"words":1626},"filePathRelative":"react/process/beginWork.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);