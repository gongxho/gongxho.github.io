"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[99597],{79511:(n,s,a)=>{a.r(s),a.d(s,{default:()=>x});var e=a(78e3);const t=(0,e._)("div",{class:"custom-container warning"},[(0,e._)("p",{class:"custom-container-title"},"æœ¬ç« ä¸ºé€‰è¯»ç« èŠ‚"),(0,e._)("p",null,"æ˜¯å¦å­¦ä¹ è¯¥ç« å¯¹åç»­ç« èŠ‚çš„å­¦ä¹ æ²¡æœ‰å½±å“ã€‚")],-1),o=(0,e.Uk)("åœ¨"),p=(0,e.Uk)("beginWorkä¸€èŠ‚"),c=(0,e.Uk)("æˆ‘ä»¬æåˆ°"),l=(0,e._)("blockquote",null,[(0,e._)("p",null,[(0,e.Uk)("å¯¹äº"),(0,e._)("code",null,"update"),(0,e.Uk)("çš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„FiberèŠ‚ç‚¹æ¯”è¾ƒï¼ˆä¹Ÿå°±æ˜¯ä¿—ç§°çš„Diffç®—æ³•ï¼‰ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°FiberèŠ‚ç‚¹ã€‚")])],-1),i=(0,e._)("p",null,[(0,e.Uk)("è¿™ä¸€ç« æˆ‘ä»¬è®²è§£"),(0,e._)("code",null,"Diffç®—æ³•"),(0,e.Uk)("çš„å®ç°ã€‚")],-1),d=(0,e.Uk)("ä½ å¯ä»¥ä»"),r={href:"https://zh-hans.reactjs.org/docs/reconciliation.html#the-diffing-algorithm",target:"_blank",rel:"noopener noreferrer"},u=(0,e.Uk)("è¿™é‡Œ"),k=(0,e.Uk)("çœ‹åˆ°"),m=(0,e._)("code",null,"Diffç®—æ³•",-1),v=(0,e.Uk)("çš„ä»‹ç»ã€‚"),b=(0,e.uE)('<div class="custom-container warning"><p class="custom-container-title">ä¸ºäº†é˜²æ­¢æ¦‚å¿µæ··æ·†ï¼Œè¿™é‡Œå†å¼ºè°ƒä¸‹</p><p>ä¸€ä¸ª<code>DOMèŠ‚ç‚¹</code>åœ¨æŸä¸€æ—¶åˆ»æœ€å¤šä¼šæœ‰4ä¸ªèŠ‚ç‚¹å’Œä»–ç›¸å…³ã€‚</p><ol><li><p><code>current Fiber</code>ã€‚å¦‚æœè¯¥<code>DOMèŠ‚ç‚¹</code>å·²åœ¨é¡µé¢ä¸­ï¼Œ<code>current Fiber</code>ä»£è¡¨è¯¥<code>DOMèŠ‚ç‚¹</code>å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>ã€‚</p></li><li><p><code>workInProgress Fiber</code>ã€‚å¦‚æœè¯¥<code>DOMèŠ‚ç‚¹</code>å°†åœ¨æœ¬æ¬¡æ›´æ–°ä¸­æ¸²æŸ“åˆ°é¡µé¢ä¸­ï¼Œ<code>workInProgress Fiber</code>ä»£è¡¨è¯¥<code>DOMèŠ‚ç‚¹</code>å¯¹åº”çš„<code>FiberèŠ‚ç‚¹</code>ã€‚</p></li><li><p><code>DOMèŠ‚ç‚¹</code>æœ¬èº«ã€‚</p></li><li><p><code>JSXå¯¹è±¡</code>ã€‚å³<code>ClassComponent</code>çš„<code>render</code>æ–¹æ³•çš„è¿”å›ç»“æœï¼Œæˆ–<code>FunctionComponent</code>çš„è°ƒç”¨ç»“æœã€‚<code>JSXå¯¹è±¡</code>ä¸­åŒ…å«æè¿°<code>DOMèŠ‚ç‚¹</code>çš„ä¿¡æ¯ã€‚</p></li></ol><p><code>Diffç®—æ³•</code>çš„æœ¬è´¨æ˜¯å¯¹æ¯”1å’Œ4ï¼Œç”Ÿæˆ2ã€‚</p></div><h2 id="diffçš„ç“¶é¢ˆä»¥åŠreactå¦‚ä½•åº”å¯¹" tabindex="-1"><a class="header-anchor" href="#diffçš„ç“¶é¢ˆä»¥åŠreactå¦‚ä½•åº”å¯¹" aria-hidden="true">#</a> Diffçš„ç“¶é¢ˆä»¥åŠReactå¦‚ä½•åº”å¯¹</h2><p>ç”±äº<code>Diff</code>æ“ä½œæœ¬èº«ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æŸè€—ï¼ŒReactæ–‡æ¡£ä¸­æåˆ°ï¼Œå³ä½¿åœ¨æœ€å‰æ²¿çš„ç®—æ³•ä¸­ï¼Œå°†å‰åä¸¤æ£µæ ‘å®Œå…¨æ¯”å¯¹çš„ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä¸º O(n 3 )ï¼Œå…¶ä¸­<code>n</code>æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚</p><p>å¦‚æœåœ¨<code>React</code>ä¸­ä½¿ç”¨äº†è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆå±•ç¤º1000ä¸ªå…ƒç´ æ‰€éœ€è¦æ‰§è¡Œçš„è®¡ç®—é‡å°†åœ¨åäº¿çš„é‡çº§èŒƒå›´ã€‚è¿™ä¸ªå¼€é”€å®åœ¨æ˜¯å¤ªè¿‡é«˜æ˜‚ã€‚</p><p>ä¸ºäº†é™ä½ç®—æ³•å¤æ‚åº¦ï¼Œ<code>React</code>çš„<code>diff</code>ä¼šé¢„è®¾ä¸‰ä¸ªé™åˆ¶ï¼š</p><ol><li><p>åªå¯¹åŒçº§å…ƒç´ è¿›è¡Œ<code>Diff</code>ã€‚å¦‚æœä¸€ä¸ª<code>DOMèŠ‚ç‚¹</code>åœ¨å‰åä¸¤æ¬¡æ›´æ–°ä¸­è·¨è¶Šäº†å±‚çº§ï¼Œé‚£ä¹ˆ<code>React</code>ä¸ä¼šå°è¯•å¤ç”¨ä»–ã€‚</p></li><li><p>ä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿå‡ºä¸åŒçš„æ ‘ã€‚å¦‚æœå…ƒç´ ç”±<code>div</code>å˜ä¸º<code>p</code>ï¼ŒReactä¼šé”€æ¯<code>div</code>åŠå…¶å­å­™èŠ‚ç‚¹ï¼Œå¹¶æ–°å»º<code>p</code>åŠå…¶å­å­™èŠ‚ç‚¹ã€‚</p></li><li><p>å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>key prop</code>æ¥æš—ç¤ºå“ªäº›å­å…ƒç´ åœ¨ä¸åŒçš„æ¸²æŸ“ä¸‹èƒ½ä¿æŒç¨³å®šã€‚è€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š</p></li></ol><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// æ›´æ–°å‰</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ka<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">ka</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>song<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">song</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token comment">// æ›´æ–°å</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>song<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">song</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ka<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">ka</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ²¡æœ‰<code>key</code>ï¼Œ<code>React</code>ä¼šè®¤ä¸º<code>div</code>çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç”±<code>p</code>å˜ä¸º<code>h3</code>ï¼Œç¬¬äºŒä¸ªå­èŠ‚ç‚¹ç”±<code>h3</code>å˜ä¸º<code>p</code>ã€‚è¿™ç¬¦åˆé™åˆ¶2çš„è®¾å®šï¼Œä¼šé”€æ¯å¹¶æ–°å»ºã€‚</p><p>ä½†æ˜¯å½“æˆ‘ä»¬ç”¨<code>key</code>æŒ‡æ˜äº†èŠ‚ç‚¹å‰åå¯¹åº”å…³ç³»åï¼Œ<code>React</code>çŸ¥é“<code>key === &quot;ka&quot;</code>çš„<code>p</code>åœ¨æ›´æ–°åè¿˜å­˜åœ¨ï¼Œæ‰€ä»¥<code>DOMèŠ‚ç‚¹</code>å¯ä»¥å¤ç”¨ï¼Œåªæ˜¯éœ€è¦äº¤æ¢ä¸‹é¡ºåºã€‚</p><p>è¿™å°±æ˜¯<code>React</code>ä¸ºäº†åº”å¯¹ç®—æ³•æ€§èƒ½ç“¶é¢ˆåšå‡ºçš„ä¸‰æ¡é™åˆ¶ã€‚</p><h2 id="diffæ˜¯å¦‚ä½•å®ç°çš„" tabindex="-1"><a class="header-anchor" href="#diffæ˜¯å¦‚ä½•å®ç°çš„" aria-hidden="true">#</a> Diffæ˜¯å¦‚ä½•å®ç°çš„</h2><p>æˆ‘ä»¬ä»<code>Diff</code>çš„å…¥å£å‡½æ•°<code>reconcileChildFibers</code>å‡ºå‘ï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®<code>newChild</code>ï¼ˆå³<code>JSXå¯¹è±¡</code>ï¼‰ç±»å‹è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°ã€‚</p>',12),f=(0,e.Uk)("ä½ å¯ä»¥ä»"),g={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactChildFiber.new.js#L1280",target:"_blank",rel:"noopener noreferrer"},h=(0,e.Uk)("è¿™é‡Œ"),y=(0,e.Uk)("çœ‹åˆ°"),w=(0,e._)("code",null,"reconcileChildFibers",-1),_=(0,e.Uk)("çš„æºç ã€‚"),C=(0,e.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æ ¹æ®newChildç±»å‹é€‰æ‹©ä¸åŒdiffå‡½æ•°å¤„ç†</span>\n<span class="token keyword">function</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>\n  <span class="token parameter"><span class="token literal-property property">returnFiber</span><span class="token operator">:</span> Fiber<span class="token punctuation">,</span>\n  <span class="token literal-property property">currentFirstChild</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">newChild</span><span class="token operator">:</span> any<span class="token punctuation">,</span></span>\n<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>\n\n  <span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">&amp;&amp;</span> newChild <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>isObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// objectç±»å‹ï¼Œå¯èƒ½æ˜¯ REACT_ELEMENT_TYPE æˆ– REACT_PORTAL_TYPE</span>\n    <span class="token keyword">switch</span> <span class="token punctuation">(</span>newChild<span class="token punctuation">.</span>$$<span class="token keyword">typeof</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">case</span> <span class="token constant">REACT_ELEMENT_TYPE</span><span class="token operator">:</span>\n        <span class="token comment">// è°ƒç”¨ reconcileSingleElement å¤„ç†</span>\n      <span class="token comment">// // ...çœç•¥å…¶ä»–case</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> newChild <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// è°ƒç”¨ reconcileSingleTextNode å¤„ç†</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>newChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// è°ƒç”¨ reconcileChildrenArray å¤„ç†</span>\n    <span class="token comment">// ...çœç•¥</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ä¸€äº›å…¶ä»–æƒ…å†µè°ƒç”¨å¤„ç†å‡½æ•°</span>\n  <span class="token comment">// ...çœç•¥</span>\n\n  <span class="token comment">// ä»¥ä¸Šéƒ½æ²¡æœ‰å‘½ä¸­ï¼Œåˆ é™¤èŠ‚ç‚¹</span>\n  <span class="token keyword">return</span> <span class="token function">deleteRemainingChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥ä»åŒçº§çš„èŠ‚ç‚¹æ•°é‡å°†Diffåˆ†ä¸ºä¸¤ç±»ï¼š</p><ol><li><p>å½“<code>newChild</code>ç±»å‹ä¸º<code>object</code>ã€<code>number</code>ã€<code>string</code>ï¼Œä»£è¡¨åŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</p></li><li><p>å½“<code>newChild</code>ç±»å‹ä¸º<code>Array</code>ï¼ŒåŒçº§æœ‰å¤šä¸ªèŠ‚ç‚¹</p></li></ol><p>åœ¨æ¥ä¸‹æ¥ä¸¤èŠ‚æˆ‘ä»¬ä¼šåˆ†åˆ«è®¨è®ºè¿™ä¸¤ç±»èŠ‚ç‚¹çš„<code>Diff</code>ã€‚</p>',4),D={},x=(0,a(13860).Z)(D,[["render",function(n,s){const a=(0,e.up)("RouterLink"),D=(0,e.up)("ExternalLinkIcon");return(0,e.wg)(),(0,e.iD)("div",null,[t,(0,e._)("p",null,[o,(0,e.Wm)(a,{to:"/react/process/beginWork.html#reconcilechildren"},{default:(0,e.w5)((()=>[p])),_:1}),c]),l,i,(0,e._)("blockquote",null,[(0,e._)("p",null,[d,(0,e._)("a",r,[u,(0,e.Wm)(D)]),k,m,v])]),b,(0,e._)("blockquote",null,[(0,e._)("p",null,[f,(0,e._)("a",g,[h,(0,e.Wm)(D)]),y,w,_])]),C])}]])},13860:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,e]of s)a[n]=e;return a}},86562:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e=JSON.parse('{"key":"v-0df63653","path":"/react/diff/prepare.html","title":"diffæ¦‚è§ˆ","lang":"zh-CN","frontmatter":{"title":"diffæ¦‚è§ˆ","author":"BetaSu","tag":["React"],"summary":"æœ¬ç« ä¸ºé€‰è¯»ç« èŠ‚ æ˜¯å¦å­¦ä¹ è¯¥ç« å¯¹åç»­ç« èŠ‚çš„å­¦ä¹ æ²¡æœ‰å½±å“ã€‚ åœ¨beginWorkä¸€èŠ‚æˆ‘ä»¬æåˆ° \\" å¯¹äºupdateçš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„FiberèŠ‚ç‚¹æ¯”è¾ƒï¼ˆä¹Ÿå°±æ˜¯ä¿—ç§°çš„Diffç®—æ³•ï¼‰ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°FiberèŠ‚ç‚¹ã€‚\\" è¿™ä¸€ç« æˆ‘ä»¬è®²è§£Diffç®—æ³•çš„å®ç°ã€‚ \\" ä½ å¯ä»¥ä»è¿™é‡Œçœ‹åˆ°Diffç®—æ³•çš„ä»‹ç»ã€‚\\" ä¸ºäº†é˜²æ­¢æ¦‚å¿µæ··æ·†ï¼Œè¿™é‡Œå†å¼ºè°ƒä¸‹ ä¸€ä¸ª","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/diff/prepare.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"diffæ¦‚è§ˆ"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"Diffçš„ç“¶é¢ˆä»¥åŠReactå¦‚ä½•åº”å¯¹","slug":"diffçš„ç“¶é¢ˆä»¥åŠreactå¦‚ä½•åº”å¯¹","children":[]},{"level":2,"title":"Diffæ˜¯å¦‚ä½•å®ç°çš„","slug":"diffæ˜¯å¦‚ä½•å®ç°çš„","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":3.17,"words":952},"filePathRelative":"react/diff/prepare.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);