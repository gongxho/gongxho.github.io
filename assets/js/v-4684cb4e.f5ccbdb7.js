"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[69032],{25377:(e,a,n)=>{n.r(a),n.d(a,{default:()=>ze});var s=n(78e3);const t=(0,s.Uk)("é€šè¿‡"),p=(0,s.Uk)("æ›´æ–°çš„å¿ƒæ™ºæ¨¡å‹"),o=(0,s.Uk)("ï¼Œæˆ‘ä»¬äº†è§£åˆ°"),c=(0,s._)("code",null,"æ›´æ–°",-1),r=(0,s.Uk)("å…·æœ‰"),l=(0,s._)("code",null,"ä¼˜å…ˆçº§",-1),d=(0,s.Uk)("ã€‚"),i=(0,s._)("p",null,[(0,s.Uk)("é‚£ä¹ˆä»€ä¹ˆæ˜¯"),(0,s._)("code",null,"ä¼˜å…ˆçº§"),(0,s.Uk)("ï¼Ÿ"),(0,s._)("code",null,"ä¼˜å…ˆçº§"),(0,s.Uk)("ä»¥ä»€ä¹ˆä¸ºä¾æ®ï¼Ÿå¦‚ä½•é€šè¿‡"),(0,s._)("code",null,"ä¼˜å…ˆçº§"),(0,s.Uk)("å†³å®šå“ªä¸ªçŠ¶æ€åº”è¯¥å…ˆè¢«æ›´æ–°ï¼Ÿ")],-1),u=(0,s._)("p",null,"æœ¬èŠ‚æˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£ã€‚",-1),k=(0,s._)("h2",{id:"ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§",tabindex:"-1"},[(0,s._)("a",{class:"header-anchor",href:"#ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§","aria-hidden":"true"},"#"),(0,s.Uk)(" ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§")],-1),m=(0,s.Uk)("åœ¨"),v=(0,s.Uk)("Reactç†å¿µä¸€èŠ‚"),b=(0,s.Uk)("æˆ‘ä»¬èŠåˆ°"),U=(0,s._)("code",null,"React",-1),h=(0,s.Uk)("å°†äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœæ•´åˆåˆ°çœŸå®çš„"),g=(0,s._)("code",null,"UI",-1),y=(0,s.Uk)("ä¸­ã€‚å…·ä½“åˆ°"),_=(0,s._)("code",null,"React",-1),f=(0,s.Uk)("è¿è¡Œä¸Šè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ"),w=(0,s.uE)('<p><code>çŠ¶æ€æ›´æ–°</code>ç”±<code>ç”¨æˆ·äº¤äº’</code>äº§ç”Ÿï¼Œç”¨æˆ·å¿ƒé‡Œå¯¹<code>äº¤äº’</code>æ‰§è¡Œé¡ºåºæœ‰ä¸ªé¢„æœŸã€‚<code>React</code>æ ¹æ®<code>äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœ</code>ä¸­ç”¨æˆ·å¯¹<code>äº¤äº’</code>çš„é¢„æœŸé¡ºåºä¸º<code>äº¤äº’</code>äº§ç”Ÿçš„<code>çŠ¶æ€æ›´æ–°</code>èµ‹äºˆä¸åŒä¼˜å…ˆçº§ã€‚</p><p>å…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><p>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼šåŒæ­¥æ‰§è¡Œã€‚</p></li><li><p>å—æ§çš„ç”¨æˆ·è¾“å…¥ï¼šæ¯”å¦‚è¾“å…¥æ¡†å†…è¾“å…¥æ–‡å­—ï¼ŒåŒæ­¥æ‰§è¡Œã€‚</p></li><li><p>äº¤äº’äº‹ä»¶ï¼šæ¯”å¦‚åŠ¨ç”»ï¼Œé«˜ä¼˜å…ˆçº§æ‰§è¡Œã€‚</p></li><li><p>å…¶ä»–ï¼šæ¯”å¦‚æ•°æ®è¯·æ±‚ï¼Œä½ä¼˜å…ˆçº§æ‰§è¡Œã€‚</p></li></ul><h2 id="å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§" aria-hidden="true">#</a> å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§</h2>',4),j=(0,s.Uk)("æˆ‘ä»¬åœ¨"),B=(0,s.Uk)("æ–°çš„Reactç»“æ„ä¸€èŠ‚"),x=(0,s.Uk)("è®²åˆ°ï¼Œ"),S=(0,s._)("code",null,"React",-1),R=(0,s.Uk)("é€šè¿‡"),E=(0,s._)("code",null,"Scheduler",-1),W=(0,s.Uk)("è°ƒåº¦ä»»åŠ¡ã€‚"),A=(0,s.uE)("<p>å…·ä½“åˆ°ä»£ç ï¼Œæ¯å½“éœ€è¦è°ƒåº¦ä»»åŠ¡æ—¶ï¼Œ<code>React</code>ä¼šè°ƒç”¨<code>Scheduler</code>æä¾›çš„æ–¹æ³•<code>runWithPriority</code>ã€‚</p><p>è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>ä¼˜å…ˆçº§</code>å¸¸é‡ä¸ä¸€ä¸ª<code>å›è°ƒå‡½æ•°</code>ä½œä¸ºå‚æ•°ã€‚<code>å›è°ƒå‡½æ•°</code>ä¼šä»¥<code>ä¼˜å…ˆçº§</code>é«˜ä½ä¸ºé¡ºåºæ’åˆ—åœ¨ä¸€ä¸ª<code>å®šæ—¶å™¨</code>ä¸­å¹¶åœ¨åˆé€‚çš„æ—¶é—´è§¦å‘ã€‚</p>",2),Q=(0,s.Uk)("å¯¹äºæ›´æ–°æ¥è®²ï¼Œä¼ é€’çš„"),C=(0,s._)("code",null,"å›è°ƒå‡½æ•°",-1),D=(0,s.Uk)("ä¸€èˆ¬ä¸º"),I=(0,s.Uk)("çŠ¶æ€æ›´æ–°æµç¨‹æ¦‚è§ˆä¸€èŠ‚"),T=(0,s.Uk)("è®²åˆ°çš„"),P=(0,s._)("code",null,"renderé˜¶æ®µçš„å…¥å£å‡½æ•°",-1),z=(0,s.Uk)("ã€‚"),q=(0,s.Uk)("ä½ å¯ä»¥åœ¨"),L={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/Scheduler.js#L217",target:"_blank",rel:"noopener noreferrer"},X=(0,s.Uk)("==unstable_runWithPriority== è¿™é‡Œ"),F=(0,s.Uk)("çœ‹åˆ°"),N=(0,s._)("code",null,"runWithPriority",-1),Z=(0,s.Uk)("æ–¹æ³•çš„å®šä¹‰ã€‚åœ¨"),H={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/SchedulerPriorities.js",target:"_blank",rel:"noopener noreferrer"},O=(0,s.Uk)("è¿™é‡Œ"),J=(0,s.Uk)("çœ‹åˆ°"),$=(0,s._)("code",null,"Scheduler",-1),G=(0,s.Uk)("å¯¹ä¼˜å…ˆçº§å¸¸é‡çš„å®šä¹‰ã€‚"),K=(0,s._)("h2",{id:"ä¾‹å­",tabindex:"-1"},[(0,s._)("a",{class:"header-anchor",href:"#ä¾‹å­","aria-hidden":"true"},"#"),(0,s.Uk)(" ä¾‹å­")],-1),M=(0,s._)("p",null,[(0,s.Uk)("ä¼˜å…ˆçº§æœ€ç»ˆä¼šåæ˜ åˆ°"),(0,s._)("code",null,"update.lane"),(0,s.Uk)("å˜é‡ä¸Šã€‚å½“å‰æˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªå˜é‡èƒ½å¤ŸåŒºåˆ†"),(0,s._)("code",null,"Update"),(0,s.Uk)("çš„ä¼˜å…ˆçº§ã€‚")],-1),V=(0,s._)("p",null,[(0,s.Uk)("æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­ç»“åˆä¸Šä¸€èŠ‚ä»‹ç»çš„"),(0,s._)("code",null,"Update"),(0,s.Uk)("ç›¸å…³å­—æ®µè®²è§£ä¼˜å…ˆçº§å¦‚ä½•å†³å®šæ›´æ–°çš„é¡ºåºã€‚")],-1),Y=(0,s.Uk)("è¯¥ä¾‹å­æ¥è‡ª"),ee={href:"https://twitter.com/acdlite/status/978412930973687808",target:"_blank",rel:"noopener noreferrer"},ae=(0,s.Uk)("React Core Team Andrewå‘ç½‘å‹è®²è§£Updateå·¥ä½œæµç¨‹çš„æ¨æ–‡"),ne=["src"],se=(0,s.uE)('<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸¤ä¸ª<code>Update</code>ã€‚æˆ‘ä»¬å°†â€œå…³é—­é»‘å¤œæ¨¡å¼â€äº§ç”Ÿçš„<code>Update</code>ç§°ä¸º<code>u1</code>ï¼Œè¾“å…¥å­—æ¯â€œIâ€äº§ç”Ÿçš„<code>Update</code>ç§°ä¸º<code>u2</code>ã€‚</p><p>å…¶ä¸­<code>u1</code>å…ˆè§¦å‘å¹¶è¿›å…¥<code>renderé˜¶æ®µ</code>ã€‚å…¶ä¼˜å…ˆçº§è¾ƒä½ï¼Œæ‰§è¡Œæ—¶é—´è¾ƒé•¿ã€‚æ­¤æ—¶ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;H&#39;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>\n  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">pending</span><span class="token operator">:</span> u1\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>u1</code>å®Œæˆ<code>renderé˜¶æ®µ</code>å‰ç”¨æˆ·é€šè¿‡é”®ç›˜è¾“å…¥å­—æ¯â€œIâ€ï¼Œäº§ç”Ÿäº†<code>u2</code>ã€‚<code>u2</code>å±äº<strong>å—æ§çš„ç”¨æˆ·è¾“å…¥</strong>ï¼Œä¼˜å…ˆçº§é«˜äº<code>u1</code>ï¼Œäºæ˜¯ä¸­æ–­<code>u1</code>äº§ç”Ÿçš„<code>renderé˜¶æ®µ</code>ã€‚</p><p>æ­¤æ—¶ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pending <span class="token operator">===</span> u2 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span> u1\n                                     <span class="token operator">^</span>        <span class="token operator">|</span>\n                                     <span class="token operator">|</span>________<span class="token operator">|</span>\n<span class="token comment">// å³</span>\nu2<span class="token punctuation">.</span>next <span class="token operator">===</span> u1<span class="token punctuation">;</span>\nu1<span class="token punctuation">.</span>next <span class="token operator">===</span> u2<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>u2</code>ä¼˜å…ˆçº§é«˜äº<code>u1</code>ã€‚</p><p>æ¥ä¸‹æ¥è¿›å…¥<code>u2</code>äº§ç”Ÿçš„<code>renderé˜¶æ®µ</code>ã€‚</p><p>åœ¨<code>processUpdateQueue</code>æ–¹æ³•ä¸­ï¼Œ<code>shared.pending</code>ç¯çŠ¶é“¾è¡¨ä¼šè¢«å‰ªå¼€å¹¶æ‹¼æ¥åœ¨<code>baseUpdate</code>åé¢ã€‚</p><p>éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œ<code>shared.pending</code>æŒ‡å‘æœ€åä¸€ä¸ª<code>pending</code>çš„<code>update</code>ï¼Œæ‰€ä»¥å®é™…æ‰§è¡Œæ—¶<code>update</code>çš„é¡ºåºä¸ºï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>u1 <span class="token operator">--</span> u2\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥éå†<code>baseUpdate</code>ï¼Œå¤„ç†ä¼˜å…ˆçº§åˆé€‚çš„<code>Update</code>ï¼ˆè¿™ä¸€æ¬¡å¤„ç†çš„æ˜¯æ›´é«˜ä¼˜çš„<code>u2</code>ï¼‰ã€‚</p><p>ç”±äº<code>u2</code>ä¸æ˜¯<code>baseUpdate</code>ä¸­çš„ç¬¬ä¸€ä¸ª<code>update</code>ï¼Œåœ¨å…¶ä¹‹å‰çš„<code>u1</code>ç”±äºä¼˜å…ˆçº§ä¸å¤Ÿè¢«è·³è¿‡ã€‚</p><p><code>update</code>ä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥è¢«è·³è¿‡çš„<code>update</code>åŠå…¶åé¢æ‰€æœ‰<code>update</code>ä¼šæˆä¸ºä¸‹æ¬¡æ›´æ–°çš„<code>baseUpdate</code>ã€‚ï¼ˆå³<code>u1 -- u2</code>ï¼‰ã€‚</p><p>æœ€ç»ˆ<code>u2</code>å®Œæˆ<code>render - commité˜¶æ®µ</code>ã€‚</p><p>æ­¤æ—¶ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;HI&#39;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> u1<span class="token punctuation">,</span>\n  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> u2\n  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>commit</code>é˜¶æ®µç»“å°¾ä¼šå†è°ƒåº¦ä¸€æ¬¡æ›´æ–°ã€‚åœ¨è¯¥æ¬¡æ›´æ–°ä¸­ä¼šåŸºäº<code>baseState</code>ä¸­<code>firstBaseUpdate</code>ä¿å­˜çš„<code>u1</code>ï¼Œå¼€å¯ä¸€æ¬¡æ–°çš„<code>renderé˜¶æ®µ</code>ã€‚</p><p>æœ€ç»ˆä¸¤æ¬¡<code>Update</code>éƒ½å®Œæˆåçš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;HI&#39;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>\n  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œ<code>u2</code>å¯¹åº”çš„æ›´æ–°æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç›¸åº”çš„<code>renderé˜¶æ®µ</code>çš„ç”Ÿå‘½å‘¨æœŸå‹¾å­<code>componentWillXXX</code>ä¹Ÿä¼šè§¦å‘ä¸¤æ¬¡ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™äº›å‹¾å­ä¼šè¢«æ ‡è®°ä¸º<code>unsafe_</code>ã€‚</p><h2 id="å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®" aria-hidden="true">#</a> å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®</h2><p>ç°åœ¨æˆ‘ä»¬åŸºæœ¬æŒæ¡äº†<code>updateQueue</code>çš„å·¥ä½œæµç¨‹ã€‚è¿˜æœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p><ul><li><p><code>renderé˜¶æ®µ</code>å¯èƒ½è¢«ä¸­æ–­ã€‚å¦‚ä½•ä¿è¯<code>updateQueue</code>ä¸­ä¿å­˜çš„<code>Update</code>ä¸ä¸¢å¤±ï¼Ÿ</p></li><li><p>æœ‰æ—¶å€™å½“å‰<code>çŠ¶æ€</code>éœ€è¦ä¾èµ–å‰ä¸€ä¸ª<code>çŠ¶æ€</code>ã€‚å¦‚ä½•åœ¨æ”¯æŒè·³è¿‡<code>ä½ä¼˜å…ˆçº§çŠ¶æ€</code>çš„åŒæ—¶ä¿è¯<strong>çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§</strong>ï¼Ÿ</p></li></ul><p>æˆ‘ä»¬åˆ†åˆ«è®²è§£ä¸‹ã€‚</p><h3 id="å¦‚ä½•ä¿è¯updateä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯updateä¸ä¸¢å¤±" aria-hidden="true">#</a> å¦‚ä½•ä¿è¯<code>Update</code>ä¸ä¸¢å¤±</h3>',26),te=(0,s.Uk)("åœ¨"),pe=(0,s.Uk)("ä¸Šä¸€èŠ‚ä¾‹å­"),oe=(0,s.Uk)("ä¸­æˆ‘ä»¬è®²åˆ°ï¼Œåœ¨"),ce=(0,s._)("code",null,"renderé˜¶æ®µ",-1),re=(0,s.Uk)("ï¼Œ"),le=(0,s._)("code",null,"shared.pending",-1),de=(0,s.Uk)("çš„ç¯è¢«å‰ªå¼€å¹¶è¿æ¥åœ¨"),ie=(0,s._)("code",null,"updateQueue.lastBaseUpdate",-1),ue=(0,s.Uk)("åé¢ã€‚"),ke=(0,s._)("p",null,[(0,s.Uk)("å®é™…ä¸Š"),(0,s._)("code",null,"shared.pending"),(0,s.Uk)("ä¼šè¢«åŒæ—¶è¿æ¥åœ¨"),(0,s._)("code",null,"workInProgress updateQueue.lastBaseUpdate"),(0,s.Uk)("ä¸"),(0,s._)("code",null,"current updateQueue.lastBaseUpdate"),(0,s.Uk)("åé¢ã€‚")],-1),me=(0,s.Uk)("å…·ä½“ä»£ç è§"),ve={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L424",target:"_blank",rel:"noopener noreferrer"},be=(0,s.Uk)("è¿™é‡Œ"),Ue=(0,s.uE)('<p>å½“<code>renderé˜¶æ®µ</code>è¢«ä¸­æ–­åé‡æ–°å¼€å§‹æ—¶ï¼Œä¼šåŸºäº<code>current updateQueue</code>å…‹éš†å‡º<code>workInProgress updateQueue</code>ã€‚ç”±äº<code>current updateQueue.lastBaseUpdate</code>å·²ç»ä¿å­˜äº†ä¸Šä¸€æ¬¡çš„<code>Update</code>ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢å¤±ã€‚</p><p>å½“<code>commité˜¶æ®µ</code>å®Œæˆæ¸²æŸ“ï¼Œç”±äº<code>workInProgress updateQueue.lastBaseUpdate</code>ä¸­ä¿å­˜äº†ä¸Šä¸€æ¬¡çš„<code>Update</code>ï¼Œæ‰€ä»¥ <code>workInProgress Fiberæ ‘</code>å˜æˆ<code>current Fiberæ ‘</code>åä¹Ÿä¸ä¼šé€ æˆ<code>Update</code>ä¸¢å¤±ã€‚</p><h3 id="å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§" aria-hidden="true">#</a> å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§</h3><p>å½“æŸä¸ª<code>Update</code>ç”±äºä¼˜å…ˆçº§ä½è€Œè¢«è·³è¿‡æ—¶ï¼Œä¿å­˜åœ¨<code>baseUpdate</code>ä¸­çš„ä¸ä»…æ˜¯è¯¥<code>Update</code>ï¼Œè¿˜åŒ…æ‹¬é“¾è¡¨ä¸­è¯¥<code>Update</code>ä¹‹åçš„æ‰€æœ‰<code>Update</code>ã€‚</p><p>è€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>\nshared<span class="token punctuation">.</span>pending<span class="token operator">:</span> <span class="token constant">A1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">B2</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">C1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">D2</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>å­—æ¯</code>ä»£è¡¨è¯¥<code>Update</code>è¦åœ¨é¡µé¢æ’å…¥çš„å­—æ¯ï¼Œ<code>æ•°å­—</code>ä»£è¡¨<code>ä¼˜å…ˆçº§</code>ï¼Œå€¼è¶Šä½<code>ä¼˜å…ˆçº§</code>è¶Šé«˜ã€‚</p><p>ç¬¬ä¸€æ¬¡<code>render</code>ï¼Œ<code>ä¼˜å…ˆçº§</code>ä¸º1ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>\n<span class="token literal-property property">baseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>\n<span class="token literal-property property">renderé˜¶æ®µä½¿ç”¨çš„Update</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token constant">C1</span><span class="token punctuation">]</span>\n<span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token string">&#39;AC&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<code>B2</code>ç”±äºä¼˜å…ˆçº§ä¸º2ï¼Œä½äºå½“å‰ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ä»–åŠå…¶åé¢çš„æ‰€æœ‰<code>Update</code>ä¼šè¢«ä¿å­˜åœ¨<code>baseUpdate</code>ä¸­ä½œä¸ºä¸‹æ¬¡æ›´æ–°çš„<code>Update</code>ï¼ˆå³<code>B2 C1 D2</code>ï¼‰ã€‚</p><p>è¿™ä¹ˆåšæ˜¯ä¸ºäº†ä¿æŒ<code>çŠ¶æ€</code>çš„å‰åä¾èµ–é¡ºåºã€‚</p><p>ç¬¬äºŒæ¬¡<code>render</code>ï¼Œ<code>ä¼˜å…ˆçº§</code>ä¸º2ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;A&#39;</span>\n<span class="token literal-property property">baseUpdate</span><span class="token operator">:</span> <span class="token constant">B2</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">C1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">D2</span>\n<span class="token literal-property property">renderé˜¶æ®µä½¿ç”¨çš„Update</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">B2</span><span class="token punctuation">,</span> <span class="token constant">C1</span><span class="token punctuation">,</span> <span class="token constant">D2</span><span class="token punctuation">]</span>\n<span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token string">&#39;ABCD&#39;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„è¿™é‡Œ<code>baseState</code>å¹¶ä¸æ˜¯ä¸Šä¸€æ¬¡æ›´æ–°çš„<code>memoizedState</code>ã€‚è¿™æ˜¯ç”±äº<code>B2</code>è¢«è·³è¿‡äº†ã€‚</p><p>å³å½“æœ‰<code>Update</code>è¢«è·³è¿‡æ—¶ï¼Œ<code>ä¸‹æ¬¡æ›´æ–°çš„baseState !== ä¸Šæ¬¡æ›´æ–°çš„memoizedState</code>ã€‚</p>',15),he=(0,s.Uk)("è·³è¿‡"),ge=(0,s._)("code",null,"B2",-1),ye=(0,s.Uk)("çš„é€»è¾‘è§"),_e={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L479",target:"_blank",rel:"noopener noreferrer"},fe=(0,s.Uk)("è¿™é‡Œ"),we=(0,s._)("p",null,[(0,s.Uk)("é€šè¿‡ä»¥ä¸Šä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ"),(0,s._)("code",null,"React"),(0,s.Uk)("ä¿è¯æœ€ç»ˆçš„çŠ¶æ€ä¸€å®šå’Œç”¨æˆ·è§¦å‘çš„"),(0,s._)("code",null,"äº¤äº’"),(0,s.Uk)("ä¸€è‡´ï¼Œä½†æ˜¯ä¸­é—´è¿‡ç¨‹"),(0,s._)("code",null,"çŠ¶æ€"),(0,s.Uk)("å¯èƒ½ç”±äºè®¾å¤‡ä¸åŒè€Œä¸åŒã€‚")],-1),je={class:"custom-container details"},Be=(0,s._)("summary",null,"é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡Demo",-1),xe=(0,s.Uk)("å…³æ³¨å…¬ä¼—å·"),Se=(0,s.Uk)("ï¼Œåå°å›å¤"),Re=(0,s._)("strong",null,"815",-1),Ee=(0,s.Uk)("è·å¾—åœ¨çº¿Demoåœ°å€"),We=(0,s._)("h2",{id:"å‚è€ƒèµ„æ–™",tabindex:"-1"},[(0,s._)("a",{class:"header-anchor",href:"#å‚è€ƒèµ„æ–™","aria-hidden":"true"},"#"),(0,s.Uk)(" å‚è€ƒèµ„æ–™")],-1),Ae={href:"https://juejin.im/post/5f05a3e25188252e5c576cdb",target:"_blank",rel:"noopener noreferrer"},Qe=(0,s.Uk)("æ·±å…¥æºç å‰–æcomponentWillXXXä¸ºä»€ä¹ˆUNSAFE"),Ce={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L10",target:"_blank",rel:"noopener noreferrer"},De=(0,s.Uk)("Reactæºç ä¸­è®²è§£Updateå·¥ä½œæµç¨‹åŠä¼˜å…ˆçº§çš„æ³¨é‡Š"),Ie={href:"https://twitter.com/acdlite/status/978412930973687808",target:"_blank",rel:"noopener noreferrer"},Te=(0,s.Uk)("React Core Team Andrewå‘ç½‘å‹è®²è§£Updateå·¥ä½œæµç¨‹çš„æ¨æ–‡"),Pe={},ze=(0,n(13860).Z)(Pe,[["render",function(e,a){const n=(0,s.up)("RouterLink"),Pe=(0,s.up)("ExternalLinkIcon");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("p",null,[t,(0,s.Wm)(n,{to:"/react/state/mental.html"},{default:(0,s.w5)((()=>[p])),_:1}),o,c,r,l,d]),i,u,k,(0,s._)("p",null,[m,(0,s.Wm)(n,{to:"/react/preparation/idea.html#%E7%90%86%E8%A7%A3-%E5%93%8D%E5%BA%94%E8%87%AA%E7%84%B6"},{default:(0,s.w5)((()=>[v])),_:1}),b,U,h,g,y,_,f]),w,(0,s._)("p",null,[j,(0,s.Wm)(n,{to:"/react/preparation/newConstructure.html"},{default:(0,s.w5)((()=>[B])),_:1}),x,S,R,E,W]),A,(0,s._)("p",null,[Q,C,D,(0,s.Wm)(n,{to:"/react/state/prepare.html#render%E9%98%B6%E6%AE%B5%E7%9A%84%E5%BC%80%E5%A7%8B"},{default:(0,s.w5)((()=>[I])),_:1}),T,P,z]),(0,s._)("blockquote",null,[(0,s._)("p",null,[q,(0,s._)("a",L,[X,(0,s.Wm)(Pe)]),F,N,Z,(0,s._)("a",H,[O,(0,s.Wm)(Pe)]),J,$,G])]),K,M,V,(0,s._)("blockquote",null,[(0,s._)("p",null,[Y,(0,s._)("a",ee,[ae,(0,s.Wm)(Pe)])])]),(0,s._)("img",{src:e.$withBase("/img/update-process.png"),alt:"ä¼˜å…ˆçº§å¦‚ä½•å†³å®šæ›´æ–°çš„é¡ºåº"},null,8,ne),se,(0,s._)("p",null,[te,(0,s.Wm)(n,{to:"/react/state/update.html#%E4%BE%8B%E5%AD%90"},{default:(0,s.w5)((()=>[pe])),_:1}),oe,ce,re,le,de,ie,ue]),ke,(0,s._)("blockquote",null,[(0,s._)("p",null,[me,(0,s._)("a",ve,[be,(0,s.Wm)(Pe)])])]),Ue,(0,s._)("blockquote",null,[(0,s._)("p",null,[he,ge,ye,(0,s._)("a",_e,[fe,(0,s.Wm)(Pe)])])]),we,(0,s._)("details",je,[Be,(0,s._)("p",null,[(0,s.Wm)(n,{to:"/react/me.html"},{default:(0,s.w5)((()=>[xe])),_:1}),Se,Re,Ee])]),We,(0,s._)("p",null,[(0,s._)("a",Ae,[Qe,(0,s.Wm)(Pe)])]),(0,s._)("p",null,[(0,s._)("a",Ce,[De,(0,s.Wm)(Pe)])]),(0,s._)("p",null,[(0,s._)("a",Ie,[Te,(0,s.Wm)(Pe)])]),(0,s.kq)(" beginWork getStateFromUpdate ")])}]])},13860:(e,a)=>{a.Z=(e,a)=>{const n=e.__vccOpts||e;for(const[e,s]of a)n[e]=s;return n}},63949:(e,a,n)=>{n.r(a),n.d(a,{data:()=>s});const s=JSON.parse('{"key":"v-4684cb4e","path":"/react/state/priority.html","title":"æ·±å…¥ç†è§£ä¼˜å…ˆçº§","lang":"zh-CN","frontmatter":{"title":"æ·±å…¥ç†è§£ä¼˜å…ˆçº§","author":"BetaSu","tag":["React"],"summary":"é€šè¿‡æ›´æ–°çš„å¿ƒæ™ºæ¨¡å‹ï¼Œæˆ‘ä»¬äº†è§£åˆ°æ›´æ–°å…·æœ‰ä¼˜å…ˆçº§ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§ï¼Ÿä¼˜å…ˆçº§ä»¥ä»€ä¹ˆä¸ºä¾æ®ï¼Ÿå¦‚ä½•é€šè¿‡ä¼˜å…ˆçº§å†³å®šå“ªä¸ªçŠ¶æ€åº”è¯¥å…ˆè¢«æ›´æ–°ï¼Ÿ æœ¬èŠ‚æˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£ã€‚ ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§ åœ¨Reactç†å¿µä¸€èŠ‚æˆ‘ä»¬èŠåˆ°Reactå°†äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœæ•´åˆåˆ°çœŸå®çš„UIä¸­ã€‚å…·ä½“åˆ°Reactè¿è¡Œä¸Šè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ çŠ¶æ€æ›´æ–°ç”±ç”¨æˆ·äº¤äº’äº§ç”Ÿï¼Œç”¨æˆ·å¿ƒé‡Œå¯¹äº¤äº’æ‰§è¡Œé¡ºåºæœ‰ä¸ªé¢„æœŸã€‚Reactæ ¹æ®äººæœºäº¤äº’","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/state/priority.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"æ·±å…¥ç†è§£ä¼˜å…ˆçº§"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§","slug":"ä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§","children":[]},{"level":2,"title":"å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§","slug":"å¦‚ä½•è°ƒåº¦ä¼˜å…ˆçº§","children":[]},{"level":2,"title":"ä¾‹å­","slug":"ä¾‹å­","children":[]},{"level":2,"title":"å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®","slug":"å¦‚ä½•ä¿è¯çŠ¶æ€æ­£ç¡®","children":[{"level":3,"title":"å¦‚ä½•ä¿è¯Updateä¸ä¸¢å¤±","slug":"å¦‚ä½•ä¿è¯updateä¸ä¸¢å¤±","children":[]},{"level":3,"title":"å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§","slug":"å¦‚ä½•ä¿è¯çŠ¶æ€ä¾èµ–çš„è¿ç»­æ€§","children":[]}]},{"level":2,"title":"å‚è€ƒèµ„æ–™","slug":"å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":5.8,"words":1739},"filePathRelative":"react/state/priority.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);