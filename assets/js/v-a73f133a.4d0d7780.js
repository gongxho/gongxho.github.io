"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[26025],{35198:(n,a,s)=>{s.r(a),s.d(a,{default:()=>H});var e=s(78e3);const t=(0,e.uE)('<p>å½“æˆ‘ä»¬æœ‰äº†å‰é¢çŸ¥è¯†çš„é“ºå«ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£<code>this.setState</code>çš„å·¥ä½œæµç¨‹ã€‚</p><h2 id="æµç¨‹æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#æµç¨‹æ¦‚è§ˆ" aria-hidden="true">#</a> æµç¨‹æ¦‚è§ˆ</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>this.setState</code>å†…ä¼šè°ƒç”¨<code>this.updater.enqueueSetState</code>æ–¹æ³•ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">partialState<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> partialState <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> partialState <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">||</span> partialState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span> <span class="token string">&quot;setState(...): takes an object of state variables to update or a function which returns an object of state variables.&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partialState<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">&#39;setState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',4),p=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),o={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react/src/ReactBaseClasses.js#L57",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("è¿™é‡Œ"),l=(0,e.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),i=(0,e.uE)('<p>åœ¨<code>enqueueSetState</code>æ–¹æ³•ä¸­å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ä»<code>åˆ›å»ºupdate</code>åˆ°<code>è°ƒåº¦update</code>çš„æµç¨‹äº†ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token parameter">inst<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// é€šè¿‡ç»„ä»¶å®ä¾‹è·å–å¯¹åº”fiber</span>\n  <span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> eventTime <span class="token operator">=</span> <span class="token function">requestEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> suspenseConfig <span class="token operator">=</span> <span class="token function">requestCurrentSuspenseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// è·å–ä¼˜å…ˆçº§</span>\n  <span class="token keyword">const</span> lane <span class="token operator">=</span> <span class="token function">requestUpdateLane</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> suspenseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// åˆ›å»ºupdate</span>\n  <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>eventTime<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> suspenseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  update<span class="token punctuation">.</span>payload <span class="token operator">=</span> payload<span class="token punctuation">;</span>\n\n  <span class="token comment">// èµ‹å€¼å›è°ƒå‡½æ•°</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> callback <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    update<span class="token punctuation">.</span>callback <span class="token operator">=</span> callback<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// å°†updateæ’å…¥updateQueue</span>\n  <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// è°ƒåº¦update</span>\n  <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',2),u=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),d={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L196",target:"_blank",rel:"noopener noreferrer"},r=(0,e.Uk)("è¿™é‡Œ"),k=(0,e.Uk)("çœ‹åˆ°"),v=(0,e._)("code",null,"enqueueSetState",-1),m=(0,e.Uk)("ä»£ç "),b=(0,e.uE)('<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯å¯¹äº<code>ClassComponent</code>ï¼Œ<code>update.payload</code>ä¸º<code>this.setState</code>çš„ç¬¬ä¸€ä¸ªä¼ å‚ï¼ˆå³è¦æ”¹å˜çš„<code>state</code>ï¼‰ã€‚</p><h2 id="this-forceupdate" tabindex="-1"><a class="header-anchor" href="#this-forceupdate" aria-hidden="true">#</a> this.forceUpdate</h2><p>åœ¨<code>this.updater</code>ä¸Šï¼Œé™¤äº†<code>enqueueSetState</code>å¤–ï¼Œè¿˜å­˜åœ¨<code>enqueueForceUpdate</code>ï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>this.forceUpdate</code>æ—¶ä¼šè°ƒç”¨ä»–ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†èµ‹å€¼<code>update.tag = ForceUpdate;</code>ä»¥åŠæ²¡æœ‰<code>payload</code>å¤–ï¼Œå…¶ä»–é€»è¾‘ä¸<code>this.setState</code>ä¸€è‡´ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">enqueueForceUpdate</span><span class="token punctuation">(</span><span class="token parameter">inst<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> fiber <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> eventTime <span class="token operator">=</span> <span class="token function">requestEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> suspenseConfig <span class="token operator">=</span> <span class="token function">requestCurrentSuspenseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> lane <span class="token operator">=</span> <span class="token function">requestUpdateLane</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> suspenseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token function">createUpdate</span><span class="token punctuation">(</span>eventTime<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> suspenseConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// èµ‹å€¼tagä¸ºForceUpdate</span>\n    update<span class="token punctuation">.</span>tag <span class="token operator">=</span> ForceUpdate<span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> callback <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      update<span class="token punctuation">.</span>callback <span class="token operator">=</span> callback<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">enqueueUpdate</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">scheduleUpdateOnFiber</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> lane<span class="token punctuation">,</span> eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),f=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),h={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L260",target:"_blank",rel:"noopener noreferrer"},g=(0,e.Uk)("è¿™é‡Œ"),U=(0,e.Uk)("çœ‹åˆ°"),y=(0,e._)("code",null,"enqueueForceUpdate",-1),S=(0,e.Uk)("ä»£ç "),C=(0,e.uE)('<p>é‚£ä¹ˆèµ‹å€¼<code>update.tag = ForceUpdate;</code>æœ‰ä½•ä½œç”¨å‘¢ï¼Ÿ</p><p>åœ¨åˆ¤æ–­<code>ClassComponent</code>æ˜¯å¦éœ€è¦æ›´æ–°æ—¶æœ‰ä¸¤ä¸ªæ¡ä»¶éœ€è¦æ»¡è¶³ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">const</span> shouldUpdate <span class="token operator">=</span>\n  <span class="token function">checkHasForceUpdateAfterProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>\n  <span class="token function">checkShouldComponentUpdate</span><span class="token punctuation">(</span>\n    workInProgress<span class="token punctuation">,</span>\n    ctor<span class="token punctuation">,</span>\n    oldProps<span class="token punctuation">,</span>\n    newProps<span class="token punctuation">,</span>\n    oldState<span class="token punctuation">,</span>\n    newState<span class="token punctuation">,</span>\n    nextContext<span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',3),w=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),q={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L1137",target:"_blank",rel:"noopener noreferrer"},_=(0,e.Uk)("è¿™é‡Œ"),j=(0,e.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),F=(0,e.uE)("<ul><li><p>checkHasForceUpdateAfterProcessingï¼šå†…éƒ¨ä¼šåˆ¤æ–­æœ¬æ¬¡æ›´æ–°çš„<code>Update</code>æ˜¯å¦ä¸º<code>ForceUpdate</code>ã€‚å³å¦‚æœæœ¬æ¬¡æ›´æ–°çš„<code>Update</code>ä¸­å­˜åœ¨<code>tag</code>ä¸º<code>ForceUpdate</code>ï¼Œåˆ™è¿”å›<code>true</code>ã€‚</p></li><li><p>checkShouldComponentUpdateï¼šå†…éƒ¨ä¼šè°ƒç”¨<code>shouldComponentUpdate</code>æ–¹æ³•ã€‚ä»¥åŠå½“è¯¥<code>ClassComponent</code>ä¸º<code>PureComponent</code>æ—¶ä¼šæµ…æ¯”è¾ƒ<code>state</code>ä¸<code>props</code>ã€‚</p></li></ul>",1),x=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),T={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L294",target:"_blank",rel:"noopener noreferrer"},E=(0,e.Uk)("è¿™é‡Œ"),R=(0,e.Uk)("çœ‹åˆ°"),L=(0,e._)("code",null,"checkShouldComponentUpdate",-1),P=(0,e.Uk)("ä»£ç "),W=(0,e.uE)('<p>æ‰€ä»¥ï¼Œå½“æŸæ¬¡æ›´æ–°å«æœ‰<code>tag</code>ä¸º<code>ForceUpdate</code>çš„<code>Update</code>ï¼Œé‚£ä¹ˆå½“å‰<code>ClassComponent</code>ä¸ä¼šå—å…¶ä»–<code>æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ</code>ï¼ˆ<code>shouldComponentUpdate</code>|<code>PureComponent</code>ï¼‰å½±å“ï¼Œä¸€å®šä¼šæ›´æ–°ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å­¦ä¹ å®Œäº†<code>HostRoot | ClassComponent</code>æ‰€ä½¿ç”¨çš„<code>Update</code>çš„æ›´æ–°æµç¨‹ã€‚</p><p>åœ¨ä¸‹ä¸€ç« æˆ‘ä»¬ä¼šå­¦ä¹ å¦ä¸€ç§æ•°æ®ç»“æ„çš„<code>Update</code> â€”â€” ç”¨äº<code>Hooks</code>çš„<code>Update</code>ã€‚</p>',4),z={},H=(0,s(13860).Z)(z,[["render",function(n,a){const s=(0,e.up)("ExternalLinkIcon");return(0,e.wg)(),(0,e.iD)("div",null,[t,(0,e._)("blockquote",null,[(0,e._)("p",null,[p,(0,e._)("a",o,[c,(0,e.Wm)(s)]),l])]),i,(0,e._)("blockquote",null,[(0,e._)("p",null,[u,(0,e._)("a",d,[r,(0,e.Wm)(s)]),k,v,m])]),b,(0,e._)("blockquote",null,[(0,e._)("p",null,[f,(0,e._)("a",h,[g,(0,e.Wm)(s)]),U,y,S])]),C,(0,e._)("blockquote",null,[(0,e._)("p",null,[w,(0,e._)("a",q,[_,(0,e.Wm)(s)]),j])]),F,(0,e._)("blockquote",null,[(0,e._)("p",null,[x,(0,e._)("a",T,[E,(0,e.Wm)(s)]),R,L,P])]),W])}]])},13860:(n,a)=>{a.Z=(n,a)=>{const s=n.__vccOpts||n;for(const[n,e]of a)s[n]=e;return s}},47762:(n,a,s)=>{s.r(a),s.d(a,{data:()=>e});const e=JSON.parse('{"key":"v-a73f133a","path":"/react/state/setstate.html","title":"this.setState","lang":"zh-CN","frontmatter":{"title":"this.setState","author":"BetaSu","tag":["React"],"summary":"å½“æˆ‘ä»¬æœ‰äº†å‰é¢çŸ¥è¯†çš„é“ºå«ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£this.setStateçš„å·¥ä½œæµç¨‹ã€‚ æµç¨‹æ¦‚è§ˆ å¯ä»¥çœ‹åˆ°ï¼Œthis.setStateå†…ä¼šè°ƒç”¨this.updater.enqueueSetStateæ–¹æ³•ã€‚ \\" ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°è¿™æ®µä»£ç \\" åœ¨enqueueSetStateæ–¹æ³•ä¸­å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ä»åˆ›å»ºupdateåˆ°è°ƒåº¦updateçš„æµç¨‹äº†ã€‚ \\" ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°enqueu","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/state/setstate.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"this.setState"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"æµç¨‹æ¦‚è§ˆ","slug":"æµç¨‹æ¦‚è§ˆ","children":[]},{"level":2,"title":"this.forceUpdate","slug":"this-forceupdate","children":[]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":2.01,"words":602},"filePathRelative":"react/state/setstate.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);