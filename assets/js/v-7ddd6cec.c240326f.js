"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[61681],{64593:(n,a,s)=>{s.r(a),s.d(a,{default:()=>Wn});var e=s(78e3);const t=(0,e.uE)('<p>è¯¥é˜¶æ®µä¹‹æ‰€ä»¥ç§°ä¸º<code>layout</code>ï¼Œå› ä¸ºè¯¥é˜¶æ®µçš„ä»£ç éƒ½æ˜¯åœ¨<code>DOM</code>ä¿®æ”¹å®Œæˆï¼ˆ<code>mutationé˜¶æ®µ</code>å®Œæˆï¼‰åæ‰§è¡Œçš„ã€‚</p><p>æ³¨æ„ï¼šç”±äº JS çš„åŒæ­¥æ‰§è¡Œé˜»å¡äº†ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥æ­¤æ—¶ JS å·²ç»å¯ä»¥è·å–åˆ°æ–°çš„<code>DOM</code>ï¼Œä½†æ˜¯æµè§ˆå™¨å¯¹æ–°çš„<code>DOM</code>å¹¶æ²¡æœ‰å®Œæˆæ¸²æŸ“ã€‚</p><p>è¯¥é˜¶æ®µè§¦å‘çš„ç”Ÿå‘½å‘¨æœŸé’©å­å’Œ<code>hook</code>å¯ä»¥ç›´æ¥è®¿é—®åˆ°å·²ç»æ”¹å˜åçš„<code>DOM</code>ï¼Œå³è¯¥é˜¶æ®µæ˜¯å¯ä»¥å‚ä¸<code>DOM layout</code>çš„é˜¶æ®µã€‚</p><h2 id="æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#æ¦‚è§ˆ" aria-hidden="true">#</a> æ¦‚è§ˆ</h2><p>ä¸å‰ä¸¤ä¸ªé˜¶æ®µç±»ä¼¼ï¼Œ<code>layouté˜¶æ®µ</code>ä¹Ÿæ˜¯éå†<code>effectList</code>ï¼Œæ‰§è¡Œå‡½æ•°ã€‚</p><p>å…·ä½“æ‰§è¡Œçš„å‡½æ•°æ˜¯<code>commitLayoutEffects</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>root<span class="token punctuation">.</span>current <span class="token operator">=</span> finishedWork<span class="token punctuation">;</span>\n\nnextEffect <span class="token operator">=</span> firstEffect<span class="token punctuation">;</span>\n<span class="token keyword">do</span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token function">commitLayoutEffects</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> lanes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">invariant</span><span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;Should be working on an effect.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">captureCommitPhaseError</span><span class="token punctuation">(</span>nextEffect<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    nextEffect <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>nextEffect<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nnextEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="commitlayouteffects" tabindex="-1"><a class="header-anchor" href="#commitlayouteffects" aria-hidden="true">#</a> commitLayoutEffects</h2><p>ä»£ç å¦‚ä¸‹ï¼š</p>',9),o=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),c={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L2302",target:"_blank",rel:"noopener noreferrer"},p=(0,e.Uk)("è¿™é‡Œ"),l=(0,e.Uk)("çœ‹åˆ°"),i=(0,e._)("code",null,"commitLayoutEffects",-1),r=(0,e.Uk)("æºç "),u=(0,e.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">commitLayoutEffects</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> FiberRoot<span class="token punctuation">,</span> <span class="token literal-property property">committedLanes</span><span class="token operator">:</span> Lanes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> effectTag <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>effectTag<span class="token punctuation">;</span>\n\n    <span class="token comment">// è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­å’Œhook</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTag <span class="token operator">&amp;</span> <span class="token punctuation">(</span>Update <span class="token operator">|</span> Callback<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> current <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>\n      <span class="token function">commitLayoutEffectOnFiber</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> current<span class="token punctuation">,</span> nextEffect<span class="token punctuation">,</span> committedLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// èµ‹å€¼ref</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>effectTag <span class="token operator">&amp;</span> Ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">commitAttachRef</span><span class="token punctuation">(</span>nextEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    nextEffect <span class="token operator">=</span> nextEffect<span class="token punctuation">.</span>nextEffect<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>commitLayoutEffects</code>ä¸€å…±åšäº†ä¸¤ä»¶äº‹ï¼š</p><ol><li><p>commitLayoutEffectOnFiberï¼ˆè°ƒç”¨<code>ç”Ÿå‘½å‘¨æœŸé’©å­</code>å’Œ<code>hook</code>ç›¸å…³æ“ä½œï¼‰</p></li><li><p>commitAttachRefï¼ˆèµ‹å€¼ refï¼‰</p></li></ol><h2 id="commitlayouteffectonfiber" tabindex="-1"><a class="header-anchor" href="#commitlayouteffectonfiber" aria-hidden="true">#</a> commitLayoutEffectOnFiber</h2><p><code>commitLayoutEffectOnFiber</code>æ–¹æ³•ä¼šæ ¹æ®<code>fiber.tag</code>å¯¹ä¸åŒç±»å‹çš„èŠ‚ç‚¹åˆ†åˆ«å¤„ç†ã€‚</p>',5),d=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),k={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberCommitWork.new.js#L459",target:"_blank",rel:"noopener noreferrer"},m=(0,e.Uk)("è¿™é‡Œ"),f=(0,e.Uk)("çœ‹åˆ°"),v=(0,e._)("code",null,"commitLayoutEffectOnFiber",-1),b=(0,e.Uk)("æºç ï¼ˆ"),h=(0,e._)("code",null,"commitLayoutEffectOnFiber",-1),y=(0,e.Uk)("ä¸ºåˆ«åï¼Œæ–¹æ³•åŸåä¸º"),g=(0,e._)("code",null,"commitLifeCycles",-1),_=(0,e.Uk)("ï¼‰"),E=(0,e.Uk)("å¯¹äº"),w=(0,e._)("code",null,"ClassComponent",-1),U=(0,e.Uk)("ï¼Œä»–ä¼šé€šè¿‡"),L=(0,e._)("code",null,"current === null?",-1),x=(0,e.Uk)("åŒºåˆ†æ˜¯"),F=(0,e._)("code",null,"mount",-1),j=(0,e.Uk)("è¿˜æ˜¯"),W=(0,e._)("code",null,"update",-1),R=(0,e.Uk)("ï¼Œè°ƒç”¨"),O={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberCommitWork.new.js#L538",target:"_blank",rel:"noopener noreferrer"},C=(0,e._)("code",null,"componentDidMount",-1),D=(0,e.Uk)("æˆ–"),q={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberCommitWork.new.js#L592",target:"_blank",rel:"noopener noreferrer"},M=(0,e._)("code",null,"componentDidUpdate",-1),T=(0,e.Uk)("ã€‚"),S=(0,e.uE)('<p>è§¦å‘<code>çŠ¶æ€æ›´æ–°</code>çš„<code>this.setState</code>å¦‚æœèµ‹å€¼äº†ç¬¬äºŒä¸ªå‚æ•°<code>å›è°ƒå‡½æ•°</code>ï¼Œä¹Ÿä¼šåœ¨æ­¤æ—¶è°ƒç”¨ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">xxx</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i am update~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯¹äº<code>FunctionComponent</code>åŠç›¸å…³ç±»å‹ï¼Œä»–ä¼šè°ƒç”¨<code>useLayoutEffect hook</code>çš„<code>å›è°ƒå‡½æ•°</code>ï¼Œè°ƒåº¦<code>useEffect</code>çš„<code>é”€æ¯</code>ä¸<code>å›è°ƒ</code>å‡½æ•°</li></ul><blockquote><p><code>ç›¸å…³ç±»å‹</code>æŒ‡ç‰¹æ®Šå¤„ç†åçš„<code>FunctionComponent</code>ï¼Œæ¯”å¦‚<code>ForwardRef</code>ã€<code>React.memo</code>åŒ…è£¹çš„<code>FunctionComponent</code></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ä»¥ä¸‹éƒ½æ˜¯FunctionComponentåŠç›¸å…³ç±»å‹</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">FunctionComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">ForwardRef</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">SimpleMemoComponent</span><span class="token operator">:</span>\n    <span class="token keyword">case</span> <span class="token literal-property property">Block</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// æ‰§è¡ŒuseLayoutEffectçš„å›è°ƒå‡½æ•°</span>\n      <span class="token function">commitHookEffectListMount</span><span class="token punctuation">(</span>HookLayout <span class="token operator">|</span> HookHasEffect<span class="token punctuation">,</span> finishedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// è°ƒåº¦useEffectçš„é”€æ¯å‡½æ•°ä¸å›è°ƒå‡½æ•°</span>\n      <span class="token function">schedulePassiveEffects</span><span class="token punctuation">(</span>finishedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',5),A=(0,e.Uk)("ä½ å¯ä»¥ä»"),B={href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberCommitWork.old.js#L465-L491",target:"_blank",rel:"noopener noreferrer"},H=(0,e.Uk)("è¿™é‡Œ"),J=(0,e.Uk)("çœ‹åˆ°è¿™æ®µä»£ç "),N=(0,e.Uk)("åœ¨ä¸Šä¸€èŠ‚ä»‹ç»"),P=(0,e.Uk)("Update effect"),z=(0,e.Uk)("æ—¶ä»‹ç»è¿‡ï¼Œ"),Z=(0,e._)("code",null,"mutationé˜¶æ®µ",-1),I=(0,e.Uk)("ä¼šæ‰§è¡Œ"),G=(0,e._)("code",null,"useLayoutEffect hook",-1),K=(0,e.Uk)("çš„"),Q=(0,e._)("code",null,"é”€æ¯å‡½æ•°",-1),V=(0,e.Uk)("ã€‚"),X=(0,e.uE)('<p>ç»“åˆè¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ<code>useLayoutEffect hook</code>ä»ä¸Šä¸€æ¬¡æ›´æ–°çš„<code>é”€æ¯å‡½æ•°</code>è°ƒç”¨åˆ°æœ¬æ¬¡æ›´æ–°çš„<code>å›è°ƒå‡½æ•°</code>è°ƒç”¨æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚</p><p>è€Œ<code>useEffect</code>åˆ™éœ€è¦å…ˆè°ƒåº¦ï¼Œåœ¨<code>Layouté˜¶æ®µ</code>å®Œæˆåå†å¼‚æ­¥æ‰§è¡Œã€‚</p><p>è¿™å°±æ˜¯<code>useLayoutEffect</code>ä¸<code>useEffect</code>çš„åŒºåˆ«ã€‚</p><ul><li>å¯¹äº<code>HostRoot</code>ï¼Œå³<code>rootFiber</code>ï¼Œå¦‚æœèµ‹å€¼äº†ç¬¬ä¸‰ä¸ªå‚æ•°<code>å›è°ƒå‡½æ•°</code>ï¼Œä¹Ÿä¼šåœ¨æ­¤æ—¶è°ƒç”¨ã€‚</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i am mount~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="commitattachref" tabindex="-1"><a class="header-anchor" href="#commitattachref" aria-hidden="true">#</a> commitAttachRef</h2><p><code>commitLayoutEffects</code>ä¼šåšçš„ç¬¬äºŒä»¶äº‹æ˜¯<code>commitAttachRef</code>ã€‚</p>',7),Y=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),$={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberCommitWork.new.js#L823",target:"_blank",rel:"noopener noreferrer"},nn=(0,e.Uk)("è¿™é‡Œ"),an=(0,e.Uk)("çœ‹åˆ°"),sn=(0,e._)("code",null,"commitAttachRef",-1),en=(0,e.Uk)("æºç "),tn=(0,e.uE)('<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">commitAttachRef</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">finishedWork</span><span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> ref <span class="token operator">=</span> finishedWork<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>ref <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> instance <span class="token operator">=</span> finishedWork<span class="token punctuation">.</span>stateNode<span class="token punctuation">;</span>\n\n    <span class="token comment">// è·å–DOMå®ä¾‹</span>\n    <span class="token keyword">let</span> instanceToUse<span class="token punctuation">;</span>\n    <span class="token keyword">switch</span> <span class="token punctuation">(</span>finishedWork<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span>\n        instanceToUse <span class="token operator">=</span> <span class="token function">getPublicInstance</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">break</span><span class="token punctuation">;</span>\n      <span class="token keyword">default</span><span class="token operator">:</span>\n        instanceToUse <span class="token operator">=</span> instance<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> ref <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å¦‚æœrefæ˜¯å‡½æ•°å½¢å¼ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°</span>\n      <span class="token function">ref</span><span class="token punctuation">(</span>instanceToUse<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å¦‚æœrefæ˜¯refå®ä¾‹å½¢å¼ï¼Œèµ‹å€¼ref.current</span>\n      ref<span class="token punctuation">.</span>current <span class="token operator">=</span> instanceToUse<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç é€»è¾‘å¾ˆç®€å•ï¼šè·å–<code>DOM</code>å®ä¾‹ï¼Œæ›´æ–°<code>ref</code>ã€‚</p><h2 id="current-fiberæ ‘åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#current-fiberæ ‘åˆ‡æ¢" aria-hidden="true">#</a> current Fiberæ ‘åˆ‡æ¢</h2><p>è‡³æ­¤ï¼Œæ•´ä¸ª<code>layouté˜¶æ®µ</code>å°±ç»“æŸäº†ã€‚</p><p>åœ¨ç»“æŸæœ¬èŠ‚çš„å­¦ä¹ å‰ï¼Œæˆ‘ä»¬å…³æ³¨ä¸‹è¿™è¡Œä»£ç ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>root<span class="token punctuation">.</span>current <span class="token operator">=</span> finishedWork<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>',6),on=(0,e.Uk)("ä½ å¯ä»¥åœ¨"),cn={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L2022",target:"_blank",rel:"noopener noreferrer"},pn=(0,e.Uk)("è¿™é‡Œ"),ln=(0,e.Uk)("çœ‹åˆ°è¿™è¡Œä»£ç "),rn=(0,e.Uk)("åœ¨"),un=(0,e.Uk)("åŒç¼“å­˜æœºåˆ¶ä¸€èŠ‚"),dn=(0,e.Uk)("æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œ"),kn=(0,e._)("code",null,"workInProgress Fiberæ ‘",-1),mn=(0,e.Uk)("åœ¨"),fn=(0,e._)("code",null,"commité˜¶æ®µ",-1),vn=(0,e.Uk)("å®Œæˆæ¸²æŸ“åä¼šå˜ä¸º"),bn=(0,e._)("code",null,"current Fiberæ ‘",-1),hn=(0,e.Uk)("ã€‚è¿™è¡Œä»£ç çš„ä½œç”¨å°±æ˜¯åˆ‡æ¢"),yn=(0,e._)("code",null,"fiberRootNode",-1),gn=(0,e.Uk)("æŒ‡å‘çš„"),_n=(0,e._)("code",null,"current Fiberæ ‘",-1),En=(0,e.Uk)("ã€‚"),wn=(0,e.uE)('<p>é‚£ä¹ˆè¿™è¡Œä»£ç ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œå‘¢ï¼Ÿï¼ˆåœ¨<code>mutationé˜¶æ®µ</code>ç»“æŸåï¼Œ<code>layouté˜¶æ®µ</code>å¼€å§‹å‰ã€‚ï¼‰</p><p>æˆ‘ä»¬çŸ¥é“<code>componentWillUnmount</code>ä¼šåœ¨<code>mutationé˜¶æ®µ</code>æ‰§è¡Œã€‚æ­¤æ—¶<code>current Fiberæ ‘</code>è¿˜æŒ‡å‘å‰ä¸€æ¬¡æ›´æ–°çš„<code>Fiberæ ‘</code>ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸé’©å­å†…è·å–çš„<code>DOM</code>è¿˜æ˜¯æ›´æ–°å‰çš„ã€‚</p><p><code>componentDidMount</code>å’Œ<code>componentDidUpdate</code>ä¼šåœ¨<code>layouté˜¶æ®µ</code>æ‰§è¡Œã€‚æ­¤æ—¶<code>current Fiberæ ‘</code>å·²ç»æŒ‡å‘æ›´æ–°åçš„<code>Fiberæ ‘</code>ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸé’©å­å†…è·å–çš„<code>DOM</code>å°±æ˜¯æ›´æ–°åçš„ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>ä»è¿™èŠ‚æˆ‘ä»¬å­¦åˆ°ï¼Œ<code>layouté˜¶æ®µ</code>ä¼šéå†<code>effectList</code>ï¼Œä¾æ¬¡æ‰§è¡Œ<code>commitLayoutEffects</code>ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¸ºâ€œæ ¹æ®<code>effectTag</code>è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°å¤„ç†<code>Fiber</code>å¹¶æ›´æ–°<code>ref</code>ã€‚</p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-hidden="true">#</a> å‚è€ƒèµ„æ–™</h2>',6),Un={href:"https://blog.logrocket.com/useeffect-vs-uselayouteffect-examples/",target:"_blank",rel:"noopener noreferrer"},Ln=(0,e.Uk)("useeffect-vs-uselayouteffect-examples"),xn={href:"https://reactjs.org/docs/hooks-reference.html#uselayouteffect",target:"_blank",rel:"noopener noreferrer"},Fn=(0,e.Uk)("hooks-reference.html#uselayouteffect"),jn={},Wn=(0,s(13860).Z)(jn,[["render",function(n,a){const s=(0,e.up)("ExternalLinkIcon"),jn=(0,e.up)("RouterLink");return(0,e.wg)(),(0,e.iD)("div",null,[t,(0,e._)("blockquote",null,[(0,e._)("p",null,[o,(0,e._)("a",c,[p,(0,e.Wm)(s)]),l,i,r])]),u,(0,e._)("blockquote",null,[(0,e._)("p",null,[d,(0,e._)("a",k,[m,(0,e.Wm)(s)]),f,v,b,h,y,g,_])]),(0,e._)("ul",null,[(0,e._)("li",null,[E,w,U,L,x,F,j,W,R,(0,e._)("a",O,[C,(0,e.Wm)(s)]),D,(0,e._)("a",q,[M,(0,e.Wm)(s)]),T])]),S,(0,e._)("blockquote",null,[(0,e._)("p",null,[A,(0,e._)("a",B,[H,(0,e.Wm)(s)]),J])]),(0,e._)("p",null,[N,(0,e.Wm)(jn,{to:"/react/renderer/mutation.html#update-effect"},{default:(0,e.w5)((()=>[P])),_:1}),z,Z,I,G,K,Q,V]),X,(0,e._)("blockquote",null,[(0,e._)("p",null,[Y,(0,e._)("a",$,[nn,(0,e.Wm)(s)]),an,sn,en])]),tn,(0,e._)("blockquote",null,[(0,e._)("p",null,[on,(0,e._)("a",cn,[pn,(0,e.Wm)(s)]),ln])]),(0,e._)("p",null,[rn,(0,e.Wm)(jn,{to:"/react/process/doubleBuffer.html#%E4%BB%80%E4%B9%88%E6%98%AF-%E5%8F%8C%E7%BC%93%E5%AD%98"},{default:(0,e.w5)((()=>[un])),_:1}),dn,kn,mn,fn,vn,bn,hn,yn,gn,_n,En]),wn,(0,e._)("p",null,[(0,e._)("a",Un,[Ln,(0,e.Wm)(s)])]),(0,e._)("p",null,[(0,e._)("a",xn,[Fn,(0,e.Wm)(s)])])])}]])},13860:(n,a)=>{a.Z=(n,a)=>{const s=n.__vccOpts||n;for(const[n,e]of a)s[n]=e;return s}},7136:(n,a,s)=>{s.r(a),s.d(a,{data:()=>e});const e=JSON.parse('{"key":"v-7ddd6cec","path":"/react/renderer/layout.html","title":"layouté˜¶æ®µ","lang":"zh-CN","frontmatter":{"title":"layouté˜¶æ®µ","author":"BetaSu","tag":["React"],"summary":"è¯¥é˜¶æ®µä¹‹æ‰€ä»¥ç§°ä¸ºlayoutï¼Œå› ä¸ºè¯¥é˜¶æ®µçš„ä»£ç éƒ½æ˜¯åœ¨DOMä¿®æ”¹å®Œæˆï¼ˆmutationé˜¶æ®µå®Œæˆï¼‰åæ‰§è¡Œçš„ã€‚ æ³¨æ„ï¼šç”±äº JS çš„åŒæ­¥æ‰§è¡Œé˜»å¡äº†ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥æ­¤æ—¶ JS å·²ç»å¯ä»¥è·å–åˆ°æ–°çš„DOMï¼Œä½†æ˜¯æµè§ˆå™¨å¯¹æ–°çš„DOMå¹¶æ²¡æœ‰å®Œæˆæ¸²æŸ“ã€‚ è¯¥é˜¶æ®µè§¦å‘çš„ç”Ÿå‘½å‘¨æœŸé’©å­å’Œhookå¯ä»¥ç›´æ¥è®¿é—®åˆ°å·²ç»æ”¹å˜åçš„DOMï¼Œå³è¯¥é˜¶æ®µæ˜¯å¯ä»¥å‚ä¸DOM layoutçš„é˜¶æ®µã€‚ æ¦‚è§ˆ ä¸å‰ä¸¤ä¸ª","head":[["meta",{"property":"og:url","content":"https://0808200.xyz/react/renderer/layout.html"}],["meta",{"property":"og:site_name","content":"ğ‘€ğ‘Ÿ.ğºğ‘œğ‘œğ‘”ğ‘¥â„"}],["meta",{"property":"og:title","content":"layouté˜¶æ®µ"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2022-08-29T09:14:21.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"BetaSu"}],["meta",{"property":"article:tag","content":"React"}],["meta",{"property":"article:modified_time","content":"2022-08-29T09:14:21.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"æ¦‚è§ˆ","slug":"æ¦‚è§ˆ","children":[]},{"level":2,"title":"commitLayoutEffects","slug":"commitlayouteffects","children":[]},{"level":2,"title":"commitLayoutEffectOnFiber","slug":"commitlayouteffectonfiber","children":[]},{"level":2,"title":"commitAttachRef","slug":"commitattachref","children":[]},{"level":2,"title":"current Fiberæ ‘åˆ‡æ¢","slug":"current-fiberæ ‘åˆ‡æ¢","children":[]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","children":[]},{"level":2,"title":"å‚è€ƒèµ„æ–™","slug":"å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1661764461000,"updatedTime":1661764461000,"contributors":[{"name":"googxh","email":"gxh522@qq.com","commits":1}]},"readingTime":{"minutes":3.69,"words":1108},"filePathRelative":"react/renderer/layout.md","localizedDate":"2022å¹´8æœˆ29æ—¥"}')}}]);